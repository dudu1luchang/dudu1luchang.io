

<!DOCTYPE html>
<html lang="zh-CN" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/fluid.png">
  <link rel="icon" href="/img/fluid.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="xuebaqiang">
  <meta name="keywords" content="">
  
    <meta name="description" content="拉勾教育PC站-微服务版— 老孙 01 概述与搭建服务中心1、回顾微服务1. 概述我们先看微服务的提出者马丁福勒的论文中，是如何描述微服务的  微服务是一种架构模式或者架构风格，它提倡将单一的应用程序划分成一组小的服务，每个服务运行在其独立的进程中-，服务之间相互协调，配置，共同为用户提供最终的价值； 通俗点： 封建王朝，很有多州郡，每个州郡都是皇上的亲戚，也有贡献突出的将军，镇南侯，平西王等等封">
<meta property="og:type" content="article">
<meta property="og:title" content="【拉钩就业】拉勾教育PC站-微服务版">
<meta property="og:url" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/index.html">
<meta property="og:site_name" content="myBlog">
<meta property="og:description" content="拉勾教育PC站-微服务版— 老孙 01 概述与搭建服务中心1、回顾微服务1. 概述我们先看微服务的提出者马丁福勒的论文中，是如何描述微服务的  微服务是一种架构模式或者架构风格，它提倡将单一的应用程序划分成一组小的服务，每个服务运行在其独立的进程中-，服务之间相互协调，配置，共同为用户提供最终的价值； 通俗点： 封建王朝，很有多州郡，每个州郡都是皇上的亲戚，也有贡献突出的将军，镇南侯，平西王等等封">
<meta property="og:locale" content="zh_CN">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/1.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/2.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/3.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210319182134660.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210319182308234.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20201012170225301.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20201012170702860.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20201012171330757.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20201012171736350.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20201012171932331.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210214133410732.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210224173221295.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/qq1.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210316101136730.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210315164923888.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210317153154543.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210317153335688.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210317155050654.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210317155110318.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210317155701371.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210317161600202.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20200922180904548.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210203233941598.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210203233611569.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210318165550615.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/111.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/222.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/11.PNG">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/22.PNG">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/33.PNG">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/d1.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/d2.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/d3.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/d4.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/d5.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210319143055076.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20201105134622304.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210319131137670.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210319142838823.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20201105133347494.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20201105134345284.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20221121232450752.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210324164927921.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210324165001869.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210319173913727.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210319174210095.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210319175108032.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20221122001821474.png">
<meta property="og:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210324164751276.png">
<meta property="article:published_time" content="2022-11-01T16:19:27.000Z">
<meta property="article:modified_time" content="2023-03-09T09:45:12.073Z">
<meta property="article:author" content="xuebaqiang">
<meta property="article:tag" content="项目">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://xuebaqiang.github.io/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/1.png">
  
  
  
  <title>【拉钩就业】拉勾教育PC站-微服务版 - myBlog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"xuebaqiang.github.io","root":"/","version":"1.9.4","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":null,"gtag":null,"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml"};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 6.3.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>xuebaqiang</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/">
                <i class="iconfont icon-home-fill"></i>
                <span>首页</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/">
                <i class="iconfont icon-archive-fill"></i>
                <span>归档</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/">
                <i class="iconfont icon-category-fill"></i>
                <span>分类</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/">
                <i class="iconfont icon-tags-fill"></i>
                <span>标签</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/">
                <i class="iconfont icon-user-fill"></i>
                <span>关于</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/default.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="【拉钩就业】拉勾教育PC站-微服务版"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2022-11-02 00:19" pubdate>
          2022年11月2日 凌晨
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          144k 字
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          1202 分钟
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <!-- SEO header -->
            <h1 style="display: none">【拉钩就业】拉勾教育PC站-微服务版</h1>
            
            
              <div class="markdown-body">
                
                <h1 id="拉勾教育PC站-微服务版"><a href="#拉勾教育PC站-微服务版" class="headerlink" title="拉勾教育PC站-微服务版"></a>拉勾教育PC站-微服务版</h1><p>— 老孙</p>
<h1 id="01-概述与搭建服务中心"><a href="#01-概述与搭建服务中心" class="headerlink" title="01 概述与搭建服务中心"></a>01 概述与搭建服务中心</h1><h2 id="1、回顾微服务"><a href="#1、回顾微服务" class="headerlink" title="1、回顾微服务"></a>1、回顾微服务</h2><h3 id="1-概述"><a href="#1-概述" class="headerlink" title="1. 概述"></a>1. 概述</h3><p>我们先看微服务的提出者马丁福勒的论文中，是如何描述微服务的</p>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/1.png" srcset="/img/loading.gif" lazyload alt="1"></p>
<p>微服务是一种架构模式或者架构风格，它提倡将单一的应用程序划分成一组小的服务，每个服务运行在其独立的进程中-，服务之间相互协调，配置，共同为用户提供最终的价值；</p>
<p><strong>通俗点：</strong></p>
<p>封建王朝，很有多州郡，每个州郡都是皇上的亲戚，也有贡献突出的将军，镇南侯，平西王等等封疆大吏，他们每个人在自己的管辖区域，就是最高权力的象征。</p>
<p>自己的州郡都独立运营（<strong>单一架构</strong>）</p>
<p>但是风土人情不同，统治的策略也要满足不同的需求。（南方有文化底蕴，孔夫子教化即可。西北民风彪悍，肯定要用雷霆手段）</p>
<p>这样大大小小的不同州郡，统一起来，就是一个至高权力的朝廷（<strong>总架构</strong>）</p>
<p><strong>总结：</strong></p>
<p>将传统的一站式应用，拆分成一个一个独立的服务，彻底的解除耦合，每个服务提供单个业务功能的服务，一个服务就做一件事，成立一个独立的进程，能够自行启动和销毁，甚至拥有独立的数据库。</p>
<h3 id="2-优点"><a href="#2-优点" class="headerlink" title="2. 优点"></a>2. 优点</h3><ol>
<li><p>每个服务内聚，足够小，开发简单，效率高，一个服务做一件事；</p>
</li>
<li><p>微服务是松耦合的，无论是开发还是部署阶段都是独立；</p>
</li>
<li><p>微服务能使用不同的语言开发；</p>
</li>
</ol>
<p><strong>4)</strong> <strong>微服务只是业务逻辑代码，不会和HTML，CSS或其他页面组件混合；</strong></p>
<ol start="5">
<li>每个服务都有自己的储存能力，可以有自己的数据库，当然，也可以有统一的数据；</li>
</ol>
<h3 id="3-缺点"><a href="#3-缺点" class="headerlink" title="3. 缺点"></a>3. 缺点</h3><ol>
<li><p>开发人员要处理分布式系统的复杂性；</p>
</li>
<li><p>随着服务的增加，运维的难度越大；</p>
</li>
<li><p>系统部署依赖</p>
</li>
<li><p>通信成本加大</p>
</li>
<li><p>数据一致性难搞</p>
</li>
<li><p>系统集成测试麻烦</p>
</li>
<li><p>性能监控不易</p>
</li>
<li><p>。。。。</p>
</li>
</ol>
<h3 id="4-微服务与微服务架构"><a href="#4-微服务与微服务架构" class="headerlink" title="4. 微服务与微服务架构"></a>4. 微服务与微服务架构</h3><h4 id="4-1-微服务"><a href="#4-1-微服务" class="headerlink" title="4.1 微服务"></a>4.1 微服务</h4><ul>
<li><p>强调的是一个服务的大小，**关注的是一个点 **，能够解决某个问题而存在的应用，类似于项目中的某个工程&#x2F;module；</p>
</li>
<li><p>单独的牙科医院，眼科医院；</p>
</li>
<li><p>手机，电脑，沙发，床垫，运动服，每一个都是微服务；</p>
</li>
<li><p>**专注个体，每个个体完成一个具体的任务或功能； **</p>
</li>
</ul>
<h4 id="4-2-微服务架构"><a href="#4-2-微服务架构" class="headerlink" title="4.2 微服务架构"></a>4.2 微服务架构</h4><p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/2.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li><p>一种架构模式，它提倡单一应用程序划分一组小的服务，服务之间相互协调，相互配合，为用户提供最终的价值；</p>
</li>
<li><p>服务之间采用轻量级通信机制，（HTTP协议的RESTfull）</p>
</li>
<li><p>每个服务都围绕具体的业务进行构建，并且能够独立部署到生产环境中；</p>
</li>
<li><p>尽量避免统一的，集中式的服务管理机制</p>
</li>
<li><p><b style='color:red'>单独的门诊就不要了，我们所有的门诊整合，形成了一个综合性医院</b></p>
</li>
<li><p>小米生态链，牙刷，电饭锅，手机，路由器，全是小米的。</p>
</li>
</ul>
<h4 id="4-3-SpringCloud和SpringBoot区别？"><a href="#4-3-SpringCloud和SpringBoot区别？" class="headerlink" title="4.3 SpringCloud和SpringBoot区别？"></a>4.3 SpringCloud和SpringBoot区别？</h4><ul>
<li>SpringBoot专注于快速方便的开发单个个体服务；</li>
<li>SpringCloud关注全局微服务的协调和整理，它将SpringBoot开发的一个个单体微服务整合起来；</li>
<li>SpringBoot可以独立使用开发，但是SpringCloud离不开SpringBoot，属于依赖关系；</li>
<li>**SpringBoot属于一个科室，SpringCloud是综合医院； **</li>
</ul>
<h4 id="4-4-SpringCloud对比Dubbo"><a href="#4-4-SpringCloud对比Dubbo" class="headerlink" title="4.4 SpringCloud对比Dubbo"></a>4.4 SpringCloud对比Dubbo</h4><table>
<thead>
<tr>
<th></th>
<th>**Dubbo **</th>
<th>**SpringCloud **</th>
</tr>
</thead>
<tbody><tr>
<td>服务注册中心</td>
<td>Zookeeper</td>
<td>String Cloud Netflix Eureka</td>
</tr>
<tr>
<td>服务调用方式</td>
<td>RPC</td>
<td>REST API</td>
</tr>
<tr>
<td>服务监控</td>
<td>Dubbo-monitor</td>
<td>Spring Boot Admin</td>
</tr>
<tr>
<td>断路器</td>
<td>不完善</td>
<td>Spring Cloud Netflix Hystrix</td>
</tr>
<tr>
<td>服务网关</td>
<td>无</td>
<td>Spring Cloud Netflix Zuul</td>
</tr>
<tr>
<td>分布式配置</td>
<td>无</td>
<td>Spring Cloud Config</td>
</tr>
<tr>
<td>服务跟踪</td>
<td>无</td>
<td>Spring Cloud Sleuth</td>
</tr>
<tr>
<td>消息总线</td>
<td>无</td>
<td>Spring Cloud Bus</td>
</tr>
<tr>
<td>数据流</td>
<td>无</td>
<td>Spring Cloud Stream</td>
</tr>
<tr>
<td>批量任务</td>
<td>无</td>
<td>Spring Cloud Task</td>
</tr>
</tbody></table>
<p><strong>品牌机和组装机</strong></p>
<h2 id="2、微服务架构项目"><a href="#2、微服务架构项目" class="headerlink" title="2、微服务架构项目"></a>2、微服务架构项目</h2><p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/3.png" srcset="/img/loading.gif" lazyload alt="3.png"></p>
<ul>
<li><h5 id="edu-lagou：父工程"><a href="#edu-lagou：父工程" class="headerlink" title="edu-lagou：父工程"></a>edu-lagou：父工程</h5></li>
<li><h5 id="edu-api：通用的公共子模块"><a href="#edu-api：通用的公共子模块" class="headerlink" title="edu-api：通用的公共子模块"></a>edu-api：通用的公共子模块</h5></li>
<li><h5 id="edu-eureka-boot：服务中心：7001"><a href="#edu-eureka-boot：服务中心：7001" class="headerlink" title="edu-eureka-boot：服务中心：7001"></a>edu-eureka-boot：服务中心：<font style='color:red;'>7001</font></h5></li>
<li><p><strong>edu-ad-boot：广告微服务：<font style='color:red;'>8001</font></strong></p>
</li>
<li><h5 id="edu-user-boot：用户微服务：8002"><a href="#edu-user-boot：用户微服务：8002" class="headerlink" title="edu-user-boot：用户微服务：8002"></a>edu-user-boot：用户微服务：<font style='color:red;'>8002</font></h5></li>
<li><p><strong>edu-authority-boot：认证微服务：<font style='color:red;'>80</font></strong></p>
</li>
<li><h5 id="edu-course-boot：课程微服务：8004"><a href="#edu-course-boot：课程微服务：8004" class="headerlink" title="edu-course-boot：课程微服务：8004"></a>edu-course-boot：课程微服务：<font style='color:red;'>8004</font></h5></li>
<li><p><strong>edu-comment-boot：留言微服务：<font style='color:red;'>8005</font></strong></p>
</li>
<li><h5 id="edu-pay-boot：支付微服务：8006"><a href="#edu-pay-boot：支付微服务：8006" class="headerlink" title="edu-pay-boot：支付微服务：8006"></a>edu-pay-boot：支付微服务：<font style='color:red;'>8006</font></h5></li>
<li><p><strong>edu-order-boot：订单微服务：<font style='color:red;'>8007</font></strong></p>
</li>
<li><p><strong>edu-config-boot：配置中心：<font style='color:red;'>8008</font></strong></p>
</li>
<li><p><strong>edu-gateway-boot：网关微服务：<font style='color:red;'>9001</font></strong></p>
</li>
</ul>
<h2 id="3、搭建项目"><a href="#3、搭建项目" class="headerlink" title="3、搭建项目"></a>3、搭建项目</h2><h3 id="3-1-父工程"><a href="#3-1-父工程" class="headerlink" title="3.1 父工程"></a>3.1 父工程</h3><p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210319182134660.png" srcset="/img/loading.gif" lazyload alt="image-20210319182134660"></p>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210319182308234.png" srcset="/img/loading.gif" lazyload alt="image-20210319182308234"></p>
<ul>
<li>父工程为聚合项目，打包方式为pom</li>
<li>src目录也没有意义，可以删除</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">packaging</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">packaging</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span> <span class="hljs-comment">&lt;!-- lookup parent from repository --&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.lagou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>edu-lagou<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">spring-cloud.version</span>&gt;</span>2020.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">spring-cloud.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.vintage<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-vintage-engine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>$&#123;spring-cloud.version&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h3 id="3-2-创建服务中心"><a href="#3-2-创建服务中心" class="headerlink" title="3.2 创建服务中心"></a>3.2 创建服务中心</h3><ul>
<li>在父工程中创建一个新的Module</li>
</ul>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20201012170225301.png" srcset="/img/loading.gif" lazyload></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.lagou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>edu-lagou<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.lagou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>edu-eureka-boot<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>edu-eureka-boot<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>



<ul>
<li>开启服务管理器，调试会方便一些</li>
</ul>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20201012170702860.png" srcset="/img/loading.gif" lazyload alt="image-20201012170702860"></p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableEurekaServer</span> <span class="hljs-comment">//开启Eureka服务</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EduEurekaBootApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(EduEurekaBootApplication.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>修改配置文件后缀为 yml</li>
</ul>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20201012171330757.png" srcset="/img/loading.gif" lazyload alt="image-20201012171330757"></p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-comment"># 配置服务端口</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">7001</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">hostname:</span> <span class="hljs-string">localhost</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-comment"># 配置eureka服务器地址</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://$&#123;eureka.instance.hostname&#125;:$&#123;server.port&#125;/eureka/</span><br>    <span class="hljs-comment">#是否需要将自己注册到注册中心(注册中心集群需要设置为true)</span><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">false</span><br>    <span class="hljs-comment">#是否需要搜索服务信息 因为自己是注册中心所以为false</span><br>    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">false</span><br></code></pre></td></tr></table></figure>

<ul>
<li>启动项目</li>
</ul>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20201012171736350.png" srcset="/img/loading.gif" lazyload alt="image-20201012171736350"></p>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20201012171932331.png" srcset="/img/loading.gif" lazyload alt="image-20201012171932331"></p>
<hr>
<h1 id="02-广告微服务"><a href="#02-广告微服务" class="headerlink" title="02 广告微服务"></a>02 广告微服务</h1><h2 id="广告微服务：8001"><a href="#广告微服务：8001" class="headerlink" title="广告微服务：8001"></a>广告微服务：<font style='color:red;'>8001</font></h2><p>edu-ad-boot：广告微服务：<font style='color:red;'>8001</font></p>
<ul>
<li><p>通过spring初始化器创建项目，引入web和eureka client</p>
</li>
<li><p>父工程加入dao相关依赖：</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.lagou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>edu-lagou<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.lagou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>edu-ad-boot<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>edu-ad-boot<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- web --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- eureka客户端 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>		<span class="hljs-comment">&lt;!-- mybatis plus --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- mysql --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--pojo持久化使用--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.persistence<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.persistence-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>实体类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.lagou.eduadboot.entity;<br><br><span class="hljs-keyword">import</span> lombok.Data;<br><br><span class="hljs-keyword">import</span> javax.persistence.Id;<br><span class="hljs-keyword">import</span> javax.persistence.Table;<br><span class="hljs-keyword">import</span> java.io.Serializable;<br><span class="hljs-keyword">import</span> java.util.Date;<br><br><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Table(name=&quot;promotion_ad&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PromotionAd</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> -<span class="hljs-number">29054335318173039L</span>;<br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-keyword">private</span> Integer  id;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 广告名</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-keyword">private</span> Integer spaceId;<br>    <span class="hljs-keyword">private</span> String keyword;<br>    <span class="hljs-keyword">private</span> String htmlContent;<br>    <span class="hljs-keyword">private</span> String text;<br>    <span class="hljs-keyword">private</span> String link;<br>    <span class="hljs-keyword">private</span> Date startTime;<br>    <span class="hljs-keyword">private</span> Date endTime;<br>    <span class="hljs-keyword">private</span> Date createTime;<br>    <span class="hljs-keyword">private</span> Date updateTime;<br>    <span class="hljs-keyword">private</span> Integer status ;<br>    <span class="hljs-keyword">private</span> Integer priority;<br>    <span class="hljs-keyword">private</span> String img;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>dao实现 通过广告位查询广告</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.lagou.eduadboot.mapper;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.mapper.BaseMapper;<br><span class="hljs-keyword">import</span> com.lagou.eduadboot.entity.PromotionAd;<br><span class="hljs-keyword">import</span> org.apache.ibatis.annotations.*;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AdDao</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;PromotionAd&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>service</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AdService</span> &#123;<br>    List&lt;PromotionAd&gt; <span class="hljs-title function_">getAdsBySpaceId</span><span class="hljs-params">(Integer sid)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.lagou.eduadboot.service.impl;<br><br><span class="hljs-keyword">import</span> com.lagou.eduadboot.entity.PromotionAd;<br><span class="hljs-keyword">import</span> com.lagou.eduadboot.service.AdService;<br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;<br><span class="hljs-keyword">import</span> com.lagou.eduadboot.mapper.AdDao;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AdService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AdDao adDao;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;PromotionAd&gt; <span class="hljs-title function_">getAdsBySpaceId</span><span class="hljs-params">(Integer sid)</span>&#123;<br>        QueryWrapper&lt;PromotionAd&gt; qw = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();<br>        qw.eq(<span class="hljs-string">&quot;space_id&quot;</span>, sid); <span class="hljs-comment">// where comment_id = #&#123;cid&#125;</span><br>        <span class="hljs-keyword">return</span> adDao.selectList(qw);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>controller</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.lagou.eduadboot.controller;<br><br><span class="hljs-keyword">import</span> com.lagou.eduadboot.entity.PromotionAd;<br><span class="hljs-keyword">import</span> com.lagou.eduadboot.service.AdService;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<br><br><span class="hljs-keyword">import</span> java.util.List;<br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;ad&quot;)</span><br><span class="hljs-meta">@CrossOrigin</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AdController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AdService adService;<br><br>    <span class="hljs-meta">@GetMapping(&quot;getAdsBySpaceId/&#123;spaceid&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> List&lt;PromotionAd&gt; <span class="hljs-title function_">getAdsBySpaceId</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;spaceid&quot;)</span> Integer sid)</span>&#123;<br>        List&lt;PromotionAd&gt; list = adService.getAdsBySpaceId(sid);<br>        <span class="hljs-keyword">return</span> list;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>application.yml</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8001</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">edu-ad-boot</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.204.141:3306/edu_ad?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=UTC</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123123</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:7001/eureka/</span><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">prefer-ip-address:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">instance-id:</span> <span class="hljs-string">$&#123;spring.cloud.client.ip-address&#125;:$&#123;server.port&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>启动类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableEurekaClient</span> <span class="hljs-comment">// 注册到中心的客户端</span><br><span class="hljs-meta">@MapperScan(&quot;com.lagou.eduadboot.mapper&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EduAdBootApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(EduAdBootApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h3 id="前端"><a href="#前端" class="headerlink" title="前端"></a>前端</h3><ul>
<li>使用Element-UI的轮播组件展示广告：<a target="_blank" rel="noopener" href="https://element.faas.ele.me/#/zh-CN/component/installation">https://element.faas.ele.me/#/zh-CN/component/installation</a></li>
</ul>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">Header</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">Header</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--广告--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot; width:1200px; margin:0px auto; margin-top:20px;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-carousel</span> <span class="hljs-attr">indicator-position</span>=<span class="hljs-string">&quot;outside&quot;</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">el-carousel-item</span> <span class="hljs-attr">v-for</span>=<span class="hljs-string">&quot;(item , index) in adList&quot;</span> <span class="hljs-attr">:key</span>=<span class="hljs-string">&quot;index&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">a</span> <span class="hljs-attr">:href</span>=<span class="hljs-string">&quot;item.link&quot;</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">:src</span>=<span class="hljs-string">&quot;item.img&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&#x27;width: 100%;height: 100%;object-fit: cover;&#x27;</span>/&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">a</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">el-carousel-item</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">el-carousel</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><br><span class="hljs-comment">&lt;!--容器--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width: 1200PX; min-height:500px; margin:0px auto;&quot;</span>&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs js"> <span class="hljs-title function_">created</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getAdList</span>();<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-attr">methods</span>: &#123;<br><span class="hljs-comment">// 获取顶部轮播广告</span><br>    <span class="hljs-title function_">getAdList</span>(<span class="hljs-params"></span>)&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">axios</span><br>      .<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;http://localhost:8001/ad/getAdsBySpaceId/&quot;</span>+<span class="hljs-number">1</span>)<br>      .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> &#123;<br>        <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result);<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">adList</span> = result.<span class="hljs-property">data</span>;<br>      &#125;).<span class="hljs-title function_">catch</span>( <span class="hljs-function">(<span class="hljs-params">error</span>)=&gt;</span>&#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;获取轮播广告失败！&quot;</span>);<br>      &#125; );<br>    &#125;,<br>&#125;<br></code></pre></td></tr></table></figure>

<h3 id="首页侧面广告"><a href="#首页侧面广告" class="headerlink" title="首页侧面广告"></a>首页侧面广告</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!--微信连接--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:330px; height:350px; display: inline-block; float:right; border:1px solid red;&quot;</span> &gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;title&quot;</span>&gt;</span>精选文章<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;article-content&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;split-line&quot;</span>  <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;margin-bottom:20px;&quot;</span>   &gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">span</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;split-word&quot;</span>&gt;</span>还可以在这里找到我们<span class="hljs-tag">&lt;/<span class="hljs-name">span</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">ul</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;social-list&quot;</span> &gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;social-item&quot;</span>  &gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;qr-wrapper&quot;</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;qr-wrapper&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;display: none;&quot;</span> @<span class="hljs-attr">mouseout</span>=<span class="hljs-string">&quot;hideqr()&quot;</span>&gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">img</span>  <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;../assets/wechat-qr.47ac3f5.png&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;二维码&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;qr-wrapper-img&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">img</span> @<span class="hljs-attr">mouseover</span>=<span class="hljs-string">&quot;showqr()&quot;</span>  <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;图1&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;微信&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;social-item-img&quot;</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;social-name&quot;</span>&gt;</span>微信<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;social-item hover-pointer&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;gozhihu()&quot;</span> &gt;</span><br>          <span class="hljs-tag">&lt;<span class="hljs-name">img</span>  <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;图2&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;知乎&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;social-item-img&quot;</span>&gt;</span> <br>          <span class="hljs-tag">&lt;<span class="hljs-name">p</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;social-name&quot;</span>&gt;</span>知乎<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">li</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;social-item hover-pointer&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;gowb()&quot;</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">img</span>  <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;图3&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;微博&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;social-item-img&quot;</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">p</span>  <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;social-name&quot;</span>&gt;</span>微博<span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">li</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">ul</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 显示微信公众号二维码</span><br><span class="hljs-title function_">showqr</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;qr-wrapper&quot;</span>).<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">&quot;block&quot;</span>;<br>&#125;,<br><span class="hljs-comment">// 隐藏微信公众号二维码</span><br><span class="hljs-title function_">hideqr</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;qr-wrapper&quot;</span>).<span class="hljs-property">style</span>.<span class="hljs-property">display</span> = <span class="hljs-string">&quot;none&quot;</span>;<br>&#125;,<br><span class="hljs-comment">// 跳转到知乎</span><br><span class="hljs-title function_">gozhihu</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(<span class="hljs-string">&#x27;https://www.zhihu.com/org/la-gou-kai-wu-xun-lian-ying&#x27;</span>);<br>&#125;,<br><span class="hljs-comment">// 跳转到微博</span><br><span class="hljs-title function_">gowb</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(<span class="hljs-string">&#x27;https://weibo.com/p/1006066707072494/home?from=page_100606&amp;mod=TAB&amp;is_hot=1#place&#x27;</span>);<br>&#125;,<br></code></pre></td></tr></table></figure>



<h2 id="网关微服务：9001"><a href="#网关微服务：9001" class="headerlink" title="网关微服务：9001"></a>网关微服务：<font style='color:red;'>9001</font></h2><p>edu-gateway-boot：网关微服务：<font style='color:red;'>9001</font></p>
<ul>
<li>你想吃到饺子馅，得先吃饺子皮</li>
<li>每个提供服务的url如果都暴露出来的话，不安全。我们应该采用一种转发的形式来提供统一的url，将具体的服务url隐藏</li>
<li>在父工程下通过spring初始化器创建新模块，不需要引入任何提供的依赖，而是手动修改依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.lagou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>edu-lagou<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.lagou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>edu-gateway-boot<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>edu-gateway-boot<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- eureka 客户端 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--GateWay 网关--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-gateway<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--引入webflux--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-webflux<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br><br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableEurekaClient</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EduGatewayBootApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(EduGatewayBootApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">9001</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:7001/eureka</span><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">prefer-ip-address:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">instance-id:</span> <span class="hljs-string">$&#123;spring.cloud.client.ip-address&#125;:$&#123;server.port&#125;</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">edu-gateway-boot</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">edu-routes-ad</span> <span class="hljs-comment"># 路由名</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://edu-ad-boot</span>  <span class="hljs-comment"># 去注册中心查找的微服务名</span><br>          <span class="hljs-attr">predicates:</span> <span class="hljs-comment"># 当断言成功后，交给某一个微服务处理时使用的是转发</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/ad/**</span><br>          <span class="hljs-attr">filters:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">StripPrefix=1</span>   <span class="hljs-comment"># 去掉uri中的第一部分</span><br></code></pre></td></tr></table></figure>

<p>测试1：<a target="_blank" rel="noopener" href="http://localhost:9001/ad/ad/getAdsBySpaceId/1">http://localhost:9001/ad/ad/getAdsBySpaceId/1</a></p>
<p>配置多个微服务</p>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">edu-gateway-boot</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">gateway:</span><br>      <span class="hljs-attr">routes:</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">edu-routes-course</span> <br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://edu-course-boot</span>  <br>          <span class="hljs-attr">predicates:</span> <br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/course/**</span><br>          <span class="hljs-attr">filters:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">StripPrefix=1</span>   <br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">edu-routes-comment</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://edu-comment-boot</span><br>          <span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/comment/**</span><br>          <span class="hljs-attr">filters:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">StripPrefix=1</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">edu-routes-order</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://edu-order-boot</span><br>          <span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/order/**</span><br>          <span class="hljs-attr">filters:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">StripPrefix=1</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">edu-routes-pay</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://edu-pay-boot</span><br>          <span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/pay/**</span><br>          <span class="hljs-attr">filters:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">StripPrefix=1</span><br>        <span class="hljs-bullet">-</span> <span class="hljs-attr">id:</span> <span class="hljs-string">edu-routes-user</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">lb://edu-user-boot</span><br>          <span class="hljs-attr">predicates:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">Path=/user/**</span><br>          <span class="hljs-attr">filters:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">StripPrefix=1</span><br></code></pre></td></tr></table></figure>





<hr>
<h1 id="03-单点登录（SSO）"><a href="#03-单点登录（SSO）" class="headerlink" title="03 单点登录（SSO）"></a>03 单点登录（SSO）</h1><h2 id="1、概述"><a href="#1、概述" class="headerlink" title="1、概述"></a>1、概述</h2><ul>
<li>传统的单体架构项目，我们将登陆信息保存在session中，需要的获取getSession就可以了，但是要知道session是属于服务器的，也就是一个tomcat对应一个session</li>
<li>当我们做分布式集群架构的项目时，tomcat多个，session就对应多个，那在tomcat1中保存的用户信息，在tomcat3中就获取不到了</li>
<li>所以，session做是否登录的验证并不全面</li>
<li>而且，我们发现一个有意思的事情</li>
</ul>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210214133410732.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>要知道，两个网站的网址分别是：<a target="_blank" rel="noopener" href="https://www.taobao.com/">https://www.taobao.com</a> 和 <a target="_blank" rel="noopener" href="https://www.tmall.com,域名完全不一样,是如何做到一次登录,两个系统都登录呢!/">https://www.tmall.com，域名完全不一样，是如何做到一次登录，两个系统都登录呢！</a></li>
<li>原因是“阿里巴巴”专门为这些应用搭建了一个“登录身份认证中心”，无论谁登录，都要得到这个中心统一颁发的“令牌”，方可成功</li>
<li>搭建“颁发令牌的中心”的解决方案，我们就叫做“单点登录系统”</li>
<li>单点登录全称 Single Sign On（以下简称SSO），是指在多系统应用群中登录一个系统，便可在其他所有系统中得到授权而无需再次登录，包括单点登录与单点注销两部分</li>
</ul>
<h2 id="2、流程详述"><a href="#2、流程详述" class="headerlink" title="2、流程详述"></a>2、流程详述</h2><ol>
<li>接收用户名和密码</li>
<li>验证用户名和密码</li>
<li>生成token（使用JWT），将用户信息写到token中</li>
<li>把token写到redis中，并设置过期时间</li>
<li>把token返回给客户端，并写到cookie中</li>
<li>客户端每次打开浏览器都会从cookie中获取token，然后去sso校验token（是否存在或是否正确）</li>
</ol>
<p><strong>详情参考下图：</strong></p>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210224173221295.png" srcset="/img/loading.gif" lazyload alt="image-20210224173221295"></p>
<h2 id="3、JWT"><a href="#3、JWT" class="headerlink" title="3、JWT"></a>3、JWT</h2><p>Json Web Token，基于json格式信息一种token令牌。</p>
<p>JWT token 包含三部分，第一部分header、第二部分payload、第三部分签证</p>
<ol>
<li><p><strong>第一部分</strong>：利用base64算法处理json信息，作为token第一部分</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>	typ<span class="hljs-punctuation">:</span> jwt<span class="hljs-punctuation">,</span><br>	alg<span class="hljs-punctuation">:</span> HS256<br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>


</li>
<li><p><strong>第二部分</strong>：利用base64算法处理json信息，作为token第二部分，可存放用户的各项信息</p>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs json"><span class="hljs-punctuation">&#123;</span><br>	exp<span class="hljs-punctuation">:</span>xxx<span class="hljs-punctuation">,</span><br>	uid<span class="hljs-punctuation">:</span>xxx<span class="hljs-punctuation">,</span><br>	name<span class="hljs-punctuation">:</span>xxx<br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>


</li>
<li><p><strong>第三部分</strong>：将“<strong>第一部分</strong>.<strong>第二部分</strong>”，然后调用header中指定的alg算法HS256进行加密处理。（需要一个secret秘钥，不对外公开）,作为第三部分结果</p>
</li>
</ol>
<p>例如：</p>
<pre><code class="hljs">eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJwYXNzd29yZCI6IjEiLCJuaWNrbmFtZSI6IuW5sumlreS6uiIsInBvcnRyYWl0IjoiaHR0cDovLzE5Mi4xNjguMjA0LjE0MS9ncm91cDEvTTAwLzAwLzAwL3dLak1qV0FhWVJxQVJ0TWxBQVdJQ2ZRbkh1azk2MS5qcGciLCJleHAiOjE2MTMyMDI0MDksInVzZXJpZCI6MTAwMDMwMDI0fQ.s38sQnGe9Eybr8hfcFuJyDIg-tHpQo7vgRDAStthuRc
</code></pre>
<h2 id="4、核心代码"><a href="#4、核心代码" class="headerlink" title="4、核心代码"></a>4、核心代码</h2><p><strong>edu-authority-boot：认证微服务：<font style='color:red;'>8003</font></strong></p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.lagou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>edu-lagou<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>edu-authority-boot<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>edu-authority-boot<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- web --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- eureka客户端 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>		<span class="hljs-comment">&lt;!-- mybatis plus --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- mysql --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--pojo持久化使用--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.persistence<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.persistence-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--自动getset--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--jwt--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.auth0<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>java-jwt<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.8.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>		<span class="hljs-comment">&lt;!--redis--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>实体类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span>  <span class="hljs-comment">//get和set都全部生成了</span><br><span class="hljs-meta">@Table(name=&quot;user&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">User</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> -<span class="hljs-number">89788707895046947L</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 用户id</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-comment">//@Id</span><br>    <span class="hljs-meta">@TableId(type = IdType.AUTO)</span><br>    <span class="hljs-keyword">private</span> Integer id;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 用户昵称</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String name;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 用户头像地址</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String portrait;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 注册手机</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String phone;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 用户密码（可以为空，支持只用验证码注册、登录）</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String password;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 注册ip</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String regIp;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 是否有效用户</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Object accountNonExpired;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 账号是否未过期</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Object credentialsNonExpired;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 是否未锁定</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Object accountNonLocked;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 用户状态：ENABLE能登录，DISABLE不能登录</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> String status;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 是否删除</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Object isDel;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 注册时间</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Date createTime;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 记录更新时间</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">private</span> Date updateTime;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@ToString</span><br><span class="hljs-comment">// 数据传输对象（DTO) Data Transfer Object</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserDTO</span>&lt;User&gt; <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">1L</span>;<br>    <span class="hljs-keyword">private</span> <span class="hljs-type">int</span> state;  <span class="hljs-comment">// 操作状态</span><br>    <span class="hljs-keyword">private</span> String message;  <span class="hljs-comment">// 状态描述</span><br>    <span class="hljs-keyword">private</span> User content;  <span class="hljs-comment">// 响应内容</span><br><br>    <span class="hljs-keyword">private</span> String token;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>常量类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">	常量内容说明</span><br><span class="hljs-comment">*/</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EduConstant</span> &#123;<br><br>    <span class="hljs-comment">// 状态码</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">ERROR_NOT_FOUND_PHONE_CODE</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">ERROR_PASSWORD_CODE</span> <span class="hljs-operator">=</span> <span class="hljs-number">2</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">LOGIN_SUCCESS_CODE</span> <span class="hljs-operator">=</span> <span class="hljs-number">3</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">TOKEN_SUCCESS_CODE</span> <span class="hljs-operator">=</span> <span class="hljs-number">4</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">TOKEN_TIMEOUT_CDOE</span> <span class="hljs-operator">=</span> <span class="hljs-number">5</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">TOKEN_NULL_CODE</span> <span class="hljs-operator">=</span> <span class="hljs-number">6</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">Integer</span> <span class="hljs-variable">TOKEN_ERROR_CDOE</span> <span class="hljs-operator">=</span> <span class="hljs-number">7</span>;<br><br><br>	<span class="hljs-comment">// 状态描述</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">ERROR_NOT_FOUND_PHONE</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;该手机尚未注册&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">ERROR_PASSWORD</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;登录失败，帐号密码不匹配&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">LOGIN_SUCCESS</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;登录成功&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">TOKEN_SUCCESS</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;令牌校验通过&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">TOKEN_TIMEOUT</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;令牌过期&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">TOKEN_ERROR1</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;令牌格式错误！或为空令牌&quot;</span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">TOKEN_ERROR2</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;校验失败,token令牌就是错误的&quot;</span>;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<ul>
<li>封装好的jwt工具类 JwtUtil.java</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.lagou.eduauthorityboot.tools;<br><br><span class="hljs-keyword">import</span> java.util.Date;<br><span class="hljs-keyword">import</span> java.util.HashMap;<br><span class="hljs-keyword">import</span> java.util.Map;<br><br><span class="hljs-keyword">import</span> com.auth0.jwt.JWT;<br><span class="hljs-keyword">import</span> com.auth0.jwt.algorithms.Algorithm;<br><span class="hljs-keyword">import</span> com.auth0.jwt.exceptions.JWTDecodeException;<br><span class="hljs-keyword">import</span> com.auth0.jwt.exceptions.JWTVerificationException;<br><span class="hljs-keyword">import</span> com.auth0.jwt.exceptions.TokenExpiredException;<br><span class="hljs-keyword">import</span> com.auth0.jwt.interfaces.DecodedJWT;<br><span class="hljs-keyword">import</span> com.auth0.jwt.interfaces.JWTVerifier;<br><span class="hljs-keyword">import</span> com.lagou.eduauthorityboot.entity.User;<br><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">JwtUtil</span> &#123;<br>	<br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">EXPIRE_TIME</span> <span class="hljs-operator">=</span> <span class="hljs-number">15</span> * <span class="hljs-number">60</span> * <span class="hljs-number">1000</span>;<br>	<span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">String</span> <span class="hljs-variable">TOKEN_SECRET</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;laosunshigedashuaige666&quot;</span>;  <span class="hljs-comment">//secret秘钥：自定义</span><br>	<br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * 生成签名，15分钟过期</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> **username**</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> **password**</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">createToken</span><span class="hljs-params">(User user)</span> &#123;<br>	    <span class="hljs-keyword">try</span> &#123;<br>	        <span class="hljs-comment">// 设置过期时间</span><br>	        <span class="hljs-type">Date</span> <span class="hljs-variable">date</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>(System.currentTimeMillis() + EXPIRE_TIME);<br>	        <span class="hljs-comment">// 私钥和加密算法</span><br>	        <span class="hljs-type">Algorithm</span> <span class="hljs-variable">algorithm</span> <span class="hljs-operator">=</span> Algorithm.HMAC256(TOKEN_SECRET);<br>	        <span class="hljs-comment">// 设置头部信息</span><br>	        Map&lt;String, Object&gt; header = <span class="hljs-keyword">new</span> <span class="hljs-title class_">HashMap</span>&lt;&gt;(<span class="hljs-number">2</span>);<br>	        header.put(<span class="hljs-string">&quot;typ&quot;</span>, <span class="hljs-string">&quot;JWT&quot;</span>);<br>	        header.put(<span class="hljs-string">&quot;alg&quot;</span>, <span class="hljs-string">&quot;HS256&quot;</span>);<br>	        <span class="hljs-comment">// 返回token字符串</span><br>	        <span class="hljs-keyword">return</span> JWT.create()<br>	                .withHeader(header)  <span class="hljs-comment">// 第一部分</span><br>	                .withClaim(<span class="hljs-string">&quot;nickname&quot;</span>, user.getName())  <span class="hljs-comment">// 第二部分</span><br>	                .withClaim(<span class="hljs-string">&quot;userid&quot;</span>, user.getId())<br>					.withClaim(<span class="hljs-string">&quot;password&quot;</span>, user.getPassword())<br>					.withClaim(<span class="hljs-string">&quot;portrait&quot;</span>, user.getPortrait())<br>	                .withExpiresAt(date)    <span class="hljs-comment">//设置过期时间</span><br>	                .sign(algorithm);   <span class="hljs-comment">// 第三部分</span><br>	    &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>	        e.printStackTrace();<br>	        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>	    &#125;<br>	&#125;<br>	<br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 * 检验token是否正确</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> **token**</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">isVerify</span><span class="hljs-params">(String token)</span> &#123;<br>		<span class="hljs-keyword">try</span> &#123;<br>			<span class="hljs-type">Algorithm</span> <span class="hljs-variable">algorithm</span> <span class="hljs-operator">=</span> Algorithm.HMAC256(TOKEN_SECRET); <span class="hljs-comment">//使用HMAC256加密算法，生成签名</span><br>			<span class="hljs-type">JWTVerifier</span> <span class="hljs-variable">verifier</span> <span class="hljs-operator">=</span> JWT.require(algorithm).build();<br>			verifier.verify(token); <span class="hljs-comment">// 解析token</span><br>			<span class="hljs-keyword">return</span> <span class="hljs-number">0</span>;<span class="hljs-comment">// 校验通过</span><br>		&#125; <span class="hljs-keyword">catch</span> (TokenExpiredException e) &#123;<br>			e.printStackTrace();<br>            System.out.println(<span class="hljs-string">&quot;令牌过期&quot;</span>);<br>			<span class="hljs-keyword">return</span> <span class="hljs-number">1</span>; <span class="hljs-comment">// 令牌过期</span><br>		&#125; <span class="hljs-keyword">catch</span> (JWTDecodeException e) &#123;<br>			e.printStackTrace();<br>            System.out.println(<span class="hljs-string">&quot;令牌格式错误！或为空令牌！&quot;</span>);<br>			<span class="hljs-keyword">return</span> <span class="hljs-number">2</span>;<span class="hljs-comment">// 校验失败,token令牌就是错误的</span><br>		&#125; <span class="hljs-keyword">catch</span> (JWTVerificationException e) &#123;<br>			e.printStackTrace();<br>			System.out.println(<span class="hljs-string">&quot;校验失败,token令牌就是错误的&quot;</span>);<br>			<span class="hljs-keyword">return</span> <span class="hljs-number">3</span>;<span class="hljs-comment">// 校验失败,token令牌就是错误的</span><br>		&#125;<br>	&#125;<br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 *从token解析出 用户编号 信息</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> token</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-type">int</span> <span class="hljs-title function_">parseTokenUserid</span><span class="hljs-params">(String token)</span> &#123;<br>		<span class="hljs-type">DecodedJWT</span> <span class="hljs-variable">jwt</span> <span class="hljs-operator">=</span> JWT.decode(token);<br>		<span class="hljs-keyword">return</span> jwt.getClaim(<span class="hljs-string">&quot;userid&quot;</span>).asInt();<br>	&#125;<br>	<br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 *从token解析出 昵称 信息</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> token</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">parseTokenNickname</span><span class="hljs-params">(String token)</span> &#123;<br>		<span class="hljs-type">DecodedJWT</span> <span class="hljs-variable">jwt</span> <span class="hljs-operator">=</span> JWT.decode(token);<br>		<span class="hljs-keyword">return</span> jwt.getClaim(<span class="hljs-string">&quot;nickname&quot;</span>).asString();<br>	&#125;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 *从token解析出 头像 信息</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> token</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">parseTokenPortrait</span><span class="hljs-params">(String token)</span> &#123;<br>		<span class="hljs-type">DecodedJWT</span> <span class="hljs-variable">jwt</span> <span class="hljs-operator">=</span> JWT.decode(token);<br>		<span class="hljs-keyword">return</span> jwt.getClaim(<span class="hljs-string">&quot;portrait&quot;</span>).asString();<br>	&#125;<br><br>	<span class="hljs-comment">/**</span><br><span class="hljs-comment">	 *从token解析出 密码 信息</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@param</span> token</span><br><span class="hljs-comment">	 * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">	 */</span><br>	<span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String <span class="hljs-title function_">parseTokenPassword</span><span class="hljs-params">(String token)</span> &#123;<br>		<span class="hljs-type">DecodedJWT</span> <span class="hljs-variable">jwt</span> <span class="hljs-operator">=</span> JWT.decode(token);<br>		<span class="hljs-keyword">return</span> jwt.getClaim(<span class="hljs-string">&quot;password&quot;</span>).asString();<br>	&#125;<br>	<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>controller</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;user&quot;)</span><br><span class="hljs-meta">@CrossOrigin</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AuthorityContoller</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br><br>    <span class="hljs-meta">@GetMapping(&quot;login&quot;)</span><br>    <span class="hljs-keyword">public</span> UserDTO <span class="hljs-title function_">login</span><span class="hljs-params">(String phone, String password)</span>&#123;<br>        <span class="hljs-type">UserDTO</span> <span class="hljs-variable">dto</span> <span class="hljs-operator">=</span> userService.login(phone, password);<br>        <span class="hljs-keyword">return</span> dto;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;checkToken&quot;)</span><br>    <span class="hljs-keyword">public</span> UserDTO <span class="hljs-title function_">checkToken</span><span class="hljs-params">(String token)</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;待校验的token = &quot;</span> + token);<br>        <span class="hljs-type">UserDTO</span> <span class="hljs-variable">dto</span> <span class="hljs-operator">=</span> userService.checkToken(token);<br>        <span class="hljs-keyword">return</span> dto;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>service<ul>
<li>登录的两种方案：</li>
<li>1、将帐号和密码同时传入到数据库进行匹配</li>
<li>2、先传入帐号匹配，成功的话，再验证密码</li>
</ul>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate&lt;Object,Object&gt; redisTemplate;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> UserDTO <span class="hljs-title function_">login</span><span class="hljs-params">(String phone, String password)</span> &#123;<br>        <span class="hljs-type">UserDTO</span> <span class="hljs-variable">dto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDTO</span>();<br>        <span class="hljs-comment">// 创建条件构造</span><br>        QueryWrapper&lt;User&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>();<br>        <span class="hljs-comment">// 编写具体的查询条件</span><br>        queryWrapper.eq(<span class="hljs-string">&quot;phone&quot;</span>, phone);<br><br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">i1</span> <span class="hljs-operator">=</span> userMapper.selectCount(queryWrapper);<br>        <span class="hljs-keyword">if</span>(i1 == <span class="hljs-number">0</span>)&#123;  <span class="hljs-comment">// 手机号不存在</span><br>            dto.setState(EduConstant.ERROR_NOT_FOUND_PHONE_CODE);<br>            dto.setMessage(EduConstant.ERROR_NOT_FOUND_PHONE);<br>            dto.setContent(<span class="hljs-literal">null</span>);<br>            <span class="hljs-keyword">return</span> dto;<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            queryWrapper.eq(<span class="hljs-string">&quot;password&quot;</span>, password);<br>            <span class="hljs-comment">// 调用mp的查询方法selectOne</span><br>            <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userMapper.selectOne(queryWrapper);<br>            <span class="hljs-keyword">if</span>(user == <span class="hljs-literal">null</span>)&#123; <span class="hljs-comment">// 帐号密码不匹配</span><br>                dto.setState(EduConstant.ERROR_PASSWORD_CODE);<br>                dto.setMessage(EduConstant.ERROR_PASSWORD);<br>                dto.setContent(<span class="hljs-literal">null</span>);<br>                <span class="hljs-keyword">return</span> dto;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-comment">// 登录成功</span><br>                dto.setState(EduConstant.LOGIN_SUCCESS_CODE);<br>                dto.setMessage(EduConstant.LOGIN_SUCCESS);<br>                <span class="hljs-comment">//dto.setContent(user);</span><br>                <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> JwtUtil.createToken(user);<br>                dto.setToken(token);<br><br>                <span class="hljs-comment">// 将token和用户信息存在redis中</span><br>                redisTemplate.opsForValue().set(token, token,<span class="hljs-number">15</span>, TimeUnit.SECONDS);<br>                System.out.println(<span class="hljs-string">&quot;token = &quot;</span> + token);<br>                <span class="hljs-keyword">return</span> dto;<br>            &#125;<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> UserDTO <span class="hljs-title function_">checkToken</span><span class="hljs-params">(String token)</span>&#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> JwtUtil.isVerify(token);<br>        <span class="hljs-type">UserDTO</span> <span class="hljs-variable">dto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDTO</span>();<br>        <span class="hljs-keyword">if</span>(i == <span class="hljs-number">0</span>)&#123;<br>            dto.setState(EduConstant.TOKEN_SUCCESS_CODE);<br>            dto.setMessage(EduConstant.TOKEN_SUCCESS);<br>            <span class="hljs-comment">// 校验通过，重新设置过期时间</span><br>            redisTemplate.opsForValue().set(token, token,<span class="hljs-number">15</span>*<span class="hljs-number">1000</span>, TimeUnit.SECONDS);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(i == <span class="hljs-number">1</span>)&#123;<br>            dto.setState(EduConstant.TOKEN_TIMEOUT_CDOE);<br>            dto.setMessage(EduConstant.TOKEN_TIMEOUT);<br>        &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(i == <span class="hljs-number">2</span>)&#123;<br>            dto.setState(EduConstant.TOKEN_NULL_CODE);<br>            dto.setMessage(EduConstant.TOKEN_ERROR1);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            dto.setState(EduConstant.TOKEN_ERROR_CDOE);<br>            dto.setMessage(EduConstant.TOKEN_ERROR2);<br>        &#125;<br>        <span class="hljs-keyword">return</span> dto;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>mapper</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;User&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>yml</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-comment"># 服务端口号</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8003</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-comment"># 服务名称 - 服务之间使用名称进行通讯</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">edu-authority-boot</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.204.141:3306/edu_user?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=UTC</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123123</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.204</span><span class="hljs-number">.141</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-comment"># 填写注册中心服务器地址</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:7001/eureka</span><br>    <span class="hljs-comment"># 是否需要将自己注册到注册中心</span><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-comment"># 是否需要搜索服务信息</span><br>    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-comment"># 使用ip地址注册到注册中心</span><br>    <span class="hljs-attr">prefer-ip-address:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-comment"># 注册中心列表中显示的状态参数</span><br>    <span class="hljs-attr">instance-id:</span> <span class="hljs-string">$&#123;spring.cloud.client.ip-address&#125;:$&#123;server.port&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>启动类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableEurekaClient</span> <span class="hljs-comment">// 注册到中心的客户端</span><br><span class="hljs-meta">@MapperScan(&quot;com.lagou.eduauthorityboot.mapper&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EduAuthorityBootApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(EduAuthorityBootApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="5、前端联调"><a href="#5、前端联调" class="headerlink" title="5、前端联调"></a>5、前端联调</h2><ul>
<li>vue中解析token</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apl">npm install jwt-decode --save<br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> jwtDecode <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;jwt-decode&#x27;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">const</span> code = <span class="hljs-title function_">jwtDecode</span>(result.<span class="hljs-property">data</span>.<span class="hljs-property">token</span>);<br><span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>( code );<br></code></pre></td></tr></table></figure>

<ul>
<li>vue中使用cookie</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">//设置cookie</span><br><span class="hljs-title function_">setCookie</span>(<span class="hljs-params">key,value,expires</span>)&#123;<br>  <span class="hljs-keyword">var</span> exp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br>  exp.<span class="hljs-title function_">setTime</span>(exp.<span class="hljs-title function_">getTime</span>() + expires*<span class="hljs-number">1000</span>);<br>  <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span> = key + <span class="hljs-string">&quot;=&quot;</span> + <span class="hljs-built_in">escape</span> (value) + <span class="hljs-string">&quot;;expires=&quot;</span> + exp.<span class="hljs-title function_">toGMTString</span>();<br>&#125;,<br><span class="hljs-comment">//从cookie中获取token</span><br><span class="hljs-title function_">getCookie</span>(<span class="hljs-params">key</span>)&#123;<br>  <span class="hljs-keyword">var</span> name = key + <span class="hljs-string">&quot;=&quot;</span>;<br>  <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;;&#x27;</span>) &gt; <span class="hljs-number">0</span>)&#123;<br>    <span class="hljs-keyword">var</span> ca = <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;;&#x27;</span>);<br>    <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;ca.<span class="hljs-property">length</span>; i++) &#123;<br>        <span class="hljs-keyword">var</span> c = ca[i].<span class="hljs-title function_">trim</span>();<br>        <span class="hljs-keyword">if</span> (c.<span class="hljs-title function_">indexOf</span>(name)==<span class="hljs-number">0</span>) &#123; <br>          <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">substring</span>(name.<span class="hljs-property">length</span>,c.<span class="hljs-property">length</span>); <br>        &#125;<br>    &#125;<br>  &#125;<br>  <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setCookie</span>(key,value,expires);<span class="hljs-comment">// 保存cookie</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setCookie</span>(<span class="hljs-string">&quot;user&quot;</span>,result.<span class="hljs-property">data</span>.<span class="hljs-property">token</span>,<span class="hljs-number">60</span>);<br>-------------------------------------------------------------<br><span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCookie</span>(key); <span class="hljs-comment">// 取出cookie</span><br><span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCookie</span>(<span class="hljs-string">&quot;user&quot;</span>);<br></code></pre></td></tr></table></figure>

<p>如果是多域名的分布式系统，记得要在去往sso验证之前，吧当前访问的域名url当参数传过去，否则sso不知道你是从哪里来的，也就无法跳回去！</p>
<p>例如：从<a href="http://www.aaa.com前往sso，和www.bbb.com前往sso，sso验证通过之后要调回进入时的页面，到底是a？还是b？">www.aaa.com前往sso，和www.bbb.com前往sso，sso验证通过之后要调回进入时的页面，到底是a？还是b？</a></p>
<p>所以我们前往sso的时候，就要这样写条状url：<a target="_blank" rel="noopener" href="http://192.168.1.1:8010/user?param=www.aaa.com">http://192.168.1.1:8010/user?param=www.aaa.com</a></p>
<h2 id="6、微信扫码登录改造"><a href="#6、微信扫码登录改造" class="headerlink" title="6、微信扫码登录改造"></a>6、微信扫码登录改造</h2><figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.47<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>



<ul>
<li><p>commons</p>
<ul>
<li>HttpClientUtil.java</li>
</ul>
</li>
<li><p>entity</p>
<ul>
<li>Token.java</li>
<li>WxUser.java</li>
</ul>
</li>
<li><p>controller</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;user&quot;)</span><br><span class="hljs-meta">@CrossOrigin</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WxLoginController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span> <span class="hljs-comment">// 自定注入</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br>    <br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate&lt;Object,Object&gt; redisTemplate;<br><br>    <span class="hljs-meta">@GetMapping(&quot;wxlogin&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">wxlogin</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> ServletException, IOException &#123;<br>        <span class="hljs-comment">// 1. 微信官方发给我们一个临时凭证</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">code</span> <span class="hljs-operator">=</span> request.getParameter(<span class="hljs-string">&quot;code&quot;</span>);<br>        System.out.println(<span class="hljs-string">&quot;【临时凭证】code = &quot;</span> + code);<br>        <span class="hljs-comment">// 2. 通过code，去微信官方申请一个正式的token（令牌）</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">getTokenByCode_url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://api.weixin.qq.com/sns/oauth2/access_token?appid=wxd99431bbff8305a0&amp;secret=60f78681d063590a469f1b297feff3c4&amp;code=&quot;</span> + code + <span class="hljs-string">&quot;&amp;grant_type=authorization_code&quot;</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">tokenString</span> <span class="hljs-operator">=</span> HttpClientUtil.doGet(getTokenByCode_url);<br>        System.out.println(<span class="hljs-string">&quot;tokenString = &quot;</span> + tokenString);<br>        <span class="hljs-comment">// 将json格式的token字符串转换成实体对象，方便存和取</span><br>        <span class="hljs-type">Token</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> JSON.parseObject(tokenString, Token.class);<br><br>        <span class="hljs-comment">// 3. 通过token，去微信官方获取用户的信息</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">getUserByToken_url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://api.weixin.qq.com/sns/userinfo?access_token=&quot;</span> + token.getAccess_token() + <span class="hljs-string">&quot;&amp;openid=&quot;</span> + token.getOpenid();<br>        <span class="hljs-type">String</span> <span class="hljs-variable">userinfoString</span> <span class="hljs-operator">=</span> HttpClientUtil.doGet(getUserByToken_url);<br>        System.out.println(<span class="hljs-string">&quot;userinfoString = &quot;</span> + userinfoString);<br>        <span class="hljs-comment">// 将json格式的user字符串转换成实体对象，方便存和取</span><br>        <span class="hljs-type">WxUser</span> <span class="hljs-variable">wxUser</span> <span class="hljs-operator">=</span> JSON.parseObject(userinfoString, WxUser.class);<br>        System.out.println(<span class="hljs-string">&quot;微信昵称 = &quot;</span> + wxUser.getNickname());<br>        System.out.println(<span class="hljs-string">&quot;微信头像 = &quot;</span> + wxUser.getHeadimgurl());<br><br>        <span class="hljs-comment">// 拉勾的业务流程！ 需要 手机号（wxUser.getUnionid()）和密码（wxUser.getUnionid()）,头像和昵称</span><br><br>        <span class="hljs-type">UserDTO</span> <span class="hljs-variable">dto</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-comment">// 检测手机号是否注册</span><br>        dto = userService.login(wxUser.getUnionid(), wxUser.getUnionid());<br>        <span class="hljs-keyword">if</span>(dto.getState == EduConstant.ERROR_NOT_FOUND_PHONE_CODE)&#123;<br>            <span class="hljs-comment">// 未注册，先自动注册</span><br>            userService.register(wxUser.getUnionid(), wxUser.getUnionid(),wxUser.getNickname(),wxUser.getHeadimgurl());<br>            <span class="hljs-comment">// 再次登录</span><br>            dto = userService.login(wxUser.getUnionid(), wxUser.getUnionid());<br>        &#125;<br><br>        response.sendRedirect(<span class="hljs-string">&quot;http://localhost:8080&quot;</span>);<br>        <span class="hljs-keyword">return</span> dto;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;logout&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">logout</span><span class="hljs-params">(String token)</span>&#123;<br>         redisTemplate.delete(token);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>


</li>
<li><p>service</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * 用户注册</span><br><span class="hljs-comment"> *</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> phone    手机号</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> password 密码</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> nickname 昵称</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@param</span> headimg 头像</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@return</span> 受影响的行数</span><br><span class="hljs-comment"> */</span><br>Integer <span class="hljs-title function_">register</span><span class="hljs-params">( String phone, String password,String nickname,String headimg)</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">register</span><span class="hljs-params">(String phone, String password, String nickname, String headimg)</span> &#123;<br>    <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>    user.setPhone(phone);<br>    user.setPassword(password);<br>    user.setName(nickname);<br>    user.setPortrait(headimg);<br>    <span class="hljs-keyword">return</span> userMapper.insert(user);<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>vue</p>
</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs js">  <span class="hljs-title function_">created</span>(<span class="hljs-params"></span>)&#123;<br>    <span class="hljs-keyword">let</span> token = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getValueByUrlParams</span>(<span class="hljs-string">&#x27;token&#x27;</span>);<br>    <span class="hljs-keyword">if</span>(token == <span class="hljs-literal">null</span> || token == <span class="hljs-string">&quot;&quot;</span>)&#123;<br>      <span class="hljs-comment">// 从cookie中获取user的token</span><br>     token = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCookie</span>(<span class="hljs-string">&quot;user&quot;</span>);<br>    &#125;<br>    <br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;刷新页面token=&gt;&quot;</span>+token);<br>    <span class="hljs-keyword">if</span>(token != <span class="hljs-literal">null</span> || token != <span class="hljs-string">&quot;&quot;</span>)&#123;<br>      <span class="hljs-comment">// 将token发送到sso进行校验</span><br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">axios</span><br>      .<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;http://localhost:80/user/checkToken&quot;</span>,&#123;<br>        <span class="hljs-attr">params</span>:&#123;<br>          <span class="hljs-attr">token</span>:token<br>        &#125;<br>      &#125;)<br>      .<span class="hljs-title function_">then</span>( <span class="hljs-function">(<span class="hljs-params">result</span>)=&gt;</span>&#123;<br>        <span class="hljs-keyword">if</span>(result.<span class="hljs-property">data</span>.<span class="hljs-property">state</span> == <span class="hljs-number">4</span>)&#123;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">isLogin</span> = <span class="hljs-literal">true</span>;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setCookie</span>(<span class="hljs-string">&quot;user&quot;</span>,token,<span class="hljs-number">600</span>);<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = <span class="hljs-title function_">jwtDecode</span>(token);<br>        &#125;<br>      &#125;)<br>      .<span class="hljs-title function_">catch</span>( <span class="hljs-function">(<span class="hljs-params">error</span>)=&gt;</span>&#123;<br>       &#125;);<br>    &#125;<br>    <br>--------------------------------------------<br><span class="hljs-title function_">getValueByUrlParams</span>(<span class="hljs-params">paras</span>) &#123;<br>    <span class="hljs-keyword">var</span> url = location.<span class="hljs-property">href</span>;<br>    <span class="hljs-keyword">var</span> paraString = url.<span class="hljs-title function_">substring</span>(url.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;?&quot;</span>) + <span class="hljs-number">1</span>, url.<span class="hljs-property">length</span>).<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;&amp;&quot;</span>);<br>    <span class="hljs-keyword">var</span> paraObj = &#123;&#125;<br>    <span class="hljs-keyword">var</span> i, j<br>    <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; j = paraString[i]; i++) &#123;<br>        paraObj[j.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, j.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;=&quot;</span>)).<span class="hljs-title function_">toLowerCase</span>()] = j.<span class="hljs-title function_">substring</span>(j.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;=&quot;</span>) + <span class="hljs-number">1</span>, j.<span class="hljs-property">length</span>);<br>    &#125;<br>    <span class="hljs-keyword">var</span> returnValue = paraObj[paras.<span class="hljs-title function_">toLowerCase</span>()];<br>    <span class="hljs-keyword">if</span> (<span class="hljs-title function_">typeof</span>(returnValue) == <span class="hljs-string">&quot;undefined&quot;</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>    &#125; <span class="hljs-keyword">else</span> &#123;<br>        <span class="hljs-keyword">return</span> returnValue;<br>    &#125;<br>&#125;,<br></code></pre></td></tr></table></figure>



<h2 id="7、短信验证码登录"><a href="#7、短信验证码登录" class="headerlink" title="7、短信验证码登录"></a>7、短信验证码登录</h2><ul>
<li><p>通过第三方短信平台向用户手机发出验证码，用户得到验证码进行登录</p>
</li>
<li><p>第三方平台，我们使用阿里云短信平台，使用手册<b style='color:blue'>《阿里云短信平台.docx》</b>（<a href="%E9%98%BF%E9%87%8C%E4%BA%91%E7%9F%AD%E4%BF%A1%E5%B9%B3%E5%8F%B0.docx" title=" 阿里云短信平台.docx">点击下载</a>）</p>
</li>
<li><p><b style='color:red'>注意</b>：阿里为了防止恶意高频发送验证码，加入了流量限制，当返回下面的结果就是这个原因：</p>
<p><b>{“RequestId”:”D0558EEE-8331-47F4-99B5-1B4A4148373A”,”Message”:”触发天级流控Permits:10”,”Code”:”isv.BUSINESS_LIMIT_CONTROL”}</b></p>
<blockquote>
<p>短信验证码 ：使用同一个签名，对同一个手机号码发送短信验证码，支持1条&#x2F;分钟，5条&#x2F;小时 ，累计10条&#x2F;天。</p>
<p>短信通知： 使用同一个签名和同一个短信模板ID，对同一个手机号码发送短信通知，支持50条&#x2F;日 </p>
</blockquote>
<ul>
<li>所以我们个人开发测试的时候，对一个手机发送验证码太多次，就发不过去了。换个手机号发送就可以了。</li>
<li>或者可以进入短信的管理后台调整流量频次</li>
</ul>
</li>
</ul>
<h3 id="7-1-发送验证码"><a href="#7-1-发送验证码" class="headerlink" title="7.1 发送验证码"></a>7.1 发送验证码</h3><ul>
<li>yml 注意：如果yml中有中文，必须修改文件为<b style='color:red'>UTF-8</b>，否则加载yml时报错</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">ali:</span><br>  <span class="hljs-attr">sms:</span><br>    <span class="hljs-attr">signName:</span> <span class="hljs-string">拉勾教育通知</span><br>    <span class="hljs-attr">templateCode:</span> <span class="hljs-string">SMS_xxx</span> <br>    <span class="hljs-attr">assessKeyId:</span> <span class="hljs-string">xxx</span><br>    <span class="hljs-attr">assessKeySecret:</span> <span class="hljs-string">xxx</span><br></code></pre></td></tr></table></figure>

<ul>
<li>pom</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.aliyun<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aliyun-java-sdk-core<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.5.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastjson<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.47<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>AuthorityContoller.java</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Value(&quot;$&#123;ali.sms.signName&#125;&quot;)</span><br><span class="hljs-keyword">private</span> String signName;<br><br><span class="hljs-meta">@Value(&quot;$&#123;ali.sms.templateCode&#125;&quot;)</span><br><span class="hljs-keyword">private</span> String templateCode;<br><br><span class="hljs-meta">@Value(&quot;$&#123;ali.sms.assessKeyId&#125;&quot;)</span><br><span class="hljs-keyword">private</span> String assessKeyId;<br><br><span class="hljs-meta">@Value(&quot;$&#123;ali.sms.assessKeySecret&#125;&quot;)</span><br><span class="hljs-keyword">private</span> String assessKeySecret;<br><br><span class="hljs-meta">@GetMapping(&quot;sendSms&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">sendSms</span><span class="hljs-params">(String phoneNumber)</span> &#123;<br>    <span class="hljs-type">DefaultProfile</span> <span class="hljs-variable">profile</span> <span class="hljs-operator">=</span> DefaultProfile.getProfile(<span class="hljs-string">&quot;cn-hangzhou&quot;</span>, accessKeyId, assessKeySecret);<br>    <span class="hljs-type">IAcsClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultAcsClient</span>(profile);<br><br>    <span class="hljs-type">CommonRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonRequest</span>();<br>    request.setSysMethod(MethodType.POST);<br>    request.setSysDomain(<span class="hljs-string">&quot;dysmsapi.aliyuncs.com&quot;</span>);<br>    request.setSysVersion(<span class="hljs-string">&quot;2017-05-25&quot;</span>);<br>    request.setSysAction(<span class="hljs-string">&quot;SendSms&quot;</span>);<br>    request.putQueryParameter(<span class="hljs-string">&quot;RegionId&quot;</span>, <span class="hljs-string">&quot;cn-hangzhou&quot;</span>);<br>    request.putQueryParameter(<span class="hljs-string">&quot;PhoneNumbers&quot;</span>, phoneNumber);<br>    request.putQueryParameter(<span class="hljs-string">&quot;SignName&quot;</span>, signName);<br>    request.putQueryParameter(<span class="hljs-string">&quot;TemplateCode&quot;</span>, templateCode);<br>    <span class="hljs-type">String</span> <span class="hljs-variable">vcode</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>    <span class="hljs-keyword">for</span>(<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>; i&lt;<span class="hljs-number">6</span>; i++)&#123;<br>        vcode = vcode + (<span class="hljs-type">int</span>)(Math.random()*<span class="hljs-number">9</span>);<br>    &#125;<br>    request.putQueryParameter(<span class="hljs-string">&quot;TemplateParam&quot;</span>, <span class="hljs-string">&quot;&#123;\&quot;code\&quot;:\&quot;&quot;</span> + vcode + <span class="hljs-string">&quot;\&quot;&#125;&quot;</span>);<br>    <span class="hljs-keyword">try</span> &#123;<br>        <span class="hljs-type">CommonResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.getCommonResponse(request);<br>        System.out.println(response.getData());<br>        <span class="hljs-type">String</span> <span class="hljs-variable">jsonStr</span> <span class="hljs-operator">=</span> response.getData();<br>        <span class="hljs-type">JSONObject</span> <span class="hljs-variable">jsonObject</span> <span class="hljs-operator">=</span> JSONObject.parseObject(jsonStr);<br>        <span class="hljs-keyword">if</span>(<span class="hljs-string">&quot;OK&quot;</span>.equals(jsonObject.get(<span class="hljs-string">&quot;Message&quot;</span>)))&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125; <span class="hljs-keyword">catch</span> (ServerException e) &#123;<br>        e.printStackTrace();<br>    &#125; <span class="hljs-keyword">catch</span> (ClientException e) &#123;<br>        e.printStackTrace();<br>    &#125;<br>    <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/qq1.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="7-2-验证码登录流程"><a href="#7-2-验证码登录流程" class="headerlink" title="7.2 验证码登录流程"></a>7.2 验证码登录流程</h3><h4 id="后端业务"><a href="#后端业务" class="headerlink" title="后端业务"></a>后端业务</h4><p>1、通过短信平台向手机发验证码，验证通过后将手机号和验证码返回给前端进行判断</p>
<p>2、前端比对通过，将手机号进行登录</p>
<ul>
<li>user表中如果不存在该手机号，则自动注册（插入手机号，密码为手机号，头像默认和昵称默认：手机新用户），然后登录</li>
<li>user表中如果存在该手机号，则登录成功（不需要比对密码）</li>
</ul>
<p>3、生成token，并返回</p>
<ul>
<li>controller</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;loginPhoneSms&quot;)</span><br><span class="hljs-keyword">public</span> UserDTO <span class="hljs-title function_">loginPhoneSms</span><span class="hljs-params">(String phoneNumber)</span> &#123;<br>    <span class="hljs-keyword">return</span> userService.loginPhoneSms(String phoneNumber);<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>service</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">UserDTO <span class="hljs-title function_">loginPhoneSms</span><span class="hljs-params">( phoneNumber )</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate&lt;Object,Object&gt; redisTemplate;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> UserDTO <span class="hljs-title function_">loginPhoneSms</span><span class="hljs-params">(String phoneNumber)</span> &#123;<br>        QueryWrapper&lt;User&gt; queryWrapper = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();<br>        queryWrapper.eq(<span class="hljs-string">&quot;phone&quot;</span>,phoneNumber);<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> userMapper.selectOne(queryWrapper);<br>        <span class="hljs-keyword">if</span>(user == <span class="hljs-literal">null</span>)&#123; <span class="hljs-comment">//手机号不存在</span><br>            <span class="hljs-comment">// 先注册</span><br>            register(phoneNumber,phoneNumber,<span class="hljs-string">&quot;手机新用户&quot;</span>,<span class="hljs-string">&quot;xxx&quot;</span>);<br>            <span class="hljs-keyword">return</span> loginPhoneSms(phoneNumber);<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;user = &quot;</span> + user);<br>        <span class="hljs-comment">// 创建token</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">token</span> <span class="hljs-operator">=</span> JwtUtil.createToken(user);<br>        <span class="hljs-comment">// 封装DTO</span><br>        <span class="hljs-type">UserDTO</span> <span class="hljs-variable">dto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserDTO</span>();<br>        dto.setState(EduConstant.LOGIN_SUCCESS_CODE);<br>        dto.setMessage(EduConstant.LOGIN_SUCCESS);<br>        dto.setToken(token);<br>        <span class="hljs-keyword">return</span> dto;<br>    &#125;<br>    <br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">register</span><span class="hljs-params">(String phone, String password, String nickname, String headimg)</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        user.setPhone(phone);<br>        user.setPassword(password);<br>        user.setName(nickname);<br>        user.setPortrait(headimg);<br>        <span class="hljs-keyword">return</span> userMapper.insert(user);<br>    &#125;<br></code></pre></td></tr></table></figure>



<h4 id="前端-1"><a href="#前端-1" class="headerlink" title="前端"></a>前端</h4><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">el-tab-pane</span> <span class="hljs-attr">label</span>=<span class="hljs-string">&quot;手机登录&quot;</span> <span class="hljs-attr">name</span>=<span class="hljs-string">&quot;first&quot;</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;loginForm&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-form</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;phoneNumber&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入手机号&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-input</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span><br>      <span class="hljs-tag">&lt;<span class="hljs-name">el-form-item</span> &gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">el-input</span> <span class="hljs-attr">v-model</span>=<span class="hljs-string">&quot;smsCode&quot;</span> <span class="hljs-attr">placeholder</span>=<span class="hljs-string">&quot;请输入验证码&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">el-input</span>&gt;</span> <br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;get-verify-code&quot;</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;sendSms&quot;</span>&gt;</span><br>          &#123;&#123; smsCodeTimeSecond&gt;0 ? (smsCodeTimeSecond + &#x27;s 后重试&#x27;) : &#x27;获取验证码&#x27; &#125;&#125;<br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>      <span class="hljs-tag">&lt;/<span class="hljs-name">el-form-item</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">el-form</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">el-button</span></span><br><span class="hljs-tag">      <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:100%;margin:0px auto;background-color: #00B38A;font-size:20px&quot;</span></span><br><span class="hljs-tag">      <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;primary&quot;</span></span><br><span class="hljs-tag">      @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;loginPhone&quot;</span>&gt;</span>登 录<span class="hljs-tag">&lt;/<span class="hljs-name">el-button</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">p</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br>  <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-tab-pane</span>&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;<br>   <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">smsCodeTimeSecond</span>:<span class="hljs-number">0</span>, <span class="hljs-comment">// 验证码倒计时的秒数</span><br>      <span class="hljs-attr">phoneNumber</span>:<span class="hljs-literal">null</span>, <span class="hljs-comment">// 发送验证码的手机号</span><br>      <span class="hljs-attr">smsCode</span>:<span class="hljs-literal">null</span>, <span class="hljs-comment">// 输入的验证码</span><br>      <span class="hljs-attr">resultPhoneNumber</span>:<span class="hljs-literal">null</span>, <span class="hljs-comment">// 返回的手机号</span><br>      <span class="hljs-attr">resultSmsCode</span>:<span class="hljs-literal">null</span>,<span class="hljs-comment">// 返回的验证码</span><br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 给手机发验证码</span><br><span class="hljs-title function_">startSense</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">axios</span><br>  .<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;http://localhost:80/user/sendSms&quot;</span> , &#123;<br>    <span class="hljs-attr">params</span>:&#123;<br>      <span class="hljs-attr">phoneNumber</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">phone</span><br>    &#125;<br>  &#125;)<br>  .<span class="hljs-title function_">then</span>( <span class="hljs-function">(<span class="hljs-params">result</span>)=&gt;</span>&#123;<br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>( result );<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setTimeOfCode</span>();<br>  &#125; )<br>  .<span class="hljs-title function_">catch</span>( <span class="hljs-function">(<span class="hljs-params">error</span>)=&gt;</span>&#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;验证码发送失败！&quot;</span>);<br>  &#125;);<br>&#125;,<br><span class="hljs-comment">// 启动验证码倒计时</span><br><span class="hljs-title function_">setTimeOfCode</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">identifyingCodeSecond</span> = <span class="hljs-number">60</span>;<br>    <span class="hljs-keyword">let</span> identifyingCodeTimer = <span class="hljs-built_in">setInterval</span>(<span class="hljs-function">() =&gt;</span> &#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">identifyingCodeSecond</span>--;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-variable language_">this</span>.<span class="hljs-property">identifyingCodeSecond</span> === <span class="hljs-number">0</span>) &#123;<br>            <span class="hljs-comment">// 停止计时</span><br>            <span class="hljs-built_in">clearInterval</span>(identifyingCodeTimer); <br>        &#125;<br>    &#125;, <span class="hljs-number">1000</span>);<br>&#125;,<br><span class="hljs-comment">// 手机验证码登录</span><br><span class="hljs-title function_">loginPhone</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">phoneNumber</span> == <span class="hljs-variable language_">this</span>.<span class="hljs-property">resultPhoneNumber</span> &amp;&amp; <span class="hljs-variable language_">this</span>.<span class="hljs-property">smsCode</span> == <span class="hljs-variable language_">this</span>.<span class="hljs-property">resultSmsCode</span> )&#123;<br>      <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">axios</span><br>          .<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;http://localhost:80/user/loginPhoneSms&quot;</span> , &#123;<br>            <span class="hljs-attr">params</span>:&#123;<br>              <span class="hljs-attr">phoneNumber</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">phoneNumber</span><br>            &#125;<br>          &#125;)<br>          .<span class="hljs-title function_">then</span>( <span class="hljs-function">(<span class="hljs-params">result</span>)=&gt;</span>&#123;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>( result );<br>            <span class="hljs-keyword">if</span>(result.<span class="hljs-property">data</span>.<span class="hljs-property">state</span> == <span class="hljs-number">3</span>)&#123;<br>            <span class="hljs-comment">// 1.关闭登录框</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">dialogFormVisible</span> = <span class="hljs-literal">false</span> ; <br>            <span class="hljs-comment">// 2.更新登录状态</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isLogin</span> = <span class="hljs-literal">true</span>;<br>            <span class="hljs-comment">// 3.将返回的token保存在cookie中</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setCookie</span>(<span class="hljs-string">&quot;user&quot;</span>,result.<span class="hljs-property">data</span>.<span class="hljs-property">token</span>,<span class="hljs-number">600</span>);<br>            <span class="hljs-comment">// 4.解析token中的数据（昵称和头像）</span><br>            <span class="hljs-keyword">const</span> code = <span class="hljs-title function_">jwtDecode</span>(result.<span class="hljs-property">data</span>.<span class="hljs-property">token</span>);<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = code;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>( <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> );<br>        &#125;<br>      &#125; )<br>      .<span class="hljs-title function_">catch</span>( <span class="hljs-function">(<span class="hljs-params">error</span>)=&gt;</span>&#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;发送验证码失败！&quot;</span>);<br>      &#125;); <br>    &#125;<br>  &#125;<br>&#125;,<br></code></pre></td></tr></table></figure>



<hr>
<h1 id="04-用户微服务：8002"><a href="#04-用户微服务：8002" class="headerlink" title="04 用户微服务：8002"></a>04 用户微服务：<font style='color:red;'>8002</font></h1><p>edu-user-boot：用户微服务：<font style='color:red;'>8002</font></p>
<ul>
<li>用户头像的修改</li>
<li>昵称的修改</li>
<li>密码修改</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.lagou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>edu-lagou<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>edu-user-boot<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>edu-user-boot<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- web --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- eureka客户端 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>		<span class="hljs-comment">&lt;!-- mybatis plus --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- mysql --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--pojo持久化使用--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.persistence<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.persistence-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>net.oschina.zcx7878<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>fastdfs-client-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.27.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-io<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!--上传文件--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>commons-fileupload<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-fileupload<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.3.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>

<p>业务分析流程：</p>
<ul>
<li><p>更新个人信息</p>
<ul>
<li>1、点击上传头像，异步将图片上传到fasfdfs上，并返回一个fileId</li>
<li>2、将最新的fileId和新的昵称，一起修改，更新用户信息</li>
</ul>
</li>
<li><p>修改密码</p>
<ul>
<li>1、前端验证原密码和新密码是否一致</li>
<li>2、后端通过userid修改密码即可</li>
</ul>
</li>
</ul>
<ol>
<li>新建Setting.vue（已提供）</li>
<li>修改router&#x2F;index.js</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> <span class="hljs-title class_">Setting</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;../components/Setting.vue&#x27;</span><br><br>--------------------------------------<br>&#123;<br>    <span class="hljs-attr">path</span>: <span class="hljs-string">&#x27;/Setting&#x27;</span>,<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Setting&#x27;</span>,<br>    <span class="hljs-attr">component</span>: <span class="hljs-title class_">Setting</span>,<br>    <span class="hljs-attr">meta</span>: &#123;<br>      <span class="hljs-attr">title</span>: <span class="hljs-string">&#x27;个人设置&#x27;</span><br>    &#125;<br>&#125;,<br></code></pre></td></tr></table></figure>

<ul>
<li>vue</li>
</ul>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br><span class="line">170</span><br><span class="line">171</span><br><span class="line">172</span><br><span class="line">173</span><br><span class="line">174</span><br><span class="line">175</span><br><span class="line">176</span><br><span class="line">177</span><br><span class="line">178</span><br><span class="line">179</span><br><span class="line">180</span><br><span class="line">181</span><br><span class="line">182</span><br><span class="line">183</span><br><span class="line">184</span><br><span class="line">185</span><br><span class="line">186</span><br><span class="line">187</span><br><span class="line">188</span><br><span class="line">189</span><br><span class="line">190</span><br><span class="line">191</span><br><span class="line">192</span><br><span class="line">193</span><br><span class="line">194</span><br><span class="line">195</span><br><span class="line">196</span><br><span class="line">197</span><br><span class="line">198</span><br><span class="line">199</span><br><span class="line">200</span><br><span class="line">201</span><br><span class="line">202</span><br><span class="line">203</span><br><span class="line">204</span><br><span class="line">205</span><br><span class="line">206</span><br><span class="line">207</span><br><span class="line">208</span><br><span class="line">209</span><br><span class="line">210</span><br><span class="line">211</span><br><span class="line">212</span><br><span class="line">213</span><br><span class="line">214</span><br><span class="line">215</span><br><span class="line">216</span><br><span class="line">217</span><br><span class="line">218</span><br><span class="line">219</span><br><span class="line">220</span><br><span class="line">221</span><br><span class="line">222</span><br><span class="line">223</span><br><span class="line">224</span><br><span class="line">225</span><br><span class="line">226</span><br><span class="line">227</span><br><span class="line">228</span><br><span class="line">229</span><br><span class="line">230</span><br><span class="line">231</span><br><span class="line">232</span><br><span class="line">233</span><br><span class="line">234</span><br><span class="line">235</span><br><span class="line">236</span><br><span class="line">237</span><br></pre></td><td class="code"><pre><code class="hljs js">&lt;script&gt;<br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Header</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./Header/Header&quot;</span>; <span class="hljs-comment">//顶部登录条</span><br><span class="hljs-keyword">import</span> <span class="hljs-title class_">Footer</span> <span class="hljs-keyword">from</span> <span class="hljs-string">&quot;./Footer/index&quot;</span>; <span class="hljs-comment">//顶部登录条</span><br><span class="hljs-keyword">import</span> jwtDecode <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;jwt-decode&#x27;</span><br><br><span class="hljs-keyword">export</span> <span class="hljs-keyword">default</span> &#123;<br>    <span class="hljs-attr">name</span>: <span class="hljs-string">&#x27;Setting&#x27;</span>,<br>    <span class="hljs-attr">components</span>: &#123;<br>        <span class="hljs-title class_">Header</span>,<br>        <span class="hljs-title class_">Footer</span><br>    &#125;,<br>    <span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;<br>        <span class="hljs-keyword">return</span> &#123;<br>            <span class="hljs-attr">dialogImageUrl</span>: <span class="hljs-string">&#x27;&#x27;</span>,<span class="hljs-comment">//预览url</span><br>            <span class="hljs-attr">dialogVisibleImg</span>:<span class="hljs-literal">false</span>,<br>            <span class="hljs-attr">httpRequestImg</span>:<span class="hljs-literal">false</span>,<span class="hljs-comment">//展示单个图片</span><br>            <span class="hljs-attr">dialogFormVisible</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 修改密码的模态框不显示</span><br>           <br>            <span class="hljs-attr">dialogVisible</span>:<span class="hljs-literal">false</span>,<span class="hljs-comment">// 隐藏的图片文件框</span><br>            <span class="hljs-attr">user</span>: <span class="hljs-literal">null</span>,<span class="hljs-comment">// 当前登录的用户对象信息</span><br>            <span class="hljs-attr">fileId</span>:<span class="hljs-string">&quot;&quot;</span>,<span class="hljs-comment">// 上传图片后，返回的fastdfs的图片地址</span><br>            <span class="hljs-attr">oldPwd</span>:<span class="hljs-literal">null</span>,<span class="hljs-comment">// 旧密码</span><br>            <span class="hljs-attr">newPwd1</span>:<span class="hljs-literal">null</span>,<span class="hljs-comment">// 第一次新密码</span><br>            <span class="hljs-attr">newPwd2</span>:<span class="hljs-literal">null</span>,<span class="hljs-comment">// 第二次新密码</span><br>            <span class="hljs-attr">token</span>:<span class="hljs-literal">null</span>,<br>            <span class="hljs-attr">isLogin</span>: <span class="hljs-literal">false</span>, <span class="hljs-comment">// 登录状态，true：已登录，false：未登录</span><br>            <br>        &#125;;<br>    &#125;,<br>    <span class="hljs-title function_">created</span>(<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-comment">// 从url中获取token参数</span><br>        <span class="hljs-keyword">let</span> token  = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getValueByUrlParams</span>(<span class="hljs-string">&#x27;token&#x27;</span>);<br><br>        <span class="hljs-keyword">if</span>(token == <span class="hljs-literal">null</span> || token == <span class="hljs-string">&quot;&quot;</span>)&#123;<br>            <span class="hljs-comment">// 从cookie中获取user的token</span><br>            token = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCookie</span>(<span class="hljs-string">&quot;user&quot;</span>);<br>        &#125;<br><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span> = token;<br>    <br>        <span class="hljs-comment">//console.log(&quot;刷新setting页面token=&gt;&quot;+token);</span><br>        <span class="hljs-keyword">if</span>(token != <span class="hljs-literal">null</span> || token != <span class="hljs-string">&quot;&quot;</span>)&#123;<br>            <span class="hljs-comment">// 将token发送到sso进行校验</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">axios</span><br>            .<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;http://localhost:80/user/checkToken&quot;</span>,&#123;<br>                <span class="hljs-attr">params</span>:&#123;<br>                    <span class="hljs-attr">token</span>:token<br>                &#125;<br>            &#125;)<br>            .<span class="hljs-title function_">then</span>( <span class="hljs-function">(<span class="hljs-params">result</span>)=&gt;</span>&#123;<br>                <span class="hljs-keyword">if</span>(result.<span class="hljs-property">data</span>.<span class="hljs-property">state</span> == <span class="hljs-number">4</span>)&#123;<br>                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">isLogin</span> = <span class="hljs-literal">true</span>;<br>                    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setCookie</span>(<span class="hljs-string">&quot;user&quot;</span>,token,<span class="hljs-number">600</span>);<br>                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = <span class="hljs-title function_">jwtDecode</span>(token);<br>                    <span class="hljs-comment">//console.log(&quot;------&gt;&quot;+token);</span><br>                    <span class="hljs-comment">//console.log(this.user.userid);</span><br>                &#125;<br>            &#125;)<br>            .<span class="hljs-title function_">catch</span>( <span class="hljs-function">(<span class="hljs-params">error</span>)=&gt;</span>&#123;<br>            &#125;);<br>        &#125;<br>        <br>    &#125;,<br>    <span class="hljs-attr">methods</span>: &#123;<br>        <span class="hljs-title function_">redirectLogin</span>(<span class="hljs-params"></span>) &#123;<br>            <span class="hljs-variable language_">window</span>.<span class="hljs-title function_">open</span>(<span class="hljs-string">&#x27;/frontLogin.do&#x27;</span>, <span class="hljs-string">&#x27;_self&#x27;</span>);<br>        &#125;,<br>        <span class="hljs-comment">//切换tab页</span><br>        <span class="hljs-title function_">bang</span>(<span class="hljs-params">i</span>)&#123;<br>            <span class="hljs-comment">// alert( i );</span><br>            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;btn_j&quot;</span>).<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&quot;label-active&quot;</span>);<br>            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;btn_b&quot;</span>).<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&quot;label-active&quot;</span>);<br>            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;btn_p&quot;</span>).<span class="hljs-property">classList</span>.<span class="hljs-title function_">remove</span>(<span class="hljs-string">&quot;label-active&quot;</span>);<br>            <br>            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;label-one&quot;</span>).<span class="hljs-property">style</span>.<span class="hljs-property">display</span>=<span class="hljs-string">&quot;none&quot;</span>;<br>            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;label-two&quot;</span>).<span class="hljs-property">style</span>.<span class="hljs-property">display</span>=<span class="hljs-string">&quot;none&quot;</span>;<br>            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;label-three&quot;</span>).<span class="hljs-property">style</span>.<span class="hljs-property">display</span>=<span class="hljs-string">&quot;none&quot;</span>;<br><br>            <span class="hljs-keyword">if</span>(i == <span class="hljs-number">1</span>)&#123;<br>                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;btn_j&quot;</span>).<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&quot;label-active&quot;</span>);<br>                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;label-one&quot;</span>).<span class="hljs-property">style</span>.<span class="hljs-property">display</span>=<span class="hljs-string">&quot;block&quot;</span>;<br>            &#125;<span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span>(i == <span class="hljs-number">2</span>)&#123;<br>                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;btn_b&quot;</span>).<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&quot;label-active&quot;</span>);<br>                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;label-two&quot;</span>).<span class="hljs-property">style</span>.<span class="hljs-property">display</span>=<span class="hljs-string">&quot;block&quot;</span>;<br>            &#125;<span class="hljs-keyword">else</span>&#123;<br>                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;btn_p&quot;</span>).<span class="hljs-property">classList</span>.<span class="hljs-title function_">add</span>(<span class="hljs-string">&quot;label-active&quot;</span>);<br>                <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;label-three&quot;</span>).<span class="hljs-property">style</span>.<span class="hljs-property">display</span>=<span class="hljs-string">&quot;block&quot;</span>;<br>            &#125;<br>        &#125;,<br>        <span class="hljs-comment">// 上传头像</span><br>        <span class="hljs-title function_">myUpload</span>(<span class="hljs-params">content</span>) &#123;<br>            <span class="hljs-comment">// 必须将表单中的数据进行封装才能发送，否则传不过去</span><br>            <span class="hljs-keyword">let</span> form = <span class="hljs-keyword">new</span> <span class="hljs-title class_">FormData</span>();<br>            form.<span class="hljs-title function_">append</span>(<span class="hljs-string">&quot;file&quot;</span>,content.<span class="hljs-property">file</span>);<br><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">axios</span>.<span class="hljs-title function_">post</span>(<span class="hljs-string">&quot;http://localhost:8002/userSetting/upload&quot;</span> , form)<br>                .<span class="hljs-title function_">then</span>( <span class="hljs-function">(<span class="hljs-params">result</span>)=&gt;</span>&#123;<br>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">fileId</span> = result.<span class="hljs-property">data</span>.<span class="hljs-property">fileId</span>;<br>                <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;头像URL：&quot;</span> + <span class="hljs-variable language_">this</span>.<span class="hljs-property">fileId</span>);<br>                <span class="hljs-comment">// 正常情况下会出现第二个图片框，true为只显示一个</span><br>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">httpRequestImg</span> = <span class="hljs-literal">true</span>;<br>            &#125; )<br>            .<span class="hljs-title function_">catch</span>( <span class="hljs-function">(<span class="hljs-params">error</span>)=&gt;</span>&#123;<br>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;上传头像失败！&quot;</span>);<br>            &#125;);<br>        &#125;,<br>        <span class="hljs-comment">//更新个人信息</span><br>        <span class="hljs-title function_">updateInfo</span>(<span class="hljs-params"></span>)&#123;<br>            <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">axios</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;http://localhost:8002/userSetting/updateUser&quot;</span> , &#123;<br>                <span class="hljs-attr">params</span>:&#123;<br>                    <span class="hljs-attr">userid</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">userid</span>,<br>                    <span class="hljs-attr">newName</span>: <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;newNickName&quot;</span>).<span class="hljs-property">value</span>,<br>                    <span class="hljs-attr">fileId</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">fileId</span><br>                &#125;<br>            &#125;).<span class="hljs-title function_">then</span>( <span class="hljs-function">(<span class="hljs-params">result</span>)=&gt;</span>&#123;<br>               <span class="hljs-comment">// 友好提示</span><br>               <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;上传头像失败！&quot;</span>);<br>               <span class="hljs-comment">// 退出</span><br>               <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">logout</span>();<br>               <span class="hljs-comment">// 回到首页</span><br>               <span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">&quot;/&quot;</span>);<br>            &#125; )<br>            .<span class="hljs-title function_">catch</span>( <span class="hljs-function">(<span class="hljs-params">error</span>)=&gt;</span>&#123;<br>                <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;上传头像失败！&quot;</span>);<br>            &#125;);<br>        &#125;,<br>        <span class="hljs-comment">//修改密码</span><br>        <span class="hljs-title function_">updatePwd</span>(<span class="hljs-params"></span>)&#123;<br>           <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">oldPwd</span> == <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">password</span>)&#123;<br>               <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">this</span>.<span class="hljs-property">newPwd1</span> == <span class="hljs-variable language_">this</span>.<span class="hljs-property">newPwd2</span>)&#123;<br>                    <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">axios</span>.<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;http://localhost:8002/userSetting/updatePassword&quot;</span> , &#123;<br>                        <span class="hljs-attr">params</span>:&#123;<br>                            <span class="hljs-attr">userid</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">userid</span>,<br>                            <span class="hljs-attr">newPwd</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">newPwd2</span><br>                        &#125;<br>                    &#125;).<span class="hljs-title function_">then</span>( <span class="hljs-function">(<span class="hljs-params">result</span>)=&gt;</span>&#123;<br>                        <span class="hljs-comment">// 友好提示</span><br>                        <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">success</span>(<span class="hljs-string">&quot;密码修改成功，请重新登录&quot;</span>);<br>                        <span class="hljs-comment">// 隐藏修改密码的对话框</span><br>                        <span class="hljs-variable language_">this</span>.<span class="hljs-property">dialogFormVisible</span> = <span class="hljs-literal">false</span>;<br>                        <span class="hljs-comment">// 退出</span><br>                        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">logout</span>();<br>                        <span class="hljs-comment">// 回到首页</span><br>                        <span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">&quot;/&quot;</span>);<br>                    &#125; )<br>                    .<span class="hljs-title function_">catch</span>( <span class="hljs-function">(<span class="hljs-params">error</span>)=&gt;</span>&#123;<br>                        <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;修改密码失败！&quot;</span>);<br>                    &#125;);<br>               &#125;<span class="hljs-keyword">else</span>&#123;<br>                    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;两次密码不一致&quot;</span>);<br>                    <span class="hljs-keyword">return</span>;<br>               &#125;<br>           &#125;<span class="hljs-keyword">else</span>&#123;<br>               <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;原密码输入错误&quot;</span>);<br>               <span class="hljs-keyword">return</span>;<br>           &#125;<br>        &#125;,        <br>        <span class="hljs-comment">//预览</span><br>        <span class="hljs-title function_">handlePictureCardPreview</span>(<span class="hljs-params">file</span>) &#123; <br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">dialogImageUrl</span> = file.<span class="hljs-property">url</span>;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">dialogVisibleImg</span> = <span class="hljs-literal">true</span>;<br>        &#125;,<br>        <span class="hljs-comment">//删除</span><br>        <span class="hljs-title function_">handleRemove</span>(<span class="hljs-params">file, fileList</span>) &#123; <br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">httpRequestImg</span> = <span class="hljs-literal">false</span>;<br>            <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(file, fileList);<br>        &#125;,<br>        <span class="hljs-comment">//登出</span><br>        <span class="hljs-title function_">logout</span>(<span class="hljs-params"></span>)&#123; <br>            <span class="hljs-comment">//删除cookie</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">delCookie</span>(<span class="hljs-string">&quot;user&quot;</span>); <br>            <span class="hljs-comment">// 更新登录状态</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">isLogin</span> = <span class="hljs-literal">false</span>; <br>            <span class="hljs-title function_">alert</span>(<span class="hljs-string">&#x27;谢谢使用，再见！&#x27;</span>);<br>            <span class="hljs-comment">// 重定向到未登录的首页</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">$router</span>.<span class="hljs-title function_">push</span>(<span class="hljs-string">&quot;/&quot;</span>); <span class="hljs-comment">//回到首页</span><br>            <span class="hljs-comment">// 去redis删除token</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-property">axios</span><br>            .<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;http://localhost:80/user/logout&quot;</span>,&#123;<br>                <span class="hljs-attr">params</span>:&#123;<br>                <span class="hljs-attr">token</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span><br>                &#125;<br>            &#125;)<br>            .<span class="hljs-title function_">then</span>( <span class="hljs-function">(<span class="hljs-params">result</span>)=&gt;</span>&#123;<br>            &#125;)<br>            .<span class="hljs-title function_">catch</span>( <span class="hljs-function">(<span class="hljs-params">error</span>)=&gt;</span>&#123;<br>                <span class="hljs-comment">//this.$message.error(&quot;登录失败！&quot;);</span><br>            &#125;);<br>        &#125;,<br>        <span class="hljs-comment">//设置cookie</span><br>        <span class="hljs-title function_">setCookie</span>(<span class="hljs-params">key,value,expires</span>)&#123;<br>            <span class="hljs-keyword">var</span> exp = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>();<br>            exp.<span class="hljs-title function_">setTime</span>(exp.<span class="hljs-title function_">getTime</span>() + expires*<span class="hljs-number">1000</span>);<br>            <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span> = key + <span class="hljs-string">&quot;=&quot;</span> + <span class="hljs-built_in">escape</span> (value) + <span class="hljs-string">&quot;;expires=&quot;</span> + exp.<span class="hljs-title function_">toGMTString</span>();<br>        &#125;,<br>        <span class="hljs-comment">//从cookie中获取token</span><br>        <span class="hljs-title function_">getCookie</span>(<span class="hljs-params">key</span>)&#123;<br>            <span class="hljs-keyword">var</span> name = key + <span class="hljs-string">&quot;=&quot;</span>;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&#x27;;&#x27;</span>) &gt; <span class="hljs-number">0</span>)&#123;<br>                <span class="hljs-keyword">var</span> ca = <span class="hljs-variable language_">document</span>.<span class="hljs-property">cookie</span>.<span class="hljs-title function_">split</span>(<span class="hljs-string">&#x27;;&#x27;</span>);<br>                <span class="hljs-keyword">for</span>(<span class="hljs-keyword">var</span> i=<span class="hljs-number">0</span>; i&lt;ca.<span class="hljs-property">length</span>; i++) &#123;<br>                    <span class="hljs-keyword">var</span> c = ca[i].<span class="hljs-title function_">trim</span>();<br>                    <span class="hljs-keyword">if</span> (c.<span class="hljs-title function_">indexOf</span>(name)==<span class="hljs-number">0</span>) &#123; <br>                    <span class="hljs-keyword">return</span> c.<span class="hljs-title function_">substring</span>(name.<span class="hljs-property">length</span>,c.<span class="hljs-property">length</span>); <br>                    &#125;<br>                &#125;<br>            &#125;<br>            <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>        &#125;,<br>        <span class="hljs-comment">//删除cookie</span><br>        <span class="hljs-title function_">delCookie</span>(<span class="hljs-params">name</span>)&#123;<br>            <span class="hljs-comment">// 删除cookie只需要将值清空即可</span><br>            <span class="hljs-comment">// -1 让指定名为name的cookie过期实现自动清除，如果不赋值-1的话，只是将对应的cookie值删除，而这条cookie记录并没有删除</span><br>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setCookie</span>(name,<span class="hljs-string">&#x27;&#x27;</span>,-<span class="hljs-number">1</span>);<br>        &#125;,<br>        <span class="hljs-comment">// 获取url中参数</span><br>        <span class="hljs-title function_">getValueByUrlParams</span>(<span class="hljs-params">paramKey</span>) &#123;<br>            <span class="hljs-comment">// http://localhost:8080/#/?token=1&amp;id=2</span><br>            <span class="hljs-keyword">var</span> url = location.<span class="hljs-property">href</span>;<br>            <span class="hljs-keyword">var</span> paraString = url.<span class="hljs-title function_">substring</span>(url.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;?&quot;</span>) + <span class="hljs-number">1</span>, url.<span class="hljs-property">length</span>).<span class="hljs-title function_">split</span>(<span class="hljs-string">&quot;&amp;&quot;</span>);<br>            <span class="hljs-keyword">var</span> paraObj = &#123;&#125;<br>            <span class="hljs-keyword">var</span> i, j<br>            <span class="hljs-keyword">for</span> (i = <span class="hljs-number">0</span>; j = paraString[i]; i++) &#123;<br>                paraObj[j.<span class="hljs-title function_">substring</span>(<span class="hljs-number">0</span>, j.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;=&quot;</span>)).<span class="hljs-title function_">toLowerCase</span>()] = j.<span class="hljs-title function_">substring</span>(j.<span class="hljs-title function_">indexOf</span>(<span class="hljs-string">&quot;=&quot;</span>) + <span class="hljs-number">1</span>, j.<span class="hljs-property">length</span>);<br>            &#125;<br>            <span class="hljs-keyword">var</span> returnValue = paraObj[paramKey.<span class="hljs-title function_">toLowerCase</span>()];<br>            <span class="hljs-keyword">if</span> (<span class="hljs-title function_">typeof</span>(returnValue) == <span class="hljs-string">&quot;undefined&quot;</span>) &#123;<br>                <span class="hljs-keyword">return</span> <span class="hljs-string">&quot;&quot;</span>;<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-keyword">return</span> returnValue;<br>            &#125;<br>        &#125;,<br><br>    &#125;,<br>    <br>&#125;;<br>&lt;/script&gt;<br></code></pre></td></tr></table></figure>



<ul>
<li>控制层</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.lagou.eduuserboot.controller;<br><br><span class="hljs-keyword">import</span> com.lagou.eduuserboot.entity.FileSystem;<br><span class="hljs-keyword">import</span> com.lagou.eduuserboot.entity.User;<br><span class="hljs-keyword">import</span> com.lagou.eduuserboot.entity.UserDTO;<br><span class="hljs-keyword">import</span> com.lagou.eduuserboot.service.UserService;<br><span class="hljs-keyword">import</span> jdk.nashorn.internal.ir.annotations.Reference;<br><span class="hljs-keyword">import</span> org.csource.common.IniFileReader;<br><span class="hljs-keyword">import</span> org.csource.common.NameValuePair;<br><span class="hljs-keyword">import</span> org.csource.fastdfs.*;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;<br><span class="hljs-keyword">import</span> org.springframework.web.bind.annotation.*;<br><span class="hljs-keyword">import</span> org.springframework.web.multipart.MultipartFile;<br><br><span class="hljs-keyword">import</span> java.io.IOException;<br><span class="hljs-keyword">import</span> java.io.InputStream;<br><span class="hljs-keyword">import</span> java.io.UnsupportedEncodingException;<br><span class="hljs-keyword">import</span> java.util.Properties;<br><br><br><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;userSetting&quot;)</span><br><span class="hljs-meta">@CrossOrigin</span> <span class="hljs-comment">//跨域</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserService userService;<br><br>    <span class="hljs-keyword">static</span> <span class="hljs-type">String</span> <span class="hljs-variable">fastdfsip</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>    <span class="hljs-keyword">static</span>&#123;<br>        <span class="hljs-type">Properties</span> <span class="hljs-variable">props</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Properties</span>();<br>        <span class="hljs-type">InputStream</span> <span class="hljs-variable">in</span> <span class="hljs-operator">=</span> IniFileReader.loadFromOsFileSystemOrClasspathAsStream(<span class="hljs-string">&quot;config/fastdfs-client.properties&quot;</span>);<br>        <span class="hljs-keyword">if</span> (in != <span class="hljs-literal">null</span>) &#123;<br>            <span class="hljs-keyword">try</span> &#123;<br>                props.load(in);<br>            &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>                e.printStackTrace();<br>            &#125;<br>        &#125;<br>        fastdfsip = props.getProperty(<span class="hljs-string">&quot;fastdfs.tracker_servers&quot;</span>).split(<span class="hljs-string">&quot;:&quot;</span>)[<span class="hljs-number">0</span>];<br>    &#125;<br><br><br>    <span class="hljs-meta">@PostMapping(&quot;upload&quot;)</span><br>    <span class="hljs-meta">@ResponseBody</span><br>    <span class="hljs-keyword">public</span> FileSystem <span class="hljs-title function_">upload</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        System.out.println(<span class="hljs-string">&quot;接收到：&quot;</span> +file);<br>        <span class="hljs-type">FileSystem</span> <span class="hljs-variable">fs</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">FileSystem</span>();<br><br>        <span class="hljs-comment">//获得文件的原始名称</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">oldFileName</span> <span class="hljs-operator">=</span> file.getOriginalFilename();<br>        <span class="hljs-comment">//获得后缀名</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">hou</span> <span class="hljs-operator">=</span> oldFileName.substring(oldFileName.lastIndexOf(<span class="hljs-string">&quot;.&quot;</span>)+<span class="hljs-number">1</span>);<br><br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">//加载配置文件</span><br>            ClientGlobal.initByProperties(<span class="hljs-string">&quot;config/fastdfs-client.properties&quot;</span>);<br><br>            System.out.println(<span class="hljs-string">&quot;ip:&quot;</span> + fastdfsip );<br>            <span class="hljs-comment">//创建tracker客户端</span><br>            <span class="hljs-type">TrackerClient</span> <span class="hljs-variable">tc</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">TrackerClient</span>();<br>            <span class="hljs-comment">//根据tracker客户端创建连接</span><br>            <span class="hljs-type">TrackerServer</span> <span class="hljs-variable">ts</span> <span class="hljs-operator">=</span> tc.getConnection();<br>            <span class="hljs-type">StorageServer</span> <span class="hljs-variable">ss</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>            <span class="hljs-comment">//定义storage客户端</span><br>            <span class="hljs-type">StorageClient1</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StorageClient1</span>(ts, ss);<br>            <span class="hljs-comment">//文件元信息</span><br>            NameValuePair[] list = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NameValuePair</span>[<span class="hljs-number">1</span>];<br>            list[<span class="hljs-number">0</span>] = <span class="hljs-keyword">new</span> <span class="hljs-title class_">NameValuePair</span>(<span class="hljs-string">&quot;fileName&quot;</span>, oldFileName);<br>            <span class="hljs-comment">//上传，返回fileId</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">fileId</span> <span class="hljs-operator">=</span> client.upload_file1(file.getBytes(), hou, list);<br>            System.out.println(fileId);<br>            ts.close();<br>            <span class="hljs-comment">//封装数据对象，将路径保存到数据库（本次不写）</span><br>            fs.setFileId(fileId);<br>            fs.setFilePath(fileId);<br>            fs.setFileName(oldFileName);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> fs;<br>    &#125;<br><br>    <span class="hljs-comment">//修改昵称</span><br>    <span class="hljs-meta">@GetMapping(&quot;updateUser&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateUser</span><span class="hljs-params">(Integer userid,String newName,String fileId)</span> <span class="hljs-keyword">throws</span> UnsupportedEncodingException &#123;<br>        System.out.println(<span class="hljs-string">&quot;newName = &quot;</span> + newName);<br>        fileId = <span class="hljs-string">&quot;http://&quot;</span>+fastdfsip+<span class="hljs-string">&quot;/&quot;</span>+fileId;<br>        System.out.println(<span class="hljs-string">&quot;imgfileId = &quot;</span> + fileId);<br>        userService.updateUser(userid,newName, fileId);<br>    &#125;<br><br>    <span class="hljs-comment">//修改密码</span><br>    <span class="hljs-meta">@GetMapping(&quot;updatePassword&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updatePassword</span><span class="hljs-params">(Integer userid,String newPwd)</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;userid = &quot;</span> + userid);<br>        System.out.println(<span class="hljs-string">&quot;newPwd = &quot;</span> + newPwd);<br>        userService.updatePassword(userid,newPwd);<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<ul>
<li>service</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserService</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 修改昵称</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userid    用户编号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> newName 新昵称</span><br><span class="hljs-comment">     */</span><br>     <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateUser</span><span class="hljs-params">(Object userid,String newName,String imgfileId)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 修改密码</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userid    用户编号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> newPwd 新密码</span><br><span class="hljs-comment">     */</span><br>     <span class="hljs-keyword">void</span> <span class="hljs-title function_">updatePassword</span><span class="hljs-params">(Object userid,String newPwd)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">UserService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> UserMapper userMapper;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updateUser</span><span class="hljs-params">(Integer userid, String newName, String imgfileId)</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        user.setId(userid);<br>        user.setName(newName);<br>        user.setPortrait(imgfileId);<br>        userMapper.updateById(user);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">updatePassword</span><span class="hljs-params">(Integer userid, String newPwd)</span> &#123;<br>        <span class="hljs-type">User</span> <span class="hljs-variable">user</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">User</span>();<br>        user.setId(userid);<br>        user.setPassword(newPwd);<br>        userMapper.updateById(user);<br>    &#125;<br></code></pre></td></tr></table></figure>



<ul>
<li>上传文件的实体类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@AllArgsConstructor</span><br><span class="hljs-meta">@NoArgsConstructor</span><br><span class="hljs-meta">@ToString</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileSystem</span> &#123;<br>    <span class="hljs-keyword">private</span> String fileId;<br>    <span class="hljs-keyword">private</span> String filePath;<br>    <span class="hljs-keyword">private</span> String fileName;<br></code></pre></td></tr></table></figure>

<ul>
<li>配置文件 src&#x2F;main&#x2F;resources&#x2F;config&#x2F;fastdfs-client.properties</li>
</ul>
<figure class="highlight properties"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs properties"><span class="hljs-comment">##fastdfs-client.properties</span><br><span class="hljs-attr">fastdfs.connect_timeout_in_seconds</span> = <span class="hljs-string">5</span><br><span class="hljs-attr">fastdfs.network_timeout_in_seconds</span> = <span class="hljs-string">30</span><br><span class="hljs-attr">fastdfs.charset</span> = <span class="hljs-string">UTF-8</span><br><span class="hljs-attr">fastdfs.http_anti_steal_token</span> = <span class="hljs-string">false</span><br><span class="hljs-attr">fastdfs.http_secret_key</span> = <span class="hljs-string">FastDFS1234567890</span><br><span class="hljs-attr">fastdfs.http_tracker_http_port</span> = <span class="hljs-string">80</span><br><span class="hljs-attr">fastdfs.tracker_servers</span> = <span class="hljs-string">192.168.204.141:22122</span><br></code></pre></td></tr></table></figure>

<ul>
<li>启动fastDFS服务，测试开始</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apl">/usr/bin/fdfs_trackerd /etc/fdfs/tracker.conf restart<br>/usr/bin/fdfs_storaged /etc/fdfs/storage.conf restart<br>netstat -ntlp<br>systemctl stop firewalld.service<br>cd /home/fastdfs/fdfs_storage/data/<br>ls<br><br>/usr/local/nginx/sbin/nginx -c /usr/local/nginx/conf/nginx.conf<br></code></pre></td></tr></table></figure>

<ul>
<li>UserMapper.java</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">UserMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;User&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>启动类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableEurekaClient</span> <span class="hljs-comment">// 注册到中心的客户端</span><br><span class="hljs-meta">@MapperScan(&quot;com.lagou.eduuserboot.mapper&quot;)</span>  <span class="hljs-comment">// 扫描mapper包</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EduUserBootApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(EduUserBootApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>





<hr>
<h1 id="05-课程微服务：8004"><a href="#05-课程微服务：8004" class="headerlink" title="05 课程微服务：8004"></a>05 课程微服务：<font style='color:red;'>8004</font></h1><p>edu-course-boot：课程微服务：<font style='color:red;'>8004</font></p>
<ul>
<li>mybatis-plus暂不支持比较复杂的多表关联查询，如果遇到复杂的多表查询，依旧使用mybatis+xml配置文件即可，用法和之前一样</li>
<li>修改yml配置文件，告诉程序去哪里找mapper.xml</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8004</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">edu-course-boot</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.204.141:3306/edu_course?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=UTC</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123123</span><br>  <span class="hljs-attr">redis:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.204</span><span class="hljs-number">.141</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">6379</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:7001/eureka</span><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">prefer-ip-address:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">instance-id:</span> <span class="hljs-string">$&#123;spring.cloud.client.ip-address&#125;:$&#123;server.port&#125;</span><br><span class="hljs-attr">mybatis-plus:</span><br>  <span class="hljs-attr">mapper-locations:</span> <span class="hljs-string">classpath:mybatis/mapper/*.xml</span>  <span class="hljs-comment">#resources下创建mybatis/mapper</span><br></code></pre></td></tr></table></figure>

<ul>
<li>pom</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.lagou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>edu-lagou<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>edu-course-boot<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>edu-course-boot<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- web --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- eureka客户端 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>		<span class="hljs-comment">&lt;!-- mybatis plus --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- mysql --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--pojo持久化使用--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.persistence<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.persistence-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--自动getset--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>		<span class="hljs-comment">&lt;!--redis--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-data-redis<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>



<ul>
<li>将之前写好的CourseDao.xml拷贝过来，修改：</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!--修改包路径：mapper接口的完整路径--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">mapper</span> <span class="hljs-attr">namespace</span>=<span class="hljs-string">&quot;com.lagou.educourseboot.mapper.CourseMapper&quot;</span>&gt;</span> <br>    <span class="hljs-tag">&lt;<span class="hljs-name">resultMap</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;com.lagou.educourseboot.entity.Course&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;CourseMap&quot;</span>&gt;</span><br>    ...省略<br></code></pre></td></tr></table></figure>

<ul>
<li>实体类<ul>
<li>Course.java</li>
<li>Teacher.java</li>
<li>ActivityCourse.java</li>
<li>CourseSection.java</li>
<li>CourseLesson.java</li>
<li>CourseMedia.java</li>
</ul>
</li>
<li>在mapper接口中加入我们自定义的方法</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CourseMapper</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询全部课程信息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    List&lt;Course&gt; <span class="hljs-title function_">getAllCourse</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询已登录用户购买的全部课程信息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    List&lt;Course&gt; <span class="hljs-title function_">getCourseByUserId</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;userId&quot;)</span> String userId)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询某门课程的详细信息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> courseid 课程编号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    Course <span class="hljs-title function_">getCourseById</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;courseid&quot;)</span> Integer courseid)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>controller</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;course&quot;)</span><br><span class="hljs-meta">@CrossOrigin</span> <span class="hljs-comment">//跨域</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CourseController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CourseService courseService;<br><br>    <span class="hljs-meta">@GetMapping(&quot;getAllCourse&quot;)</span><br>    <span class="hljs-keyword">public</span> List&lt;Course&gt; <span class="hljs-title function_">getAllCourse</span><span class="hljs-params">()</span> &#123;<br>        List&lt;Course&gt; list = courseService.getAllCourse();<br>        <span class="hljs-keyword">return</span> list;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;getCourseByUserId/&#123;userid&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> List&lt;Course&gt; <span class="hljs-title function_">getCourseByUserId</span><span class="hljs-params">( <span class="hljs-meta">@PathVariable(&quot;userid&quot;)</span> String userid )</span> &#123;<br>        List&lt;Course&gt; list = courseService.getCourseByUserId(userid);<br>        <span class="hljs-keyword">return</span> list;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;getCourseById/&#123;courseid&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Course <span class="hljs-title function_">getCourseById</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;courseid&quot;)</span>Integer courseid)</span> &#123;<br>        <span class="hljs-type">Course</span> <span class="hljs-variable">course</span> <span class="hljs-operator">=</span> courseService.getCourseById(courseid);<br>        <span class="hljs-keyword">return</span> course;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>service</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CourseService</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询全部课程信息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    List&lt;Course&gt; <span class="hljs-title function_">getAllCourse</span><span class="hljs-params">()</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询已登录用户购买的全部课程信息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    List&lt;Course&gt; <span class="hljs-title function_">getCourseByUserId</span><span class="hljs-params">(String userId)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 查询某门课程的详细信息</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> courseid 课程编号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span></span><br><span class="hljs-comment">     */</span><br>    Course <span class="hljs-title function_">getCourseById</span><span class="hljs-params">(Integer courseid)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CourseServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CourseService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CourseMapper courseMapper;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;Course&gt; <span class="hljs-title function_">getAllCourse</span><span class="hljs-params">()</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;===查询mysql===&quot;</span>);<br>        <span class="hljs-keyword">return</span> courseMapper.getAllCourse();<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;Course&gt; <span class="hljs-title function_">getCourseByUserId</span><span class="hljs-params">(String userId)</span> &#123;<br>        <span class="hljs-keyword">return</span> courseDao.getCourseByUserId(userId);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Course <span class="hljs-title function_">getCourseById</span><span class="hljs-params">(Integer courseid)</span> &#123;<br>        <span class="hljs-keyword">return</span> courseMapper.getCourseById(courseid);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>







<h2 id="高并发redis帮你扛"><a href="#高并发redis帮你扛" class="headerlink" title="高并发redis帮你扛"></a>高并发redis帮你扛</h2><ul>
<li><p>引入依赖 加入redis</p>
</li>
<li><p>修改yml 配置redis服务器ip</p>
</li>
<li><p>redis操作应该放在controller？还是service？</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CourseServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CourseService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CourseMapper courseMapper;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate&lt;Object,Object&gt; redisTemplate;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;Course&gt; <span class="hljs-title function_">getAllCourse</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//将redis内存中的序列化的集合名称用String重新命名（增加可读性）</span><br>        <span class="hljs-type">RedisSerializer</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>();<br>        redisTemplate.setKeySerializer(rs);<br><br>        System.out.println(<span class="hljs-string">&quot;查询redis&quot;</span>);<br>        List&lt;Course&gt; list = (List&lt;Course&gt;)redisTemplate.opsForValue().get(<span class="hljs-string">&quot;allCourses&quot;</span>);<br>        <span class="hljs-keyword">if</span>(list == <span class="hljs-literal">null</span>)&#123;<br>            <span class="hljs-comment">//去数据库</span><br>            System.out.println(<span class="hljs-string">&quot;====MySql数据库====&quot;</span>);<br>            list = courseMapper.getAllCourse();<br>            <span class="hljs-comment">// 把从数据库查询的集合放在redis内存中(key,value,过期时间,分钟为单位)</span><br>            redisTemplate.opsForValue().set(<span class="hljs-string">&quot;allCourses&quot;</span>, list,<span class="hljs-number">10</span>, TimeUnit.MINUTES);<br>        &#125;<br>        <span class="hljs-keyword">return</span> list;<br>    &#125;<br></code></pre></td></tr></table></figure>







<h2 id="高并发下缓存穿透问题"><a href="#高并发下缓存穿透问题" class="headerlink" title="高并发下缓存穿透问题"></a>高并发下缓存穿透问题</h2><ul>
<li><p>因为，我们假设<b style='color:red'>高并发</b>下，1000个人同时进入方法执行，1000个人从缓存中找集合，没有找到，那么进入下一步的if，就会发生1000个人同时从数据库查询，这样的话，执行了1000次查询数据库，效率低下，redis没用到。这样的原因，就是redis缓存查第一次之后，后续的查询没有拦住，这就是   “<b style='color:red'>缓存穿透</b>”</p>
</li>
<li><p>模拟20个线程高并发</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;getAllCourse&quot;)</span><br><span class="hljs-keyword">public</span> List&lt;Course&gt; <span class="hljs-title function_">getAllCourse</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-comment">// 模拟多线程：创建一个容量20个的线程池</span><br>    <span class="hljs-type">ExecutorService</span> <span class="hljs-variable">es</span> <span class="hljs-operator">=</span> Executors.newFixedThreadPool(<span class="hljs-number">20</span>);<br>    <span class="hljs-comment">// 模拟20个线程同时查询</span><br>    <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> <span class="hljs-number">1</span>; i &lt;= <span class="hljs-number">20</span>; i++) &#123;<br>        es.submit(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Runnable</span>() &#123;<br>            <span class="hljs-meta">@Override</span><br>            <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">run</span><span class="hljs-params">()</span> &#123;<br>                courseService.getAllCourse();<br>            &#125;<br>        &#125;);<br>    &#125;<br>    <span class="hljs-keyword">return</span> courseService.getAllCourse();<br>&#125;<br></code></pre></td></tr></table></figure>


</li>
<li><p>解决方案：</p>
</li>
<li><p>1、最简单粗暴的解决方案—-同步方法锁</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">synchronized</span> List&lt;Course&gt; <span class="hljs-title function_">getAllCourse</span><span class="hljs-params">()</span> &#123;<br>    xxxx<br>&#125;<br></code></pre></td></tr></table></figure>


</li>
<li><p>2、效率稍微高一些的方案—-同步代码块(双层检测锁 DCL：double check lock)</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> RedisTemplate&lt;Object,Object&gt; redisTemplate;<br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> List&lt;Course&gt; <span class="hljs-title function_">getAllCourse</span><span class="hljs-params">()</span> &#123;<br>    <span class="hljs-type">RedisSerializer</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>();<br>    redisTemplate.setKeySerializer(rs);<br><br>    System.out.println(<span class="hljs-string">&quot;查询redis&quot;</span>);<br>    List&lt;Course&gt; list = (List&lt;Course&gt;)redisTemplate.opsForValue().get(<span class="hljs-string">&quot;allCourses&quot;</span>);<br>    <span class="hljs-keyword">if</span>(list == <span class="hljs-literal">null</span>)&#123;<br>        <span class="hljs-comment">//排队，让第一个人进，走一遍流程（后面的人就会走缓存了）</span><br>        <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>)&#123;<br>            list = (List&lt;Course&gt;)redisTemplate.opsForValue().get(<span class="hljs-string">&quot;allCourses&quot;</span>);<br>            <span class="hljs-keyword">if</span>(list == <span class="hljs-literal">null</span>)&#123;<br>                <span class="hljs-comment">//去数据库</span><br>                System.out.println(<span class="hljs-string">&quot;====MySql数据库====&quot;</span>);<br>                list = courseMapper.getAllCourse();<br>                <span class="hljs-comment">// 把从数据库查询的集合放在redis内存中</span><br>                redisTemplate.opsForValue().set(<span class="hljs-string">&quot;allCourses&quot;</span>, list,<span class="hljs-number">10</span>, TimeUnit.MINUTES);<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> list;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h2 id="如何保证redis中数据是最新的"><a href="#如何保证redis中数据是最新的" class="headerlink" title="如何保证redis中数据是最新的"></a>如何保证redis中数据是最新的</h2><ul>
<li>如果课程中内容发生变化，通过我们在修改课程内容的时候，会先将redis中的相关集合删除。</li>
<li>然后将最新的数据保存到数据库</li>
<li>而查询数据时，因为redis中的数据已经删除了，所以会第一时间去数据库查询，保证数据是最新的。</li>
</ul>
<h2 id="使用mybatisplus换血大改造"><a href="#使用mybatisplus换血大改造" class="headerlink" title="使用mybatisplus换血大改造"></a>使用mybatisplus换血大改造</h2><ul>
<li>mp并不支持多表查询，所以我们通过oop的思想进行数据组装</li>
<li>90%的查询优化都是采用：“空间换时间”，用基本的查询多执行几次</li>
<li>基础查询我们使用entity的mapper，再将数据拷贝到entityDTO中进行组装（entity删除依赖，entityDTO添加依赖）</li>
</ul>
<hr>



<ul>
<li>entityDTO</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CourseDTO</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> Teacher teacher; <span class="hljs-comment">// 一门课程对应一个讲师</span><br>    <span class="hljs-keyword">private</span> List&lt;CourseLesson&gt; lessonsDTO2; <span class="hljs-comment">// 一门课程关联前两节课时</span><br>    <span class="hljs-keyword">private</span> List&lt;SectionDTO&gt; courseSections; <span class="hljs-comment">//一门课程对应多个章节</span><br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SectionDTO</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> List&lt;LessonDTO&gt; courseLessons; <span class="hljs-comment">// 一章对应多个小节</span><br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">LessonDTO</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> CourseMedia courseMedia; <span class="hljs-comment">// 一小节课对应一个视频</span><br></code></pre></td></tr></table></figure>

<ul>
<li><p>生成基础Mapper</p>
<ul>
<li><p>CourseMapper</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CourseMapper</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;Course&gt;  <span class="hljs-comment">// Course基础实体类，查数据库</span><br></code></pre></td></tr></table></figure>
</li>
<li><p>LessonMapper</p>
</li>
<li><p>SectionMapper</p>
</li>
<li><p>TeacherMapper</p>
</li>
<li><p>MediaMapper</p>
</li>
</ul>
</li>
<li><p>CourseServiceImpl</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br><span class="line">138</span><br><span class="line">139</span><br><span class="line">140</span><br><span class="line">141</span><br><span class="line">142</span><br><span class="line">143</span><br><span class="line">144</span><br><span class="line">145</span><br><span class="line">146</span><br><span class="line">147</span><br><span class="line">148</span><br><span class="line">149</span><br><span class="line">150</span><br><span class="line">151</span><br><span class="line">152</span><br><span class="line">153</span><br><span class="line">154</span><br><span class="line">155</span><br><span class="line">156</span><br><span class="line">157</span><br><span class="line">158</span><br><span class="line">159</span><br><span class="line">160</span><br><span class="line">161</span><br><span class="line">162</span><br><span class="line">163</span><br><span class="line">164</span><br><span class="line">165</span><br><span class="line">166</span><br><span class="line">167</span><br><span class="line">168</span><br><span class="line">169</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.lagou.educourseboot.service.impl;<br><br><span class="hljs-keyword">import</span> com.baomidou.mybatisplus.core.conditions.query.QueryWrapper;<br><span class="hljs-keyword">import</span> com.lagou.educourseboot.entity.*;<br><span class="hljs-keyword">import</span> com.lagou.educourseboot.mapper.*;<br><span class="hljs-keyword">import</span> com.lagou.educourseboot.service.CourseService;<br><span class="hljs-keyword">import</span> org.springframework.beans.BeanUtils;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Autowired;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.core.RedisTemplate;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.RedisSerializer;<br><span class="hljs-keyword">import</span> org.springframework.data.redis.serializer.StringRedisSerializer;<br><span class="hljs-keyword">import</span> org.springframework.stereotype.Service;<br><br><span class="hljs-keyword">import</span> java.util.ArrayList;<br><span class="hljs-keyword">import</span> java.util.List;<br><span class="hljs-keyword">import</span> java.util.concurrent.TimeUnit;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@BelongsProject</span>: edu-lagou</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span>: GuoAn.Sun</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@CreateTime</span>: 2021-03-03 15:43</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span>:</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CourseServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CourseService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CourseMapper courseMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> TeacherMapper teacherMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> LessonMapper lessonMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SectionMapper sectionMapper;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> MediaMapper mediaMapper;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RedisTemplate&lt;Object,Object&gt; redisTemplate;<br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;CourseDTO&gt; <span class="hljs-title function_">getAllCourse</span><span class="hljs-params">()</span> &#123;<br>        <span class="hljs-comment">//将redis内存中的序列化的集合名称用String重新命名（增加可读性）</span><br>        <span class="hljs-type">RedisSerializer</span> <span class="hljs-variable">rs</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">StringRedisSerializer</span>();<br>        redisTemplate.setKeySerializer(rs);<br><br>        <span class="hljs-comment">// 1、先去redis中查询</span><br>        System.out.println(<span class="hljs-string">&quot;***查询redis***&quot;</span>);<br>        <span class="hljs-comment">// 课程dto集合</span><br>        List&lt;CourseDTO&gt; courseDTOS = ( List&lt;CourseDTO&gt;)redisTemplate.opsForValue().get(<span class="hljs-string">&quot;allCourses&quot;</span>);<br>        <span class="hljs-comment">// 2、redis中没有，才回去mysql查询</span><br>        <span class="hljs-keyword">if</span>(<span class="hljs-literal">null</span> == courseDTOS)&#123;<br>            <span class="hljs-keyword">synchronized</span> (<span class="hljs-built_in">this</span>) &#123;<br>                courseDTOS = ( List&lt;CourseDTO&gt;)redisTemplate.opsForValue().get(<span class="hljs-string">&quot;allCourses&quot;</span>);<br>                <span class="hljs-keyword">if</span>(<span class="hljs-literal">null</span> == courseDTOS)&#123;<br>                    System.out.println(<span class="hljs-string">&quot;===查询mysql===&quot;</span>);<br>                    <span class="hljs-comment">// 查询全部课程</span><br>                    List&lt;Course&gt; courses = getInitCourse();<br>                    courseDTOS = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>                    <span class="hljs-keyword">for</span>(Course course : courses)&#123;<br>                        <span class="hljs-type">CourseDTO</span> <span class="hljs-variable">dto</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CourseDTO</span>();<br>                        <span class="hljs-comment">// course将属性全部赋给给courseDTO对象</span><br>                        BeanUtils.copyProperties(course, dto);<br>                        courseDTOS.add(dto);<br>                        <span class="hljs-comment">// 设置老师</span><br>                        setTeacher(dto);<br>                        <span class="hljs-comment">// 设置前两节课</span><br>                        setTop2Lesson(dto);<br>                    &#125;<br>                    redisTemplate.opsForValue().set(<span class="hljs-string">&quot;allCourses&quot;</span>, courseDTOS, <span class="hljs-number">10</span>, TimeUnit.MINUTES);<br>                &#125;<br>            &#125;<br>        &#125;<br>        <span class="hljs-keyword">return</span> courseDTOS;<br>    &#125;<br><br>    <span class="hljs-comment">// 初始化基本的全部课程</span><br>    <span class="hljs-keyword">private</span> List&lt;Course&gt; <span class="hljs-title function_">getInitCourse</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">QueryWrapper</span> <span class="hljs-variable">q</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>();<br>        q.eq(<span class="hljs-string">&quot;status&quot;</span>, <span class="hljs-number">1</span>);<span class="hljs-comment">// 已上架</span><br>        q.eq(<span class="hljs-string">&quot;is_del&quot;</span>, Boolean.FALSE);<span class="hljs-comment">// 未删除</span><br>        q.orderByDesc(<span class="hljs-string">&quot; sort_num &quot;</span>);<span class="hljs-comment">// 排序</span><br>        <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.courseMapper.selectList(q);<br>    &#125;<br><br>    <span class="hljs-comment">// 基本的老师查询</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTeacher</span><span class="hljs-params">( CourseDTO courseDTO)</span>&#123;<br>        <span class="hljs-type">QueryWrapper</span> <span class="hljs-variable">q</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>();<br>        q.eq(<span class="hljs-string">&quot;course_id&quot;</span>, courseDTO.getId());<span class="hljs-comment">// 一个课程，一个老师</span><br>        q.eq(<span class="hljs-string">&quot;is_del&quot;</span>, Boolean.FALSE);<span class="hljs-comment">// 未删除</span><br>        <span class="hljs-type">Teacher</span> <span class="hljs-variable">teacher</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.teacherMapper.selectOne(q);<br>        courseDTO.setTeacher(teacher);<br>    &#125;<br>    <span class="hljs-comment">// 前两节课</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setTop2Lesson</span><span class="hljs-params">( CourseDTO courseDTO )</span>&#123;<br>        <span class="hljs-type">QueryWrapper</span> <span class="hljs-variable">q</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>();<br>        q.eq(<span class="hljs-string">&quot;course_id&quot;</span>, courseDTO.getId());<span class="hljs-comment">// 一个课程，一个老师</span><br>        q.eq(<span class="hljs-string">&quot;is_del&quot;</span>, Boolean.FALSE);<span class="hljs-comment">// 未删除</span><br>        q.orderByAsc(<span class="hljs-string">&quot;section_id&quot;</span>,<span class="hljs-string">&quot;order_num&quot;</span>); <span class="hljs-comment">//排序</span><br>        q.last(<span class="hljs-string">&quot;limit 0, &quot;</span> + <span class="hljs-number">2</span>); <span class="hljs-comment">// 只要前2条数据</span><br>        List&lt;CourseLesson&gt; list = <span class="hljs-built_in">this</span>.lessonMapper.selectList(q);<br>        courseDTO.setLessonsDTO2(list);<br>    &#125;<br><br><br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> CourseDTO <span class="hljs-title function_">getCourseById</span><span class="hljs-params">(Integer courseid)</span> &#123;<br>        <span class="hljs-comment">// 根据课程id获取课程的基本信息</span><br>        <span class="hljs-type">Course</span> <span class="hljs-variable">course</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.courseMapper.selectOne(<span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;Course&gt;().eq(<span class="hljs-string">&quot;id&quot;</span>, courseid));<br>        <span class="hljs-type">CourseDTO</span> <span class="hljs-variable">courseDTO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CourseDTO</span>();<br>        BeanUtils.copyProperties(course, courseDTO);<br>        <span class="hljs-comment">// 关联老师</span><br>        setTeacher(courseDTO);<br>        <span class="hljs-comment">// 关联章节</span><br>        List&lt;SectionDTO&gt; sectionDTOS = getCourseSection(courseDTO);<br>        courseDTO.setCourseSections(sectionDTOS);<br>        <span class="hljs-keyword">return</span> courseDTO;<br>    &#125;<br><br>    <span class="hljs-comment">// 关联章节</span><br>    <span class="hljs-keyword">private</span> List&lt;SectionDTO&gt; <span class="hljs-title function_">getCourseSection</span><span class="hljs-params">(CourseDTO courseDTO)</span>&#123;<br>        <span class="hljs-type">QueryWrapper</span> <span class="hljs-variable">q</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>();<br>        q.eq(<span class="hljs-string">&quot;course_id&quot;</span>, courseDTO.getId());<span class="hljs-comment">// 一个课程，N章</span><br>        q.eq(<span class="hljs-string">&quot;is_del&quot;</span>, Boolean.FALSE);<span class="hljs-comment">// 未删除</span><br>        q.eq(<span class="hljs-string">&quot;status&quot;</span>, <span class="hljs-number">2</span>);<span class="hljs-comment">// 已发布</span><br>        q.orderByAsc(<span class="hljs-string">&quot;order_num&quot;</span>); <span class="hljs-comment">//排序</span><br><br>        <span class="hljs-comment">// 基本的章节集合</span><br>        List&lt;CourseSection&gt; list = <span class="hljs-built_in">this</span>.sectionMapper.selectList(q);<br>        <span class="hljs-comment">// 关联的章节集合</span><br>        List&lt;SectionDTO&gt; sectionDTOS = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>        <span class="hljs-keyword">for</span>(CourseSection section : list)&#123;<br>            <span class="hljs-type">SectionDTO</span> <span class="hljs-variable">sectionDTO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SectionDTO</span>();<br>            BeanUtils.copyProperties(section, sectionDTO);<br><br>            q.clear(); <span class="hljs-comment">// 清除条件</span><br>            q.eq(<span class="hljs-string">&quot;section_id&quot;</span>, sectionDTO.getId());<span class="hljs-comment">// 已发布</span><br>            q.eq(<span class="hljs-string">&quot;is_del&quot;</span>, Boolean.FALSE);<span class="hljs-comment">// 未删除</span><br>            q.orderByDesc(<span class="hljs-string">&quot;order_num&quot;</span>); <span class="hljs-comment">//排序</span><br>            <span class="hljs-comment">// 某章节的全部小节（基本信息）</span><br>            List&lt;CourseLesson&gt; lessons = <span class="hljs-built_in">this</span>.lessonMapper.selectList(q);<br>            <span class="hljs-comment">// 某章节的全部小节（关联信息）</span><br>            List&lt;LessonDTO&gt; lessonDTOS = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>            <span class="hljs-keyword">for</span>(CourseLesson lesson : lessons)&#123;<br>                <span class="hljs-type">LessonDTO</span> <span class="hljs-variable">lessonDTO</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">LessonDTO</span>();<br>                BeanUtils.copyProperties(lesson, lessonDTO);<br>                <span class="hljs-comment">// 设置每节课对应的视频</span><br>                setMedia(lessonDTO);<br>                lessonDTOS.add(lessonDTO);<br>            &#125;<br>            <span class="hljs-comment">// 章节关联所有小节</span><br>            sectionDTO.setCourseLessons(lessonDTOS);<br>            <span class="hljs-comment">// 某个章节放入到章节集合</span><br>            sectionDTOS.add(sectionDTO);<br>        &#125;<br>        <span class="hljs-keyword">return</span> sectionDTOS;<br>    &#125;<br><br>    <span class="hljs-comment">// 设置每节课的视频</span><br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">setMedia</span><span class="hljs-params">(  LessonDTO lessonDTO )</span>&#123;<br>        <span class="hljs-type">QueryWrapper</span> <span class="hljs-variable">q</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>();<br>        q.eq(<span class="hljs-string">&quot;lesson_id&quot;</span>, lessonDTO.getId());<span class="hljs-comment">// 一节课，一个视频</span><br>        q.eq(<span class="hljs-string">&quot;is_del&quot;</span>, Boolean.FALSE);<span class="hljs-comment">// 未删除</span><br>        <span class="hljs-type">CourseMedia</span> <span class="hljs-variable">media</span> <span class="hljs-operator">=</span> <span class="hljs-built_in">this</span>.mediaMapper.selectOne(q);<br>        lessonDTO.setCourseMedia(media);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>





<hr>
<h1 id="06-留言微服务：8005"><a href="#06-留言微服务：8005" class="headerlink" title="06 留言微服务：8005"></a>06 留言微服务：<font style='color:red;'>8005</font></h1><p>edu-comment-boot：留言微服务：<font style='color:red;'>8005</font></p>
<ul>
<li>pom</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.lagou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>edu-lagou<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>edu-comment-boot<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>edu-comment-boot<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- web --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- eureka客户端 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>		<span class="hljs-comment">&lt;!-- mybatis plus --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- mysql --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>runtime<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--pojo持久化使用--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.persistence<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.persistence-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>yml</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8005</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">edu-comment-boot</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.204.141:3306/edu_comment?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=UTC</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123123</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:7001/eureka/</span><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">prefer-ip-address:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">instance-id:</span> <span class="hljs-string">$&#123;spring.cloud.client.ip-address&#125;:$&#123;server.port&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><p>entity</p>
<ul>
<li>CourseComment.java</li>
</ul>
</li>
<li><p>CourseCommentFavoriteRecord.java</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">/**</span><br><span class="hljs-comment">* 主键</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@TableId(type = IdType.AUTO)</span><br><span class="hljs-keyword">private</span> Integer id;<br></code></pre></td></tr></table></figure>

<h2 id="1、保存留言和查询全部留言"><a href="#1、保存留言和查询全部留言" class="headerlink" title="1、保存留言和查询全部留言"></a>1、保存留言和查询全部留言</h2><ul>
<li>controller</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;comment&quot;)</span><br><span class="hljs-meta">@CrossOrigin</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommentController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CommentService commentService;<br><br>    <span class="hljs-meta">@GetMapping(&quot;saveCourseComment&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">saveCourseComment</span><span class="hljs-params">(Integer courseid,Integer userid,String username,String comment)</span> <span class="hljs-keyword">throws</span> UnsupportedEncodingException &#123;<br>        System.out.println(<span class="hljs-string">&quot;昵称：&quot;</span> + username);<br>        System.out.println(<span class="hljs-string">&quot;内容：&quot;</span> + comment);<br>        <span class="hljs-type">CourseComment</span> <span class="hljs-variable">courseComment</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CourseComment</span>();<br>        courseComment.setCourseId(courseid); <span class="hljs-comment">// 课程编号</span><br>        courseComment.setSectionId(<span class="hljs-number">0</span>); <span class="hljs-comment">// 章节编号 （预留字段，为项目的2.0版本保留）</span><br>        courseComment.setLessonId(<span class="hljs-number">0</span>);<span class="hljs-comment">// 小节编号（预留字段，为项目的2.0版本保留）</span><br>        courseComment.setUserId(userid); <span class="hljs-comment">// 用户编号</span><br>        courseComment.setUserName(username); <span class="hljs-comment">// 用户昵称</span><br>        courseComment.setParentId(<span class="hljs-number">0</span>); <span class="hljs-comment">//没有父id（预留字段，为项目的2.0版本保留）</span><br>        courseComment.setComment(comment);<span class="hljs-comment">// 留言内容</span><br>        courseComment.setType(<span class="hljs-number">0</span>); <span class="hljs-comment">// 0用户留言（预留字段，为项目的2.0版本保留）</span><br>        courseComment.setLastOperator(userid); <span class="hljs-comment">//最后操作的用户编号</span><br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> commentService.saveComment(courseComment);<br>        <span class="hljs-keyword">return</span> i;<br>    &#125;<br><br><br>    <span class="hljs-meta">@GetMapping(&quot;getCourseCommentList/&#123;courseid&#125;/&#123;pageIndex&#125;/&#123;pageSize&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> List&lt;CourseComment&gt; <span class="hljs-title function_">getCommentsByCourseId</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;courseid&quot;)</span> Integer courseid,<span class="hljs-meta">@PathVariable(&quot;pageIndex&quot;)</span> Integer pageIndex,<span class="hljs-meta">@PathVariable(&quot;pageSize&quot;)</span> Integer pageSize)</span>&#123;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">offset</span> <span class="hljs-operator">=</span> (pageIndex-<span class="hljs-number">1</span>)*pageSize;<br>        List&lt;CourseComment&gt; list = commentService.getCommentsByCourseId(courseid, offset, pageSize);<br>        System.out.println(<span class="hljs-string">&quot;获取第&quot;</span>+courseid+<span class="hljs-string">&quot;门课程的留言：共计&quot;</span>+list.size()+<span class="hljs-string">&quot;条&quot;</span>);<br>        <span class="hljs-keyword">return</span> list;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;saveFavorite/&#123;commentid&#125;/&#123;userid&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">saveFavorite</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;commentid&quot;)</span> Integer commentid,<span class="hljs-meta">@PathVariable(&quot;userid&quot;)</span> Integer userid)</span>&#123;<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">integer</span> <span class="hljs-operator">=</span> commentService.saveFavorite(commentid, userid);<br>        <span class="hljs-keyword">return</span> integer;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;cancelFavorite/&#123;commentid&#125;/&#123;userid&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">cancelFavorite</span><span class="hljs-params">(<span class="hljs-meta">@PathVariable(&quot;commentid&quot;)</span> Integer commentid,<span class="hljs-meta">@PathVariable(&quot;userid&quot;)</span> Integer userid)</span>&#123;<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">integer</span> <span class="hljs-operator">=</span> commentService.cancelFavorite(commentid, userid);<br>        <span class="hljs-keyword">return</span> integer;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>service</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CommentService</span> &#123;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 保存留言</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> comment 留言内容对象</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 受影响的行数</span><br><span class="hljs-comment">     */</span><br>    Integer <span class="hljs-title function_">saveComment</span><span class="hljs-params">(CourseComment comment)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 某个课程的全部留言（分页）</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> courseid 课程编号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> offset 数据偏移</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageSize 每页条目数</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 留言集合</span><br><span class="hljs-comment">     */</span><br>    List&lt;CourseComment&gt; <span class="hljs-title function_">getCommentsByCourseId</span><span class="hljs-params">(Integer courseid, Integer offset, Integer pageSize)</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 点赞</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> comment_id 留言编号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userid 用户编号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 0：保存失败，1：保存成功</span><br><span class="hljs-comment">     */</span><br>    Integer <span class="hljs-title function_">saveFavorite</span><span class="hljs-params">(Integer comment_id,Integer userid)</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 取消赞</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> comment_id 留言编号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userid 用户编号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 0：保存失败，1：保存成功</span><br><span class="hljs-comment">     */</span><br>    Integer <span class="hljs-title function_">cancelFavorite</span><span class="hljs-params">(Integer comment_id,Integer userid)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommentServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CommentService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CourseCommentDao courseCommentDao;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CourseCommentFavoriteRecordDao courseCommentFavoriteRecordDao;<br><br>    <span class="hljs-comment">//保存留言</span><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">saveComment</span><span class="hljs-params">(CourseComment comment)</span> &#123;<br>        <span class="hljs-keyword">return</span> courseCommentDao.insert(comment);<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> List&lt;CourseComment&gt; <span class="hljs-title function_">getCommentsByCourseId</span><span class="hljs-params">(Integer courseid, Integer offset, Integer pageSize)</span> &#123;<br>        <span class="hljs-keyword">return</span> courseCommentDao.getCommentsByCourseId(courseid, offset, pageSize);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *点赞：</span><br><span class="hljs-comment">     * 先查看当前用户对这条留言是否点过赞，</span><br><span class="hljs-comment">     * 如果点过：修改is_del状态即可，取消赞</span><br><span class="hljs-comment">     * 如果没点过：保存一条点赞的信息</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * 最终，更新赞的数量</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">saveFavorite</span><span class="hljs-params">(Integer comment_id, Integer userid)</span> &#123;<br>        QueryWrapper&lt;CourseCommentFavoriteRecord&gt; qw = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();<br>        qw.eq(<span class="hljs-string">&quot;comment_id&quot;</span>, comment_id); <span class="hljs-comment">// where comment_id = #&#123;cid&#125;</span><br>        qw.eq(<span class="hljs-string">&quot;user_id&quot;</span>, userid); <span class="hljs-comment">// and user_id = #&#123;uid&#125;</span><br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> courseCommentFavoriteRecordDao.selectCount(qw);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">i1</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-type">int</span> <span class="hljs-variable">i2</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">if</span>(i == <span class="hljs-number">0</span>)&#123; <span class="hljs-comment">//没点过赞</span><br>            <span class="hljs-comment">// 保存赞信息</span><br>            <span class="hljs-type">CourseCommentFavoriteRecord</span> <span class="hljs-variable">favoriteRecord</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CourseCommentFavoriteRecord</span>();<br>            favoriteRecord.setCommentId(comment_id);<br>            favoriteRecord.setUserId(userid);<br>            favoriteRecord.setIsDel(<span class="hljs-number">0</span>);<br>            favoriteRecord.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>            favoriteRecord.setUpdateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>            i1 = courseCommentFavoriteRecordDao.insert(favoriteRecord);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-comment">// 更新赞的状态</span><br>            <span class="hljs-type">CourseCommentFavoriteRecord</span> <span class="hljs-variable">favoriteRecord</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CourseCommentFavoriteRecord</span>();<br>            favoriteRecord.setIsDel(<span class="hljs-number">0</span>);<br><br>            QueryWrapper&lt;CourseCommentFavoriteRecord&gt; qw2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();<br>            qw2.eq(<span class="hljs-string">&quot;comment_id&quot;</span>, comment_id); <span class="hljs-comment">// where comment_id = #&#123;cid&#125;</span><br>            qw2.eq(<span class="hljs-string">&quot;user_id&quot;</span>, userid); <span class="hljs-comment">// and user_id = #&#123;uid&#125;</span><br>            i1 = courseCommentFavoriteRecordDao.update(favoriteRecord,qw2);<br>        &#125;<br>        <span class="hljs-comment">// 更新本条留言赞的数量</span><br>        i2 = courseCommentDao.updateLikeCount(<span class="hljs-number">1</span>,comment_id);<br><br>        <span class="hljs-keyword">if</span>(i1 == <span class="hljs-number">0</span> || i2 == <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-comment">// 在项目中，使用抛异常的方式来回滚事务！</span><br>            <span class="hljs-keyword">throw</span>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;点赞失败！&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> comment_id;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 删除点赞的信息（is_del = 1）</span><br><span class="hljs-comment">     * 更新留言赞的数量-1</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> comment_id 留言编号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userid 用户编号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 0:失败，1：成功</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">cancelFavorite</span><span class="hljs-params">(Integer comment_id, Integer userid)</span> &#123;<br>        <span class="hljs-comment">//Integer i1 = courseCommentDao.updateFavoriteStatus(1, comment_id, userid);</span><br>        <span class="hljs-type">CourseCommentFavoriteRecord</span> <span class="hljs-variable">favoriteRecord</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CourseCommentFavoriteRecord</span>();<br>        favoriteRecord.setIsDel(<span class="hljs-number">1</span>);<br><br>        QueryWrapper&lt;CourseCommentFavoriteRecord&gt; qw = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();<br>        qw.eq(<span class="hljs-string">&quot;comment_id&quot;</span>, comment_id); <span class="hljs-comment">// where comment_id = #&#123;cid&#125;</span><br>        qw.eq(<span class="hljs-string">&quot;user_id&quot;</span>, userid); <span class="hljs-comment">// and user_id = #&#123;uid&#125;</span><br><br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">i1</span> <span class="hljs-operator">=</span> courseCommentFavoriteRecordDao.update(favoriteRecord,qw);<br><br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">i2</span> <span class="hljs-operator">=</span> courseCommentDao.updateLikeCount(-<span class="hljs-number">1</span>,comment_id);<br><br>        <span class="hljs-keyword">if</span>(i1 == <span class="hljs-number">0</span> || i2 == <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">throw</span>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;取消赞失败！&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> i2;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>mapper</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CourseCommentDao</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;CourseComment&gt; &#123;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 某个课程的全部留言（分页）</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> courseid 课程编号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> offset 数据偏移</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> pageSize 每页条目数</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 留言集合</span><br><span class="hljs-comment">     */</span><br><span class="hljs-meta">@Select(&#123;&quot;SELECT * FROM course_comment \n&quot; +</span><br><span class="hljs-meta">            &quot;        WHERE is_del = 0\n&quot; +</span><br><span class="hljs-meta">            &quot;        AND course_id = #&#123;courseid&#125;\n&quot; +</span><br><span class="hljs-meta">            &quot;        ORDER BY is_top DESC , like_count DESC , create_time DESC\n&quot; +</span><br><span class="hljs-meta">            &quot;        LIMIT #&#123;offset&#125;, #&#123;pageSize&#125;&quot;&#125;)</span><br>    <span class="hljs-meta">@Results(&#123;</span><br><span class="hljs-meta">            @Result(column = &quot;id&quot;,property = &quot;id&quot;),</span><br><span class="hljs-meta">            @Result(column = &quot;id&quot; , property = &quot;favoriteRecords&quot;, many = @Many(select = &quot;com.lagou.educommentboot.mapper.CourseCommentFavoriteRecordDao.getFavorites&quot;))</span><br><span class="hljs-meta">    &#125;)</span><br>    List&lt;CourseComment&gt; <span class="hljs-title function_">getCommentsByCourseId</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;courseid&quot;)</span> Integer courseid, <span class="hljs-meta">@Param(&quot;offset&quot;)</span> Integer offset, <span class="hljs-meta">@Param(&quot;pageSize&quot;)</span> Integer pageSize)</span>;<br><br><br>    <span class="hljs-meta">@Update(&#123;&quot;update course_comment set like_count = like_count + #&#123;x&#125; where id = #&#123;comment_id&#125;&quot;&#125;)</span><br>    Integer <span class="hljs-title function_">updateLikeCount</span><span class="hljs-params">(<span class="hljs-meta">@Param(&quot;x&quot;)</span> Integer x, <span class="hljs-meta">@Param(&quot;comment_id&quot;)</span> Integer comment_id)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">CourseCommentFavoriteRecordDao</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;CourseCommentFavoriteRecord&gt; &#123;<br><br>    <span class="hljs-meta">@Select(&#123;&quot;SELECT * FROM course_comment_favorite_record WHERE comment_id = #&#123;commnet_id&#125; and is_del = 0&quot;&#125;)</span><br>    List&lt;CourseCommentFavoriteRecord&gt; <span class="hljs-title function_">getFavorites</span><span class="hljs-params">(Integer comment_id)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>启动类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableEurekaClient</span> <span class="hljs-comment">// 注册到中心的客户端</span><br><span class="hljs-meta">@MapperScan(&quot;com.lagou.educommentboot.mapper&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EduCommentBootApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(EduCommentBootApplication.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><a target="_blank" rel="noopener" href="http://localhost:8005/comment/getCourseCommentList/7/1/20">http://localhost:8005/comment/getCourseCommentList/7/1/20</a></p>
<h2 id="2、点赞和取消赞"><a href="#2、点赞和取消赞" class="headerlink" title="2、点赞和取消赞"></a>2、点赞和取消赞</h2><ul>
<li>CourseCommentDao.java中留下updateLikeCount()方法即可</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">CommentServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">CommentService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CourseCommentDao courseCommentDao;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> CourseCommentFavoriteRecordDao courseCommentFavoriteRecordDao;<br><br>    <span class="hljs-comment">//保存留言</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">saveComment</span><span class="hljs-params">(CourseComment comment)</span> &#123;<br>        <span class="hljs-keyword">return</span> courseCommentDao.insert(comment);<br>    &#125;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> List&lt;CourseComment&gt; <span class="hljs-title function_">getCommentsByCourseId</span><span class="hljs-params">(Integer courseid, Integer offset, Integer pageSize)</span> &#123;<br>        <span class="hljs-keyword">return</span> courseCommentDao.getCommentsByCourseId(courseid, offset, pageSize);<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     *点赞：</span><br><span class="hljs-comment">     * 先查看当前用户对这条留言是否点过赞，</span><br><span class="hljs-comment">     * 如果点过：修改is_del状态即可，取消赞</span><br><span class="hljs-comment">     * 如果没点过：保存一条点赞的信息</span><br><span class="hljs-comment">     *</span><br><span class="hljs-comment">     * 最终，更新赞的数量</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">saveFavorite</span><span class="hljs-params">(Integer comment_id, Integer userid)</span> &#123;<br>        QueryWrapper&lt;CourseCommentFavoriteRecord&gt; qw = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();<br>        qw.eq(<span class="hljs-string">&quot;comment_id&quot;</span>, comment_id); <span class="hljs-comment">// where comment_id = #&#123;cid&#125;</span><br>        qw.eq(<span class="hljs-string">&quot;user_id&quot;</span>, userid); <span class="hljs-comment">// and user_id = #&#123;uid&#125;</span><br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">i</span> <span class="hljs-operator">=</span> courseCommentFavoriteRecordDao.selectCount(qw);<br><br>        <span class="hljs-type">int</span> <span class="hljs-variable">i1</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;                                                 <br>        <span class="hljs-type">int</span> <span class="hljs-variable">i2</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>        <span class="hljs-keyword">if</span>(i == <span class="hljs-number">0</span>)&#123; <span class="hljs-comment">//没点过赞</span><br>            <span class="hljs-comment">// 保存赞信息</span><br>            <span class="hljs-type">CourseCommentFavoriteRecord</span> <span class="hljs-variable">favoriteRecord</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CourseCommentFavoriteRecord</span>();<br>            favoriteRecord.setCommentId(comment_id);<br>            favoriteRecord.setUserId(userid);<br>            favoriteRecord.setIsDel(<span class="hljs-number">0</span>);<br>            favoriteRecord.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>            favoriteRecord.setUpdateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>            i1 = courseCommentFavoriteRecordDao.insert(favoriteRecord);<br>        &#125;<span class="hljs-keyword">else</span>&#123;<br>            <span class="hljs-comment">// 更新赞的状态</span><br>            <span class="hljs-type">CourseCommentFavoriteRecord</span> <span class="hljs-variable">favoriteRecord</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CourseCommentFavoriteRecord</span>();<br>            favoriteRecord.setIsDel(<span class="hljs-number">0</span>);<br><br>            QueryWrapper&lt;CourseCommentFavoriteRecord&gt; qw2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();<br>            qw2.eq(<span class="hljs-string">&quot;comment_id&quot;</span>, comment_id); <span class="hljs-comment">// where comment_id = #&#123;cid&#125;</span><br>            qw2.eq(<span class="hljs-string">&quot;user_id&quot;</span>, userid); <span class="hljs-comment">// and user_id = #&#123;uid&#125;</span><br>            i1 = courseCommentFavoriteRecordDao.update(favoriteRecord,qw2);<br>        &#125;<br>        <span class="hljs-comment">// 更新本条留言赞的数量</span><br>        i2 = courseCommentDao.updateLikeCount(<span class="hljs-number">1</span>,comment_id);<br><br>        <span class="hljs-keyword">if</span>(i1 == <span class="hljs-number">0</span> || i2 == <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-comment">// 在项目中，使用抛异常的方式来回滚事务！</span><br>            <span class="hljs-keyword">throw</span>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;点赞失败！&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> comment_id;<br>    &#125;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 删除点赞的信息（is_del = 1）</span><br><span class="hljs-comment">     * 更新留言赞的数量-1</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> comment_id 留言编号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@param</span> userid 用户编号</span><br><span class="hljs-comment">     * <span class="hljs-doctag">@return</span> 0:失败，1：成功</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">cancelFavorite</span><span class="hljs-params">(Integer comment_id, Integer userid)</span> &#123;<br>        <span class="hljs-comment">//Integer i1 = courseCommentDao.updateFavoriteStatus(1, comment_id, userid);</span><br>        <span class="hljs-type">CourseCommentFavoriteRecord</span> <span class="hljs-variable">favoriteRecord</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CourseCommentFavoriteRecord</span>();<br>        favoriteRecord.setIsDel(<span class="hljs-number">1</span>);<br><br>        QueryWrapper&lt;CourseCommentFavoriteRecord&gt; qw = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>&lt;&gt;();<br>        qw.eq(<span class="hljs-string">&quot;comment_id&quot;</span>, comment_id); <span class="hljs-comment">// where comment_id = #&#123;cid&#125;</span><br>        qw.eq(<span class="hljs-string">&quot;user_id&quot;</span>, userid); <span class="hljs-comment">// and user_id = #&#123;uid&#125;</span><br><br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">i1</span> <span class="hljs-operator">=</span> courseCommentFavoriteRecordDao.update(favoriteRecord,qw);<br><br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">i2</span> <span class="hljs-operator">=</span> courseCommentDao.updateLikeCount(-<span class="hljs-number">1</span>,comment_id);<br><br>        <span class="hljs-keyword">if</span>(i1 == <span class="hljs-number">0</span> || i2 == <span class="hljs-number">0</span>)&#123;<br>            <span class="hljs-keyword">throw</span>  <span class="hljs-keyword">new</span> <span class="hljs-title class_">RuntimeException</span>(<span class="hljs-string">&quot;取消赞失败！&quot;</span>);<br>        &#125;<br>        <span class="hljs-keyword">return</span> i2;<br>    &#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>



<h2 id="3、前端"><a href="#3、前端" class="headerlink" title="3、前端"></a>3、前端</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- 已赞 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">div</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;cancelzan(comment)&quot;</span> <span class="hljs-attr">v-if</span>=<span class="hljs-string">&quot;JSON.stringify(comment.favoriteRecords).indexOf( userid ) &gt;= 0&quot;</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;message-list-title-right&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">img</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;message-list-title-right-icon&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;实心的心形图标&quot;</span> <span class="hljs-attr">alt</span>=<span class="hljs-string">&quot;&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;message-list-title-right-praise&quot;</span>&gt;</span>&#123;&#123;comment.likeCount&#125;&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure>

<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">import</span> jwtDecode <span class="hljs-keyword">from</span> <span class="hljs-string">&#x27;jwt-decode&#x27;</span>;<br><br><span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>      <span class="hljs-attr">user</span>:<span class="hljs-literal">null</span>, <span class="hljs-comment">// 当前用户</span><br>      <span class="hljs-attr">userid</span>:<span class="hljs-number">666666</span>, <span class="hljs-comment">// 默认值，否则不登陆的话，留言显示失败</span><br>    &#125;;<br>    <br>  <span class="hljs-title function_">created</span>(<span class="hljs-params"></span>)&#123;<br>    <br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">course</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">$route</span>.<span class="hljs-property">params</span>.<span class="hljs-property">course</span>;  <span class="hljs-comment">// 从路由中获得参数对象赋值给本组件的参数</span><br><br>   <span class="hljs-comment">// 从url中获取token参数</span><br>    <span class="hljs-keyword">let</span> token  = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getValueByUrlParams</span>(<span class="hljs-string">&#x27;token&#x27;</span>);<br><br>    <span class="hljs-keyword">if</span>(token == <span class="hljs-literal">null</span> || token == <span class="hljs-string">&quot;&quot;</span>)&#123;<br>      <span class="hljs-comment">// 从cookie中获取user的token</span><br>      token = <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCookie</span>(<span class="hljs-string">&quot;user&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">token</span> = token;<br>   <br>    <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;刷新页面token=&gt;&quot;</span>+token);<br>    <span class="hljs-keyword">if</span>(token != <span class="hljs-literal">null</span> || token != <span class="hljs-string">&quot;&quot;</span>)&#123;<br>      <span class="hljs-comment">// 将token发送到sso进行校验</span><br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">axios</span><br>      .<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;http://localhost:80/user/checkToken&quot;</span>,&#123;<br>        <span class="hljs-attr">params</span>:&#123;<br>          <span class="hljs-attr">token</span>:token<br>        &#125;<br>      &#125;)<br>      .<span class="hljs-title function_">then</span>( <span class="hljs-function">(<span class="hljs-params">result</span>)=&gt;</span>&#123;<br>        <span class="hljs-keyword">if</span>(result.<span class="hljs-property">data</span>.<span class="hljs-property">state</span> == <span class="hljs-number">4</span>)&#123;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">isLogin</span> = <span class="hljs-literal">true</span>;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">setCookie</span>(<span class="hljs-string">&quot;user&quot;</span>,token,<span class="hljs-number">600</span>);<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = <span class="hljs-title function_">jwtDecode</span>(token);<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">userid</span> = <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">userid</span>; <span class="hljs-comment">// 获取当前登录对象的userid</span><br>        &#125;<br>      &#125;)<br>      .<span class="hljs-title function_">catch</span>( <span class="hljs-function">(<span class="hljs-params">error</span>)=&gt;</span>&#123;<br>       &#125;);<br>    &#125;<br>    <br><span class="hljs-comment">// 点赞</span><br><span class="hljs-title function_">zan</span>(<span class="hljs-params">comment</span>)&#123;        <br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">axios</span><br>  .<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;http://localhost:8005/comment/saveFavorite/&quot;</span>+comment.<span class="hljs-property">id</span>+<span class="hljs-string">&quot;/&quot;</span>+<span class="hljs-variable language_">this</span>.<span class="hljs-property">userid</span>)<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// console.log(result);</span><br>    <span class="hljs-comment">// 重新获取本门课的全部留言信息</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getComment</span>();<br>  &#125;).<span class="hljs-title function_">catch</span>( <span class="hljs-function">(<span class="hljs-params">error</span>)=&gt;</span>&#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;点赞失败！&quot;</span>);<br>  &#125; );<br>&#125;,<br><span class="hljs-comment">// 取消赞</span><br><span class="hljs-title function_">cancelzan</span>(<span class="hljs-params">comment</span>)&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">axios</span><br>  .<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;http://localhost:8005/comment/cancelFavorite/&quot;</span>+comment.<span class="hljs-property">id</span>+<span class="hljs-string">&quot;/&quot;</span>+<span class="hljs-variable language_">this</span>.<span class="hljs-property">userid</span>)<br>  .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> &#123;<br>    <span class="hljs-comment">// console.log(result);</span><br>    <span class="hljs-comment">// 重新获取本门课的全部留言信息</span><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getComment</span>();<br>  &#125;).<span class="hljs-title function_">catch</span>( <span class="hljs-function">(<span class="hljs-params">error</span>)=&gt;</span>&#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;取消赞失败！&quot;</span>);<br>  &#125; );<br>&#125;,<br></code></pre></td></tr></table></figure>





<hr>
<h1 id="07-支付与订单：8006"><a href="#07-支付与订单：8006" class="headerlink" title="07 支付与订单：8006"></a>07 支付与订单：<font style='color:red;'>8006</font></h1><p>edu-pay-boot：支付微服务：<font style='color:red;'>8006</font></p>
<ul>
<li>pom与之前的相比，主体并没有变化，多加两个支付相关依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.github.wxpay<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>wxpay-sdk<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.3<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.jfinal<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>jfinal<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.5<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>yml</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8006</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">edu-pay-boot</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:7001/eureka</span><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">prefer-ip-address:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">instance-id:</span> <span class="hljs-string">$&#123;spring.cloud.client.ip-address&#125;:$&#123;server.port&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>commons&#x2F;PayConfig.java</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PayConfig</span> &#123;<br>    <span class="hljs-comment">//企业公众号ID</span><br>    <span class="hljs-comment">//财付通平台的商户密钥</span><br>    <span class="hljs-comment">//回调URL</span><br>    <span class="hljs-comment">//public static String notifyurl=&quot;http://edufront.lagou.com/front/pay/wxCallback&quot;; //success</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> String notifyurl=<span class="hljs-string">&quot;http://localhost:8006/pay/wxCallback&quot;</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>controller&#x2F;WxPayController.java 和之前一样，修改注解后，多加一个方法（微信支付回调到本地）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;pay&quot;)</span><br><span class="hljs-meta">@CrossOrigin</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">WxPayController</span> &#123;<br><br>    <span class="hljs-meta">@GetMapping(&quot;createCode&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">createCode</span><span class="hljs-params">(String courseid,String coursename,String price)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>		<span class="hljs-comment">// 略略略</span><br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;checkOrderStatus&quot;)</span><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">checkOrderStatus</span><span class="hljs-params">(String orderId)</span> <span class="hljs-keyword">throws</span> Exception &#123;<br>		<span class="hljs-comment">// 略略略</span><br>    &#125;<br>    <br>    <span class="hljs-meta">@RequestMapping(&quot;wxCallback&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">wxCallBack</span><span class="hljs-params">(HttpServletRequest request, HttpServletResponse response)</span> <span class="hljs-keyword">throws</span> IOException &#123;<br>        <span class="hljs-type">InputStream</span> <span class="hljs-variable">inStream</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">ByteArrayOutputStream</span> <span class="hljs-variable">outSteam</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-type">String</span> <span class="hljs-variable">resultxml</span> <span class="hljs-operator">=</span> <span class="hljs-literal">null</span>;<br>        <span class="hljs-keyword">try</span> &#123;<br>            inStream = request.getInputStream();<br>            outSteam = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ByteArrayOutputStream</span>();<br>            <span class="hljs-type">byte</span>[] buffer = <span class="hljs-keyword">new</span> <span class="hljs-title class_">byte</span>[<span class="hljs-number">1024</span>];<br>            <span class="hljs-type">int</span> <span class="hljs-variable">len</span> <span class="hljs-operator">=</span> <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">while</span> ((len = inStream.read(buffer)) != -<span class="hljs-number">1</span>) &#123;<br>                outSteam.write(buffer, <span class="hljs-number">0</span>, len);<br>            &#125;<br>            resultxml = <span class="hljs-keyword">new</span> <span class="hljs-title class_">String</span>(outSteam.toByteArray(), <span class="hljs-string">&quot;utf-8&quot;</span>);<br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            System.out.println(<span class="hljs-string">&quot;回调处理失败&quot;</span>);<br>        &#125;<span class="hljs-keyword">finally</span> &#123;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-literal">null</span> != outSteam) &#123;<br>                outSteam.close();<br>            &#125;<br>            <span class="hljs-keyword">if</span>(<span class="hljs-literal">null</span> != inStream) &#123;<br>                inStream.close();<br>            &#125;<br>        &#125;<br>        System.out.println(<span class="hljs-string">&quot;wxCallback - 回调请求参数:&quot;</span>+ resultxml);<br>        <span class="hljs-keyword">return</span> resultxml;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>启动类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableEurekaClient</span> <span class="hljs-comment">// 注册到中心的客户端</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EduPayBootApplication</span> &#123;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(EduPayBootApplication.class, args);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h1 id="订单微服务：8007"><a href="#订单微服务：8007" class="headerlink" title="订单微服务：8007"></a>订单微服务：<font style='color:red;'>8007</font></h1><p>edu-order-boot：订单微服务：<font style='color:red;'>8007</font></p>
<h2 id="1、搭建微服务"><a href="#1、搭建微服务" class="headerlink" title="1、搭建微服务"></a>1、搭建微服务</h2><ul>
<li>将controller中的<code>@Reference</code>修改为<code>@Autowired</code></li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8007</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">edu-order-boot</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.204.141:3306/edu_order?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=UTC</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123123</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:7001/eureka</span><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">prefer-ip-address:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">instance-id:</span> <span class="hljs-string">$&#123;spring.cloud.client.ip-address&#125;:$&#123;server.port&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>实体类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span>  <br><span class="hljs-meta">@Table(name = &quot;user_course_order&quot;)</span> <span class="hljs-comment">// 用户课程订单表</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">UserCourseOrder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">777308790778683330L</span>;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * 主键</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * 订单号</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">private</span> String orderNo;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * 用户id</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">private</span> Object userId;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * 课程id，根据订单中的课程类型来选择</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">private</span> Object courseId;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * 活动课程id</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">private</span> Integer activityCourseId;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * 订单来源类型: 1 用户下单购买 2 后台添加专栏</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">private</span> Object sourceType;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * 当前状态: 0已创建 10已支付 20已完成 30已取消 40已过期 </span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">private</span> Object status;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * 创建时间</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">private</span> Date createTime;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * 更新时间</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">private</span> Date updateTime;<br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">    * 是否删除</span><br><span class="hljs-comment">    */</span><br>    <span class="hljs-keyword">private</span> Object isDel;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>dao接口</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderDao</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;UserCourseOrder&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>service实现类（mybatis plus 改造）</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderDao orderDao;<br>	<span class="hljs-comment">// 保存订单</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveOrder</span><span class="hljs-params">(String orderNo, String user_id, String course_id, String activity_course_id, String source_type)</span> &#123;<br>        <span class="hljs-type">UserCourseOrder</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserCourseOrder</span>();<br><br>        order.setOrderNo(orderNo);<br>        order.setUserId(user_id);<br>        order.setCourseId(course_id);<br>        order.setActivityCourseId( Integer.parseInt(activity_course_id));<br>        order.setSourceType(source_type);<br>        order.setIsDel(<span class="hljs-number">0</span>);<br>        order.setStatus(<span class="hljs-number">0</span>);<br>        order.setCreateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        order.setUpdateTime(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br><br>        orderDao.insert(order);<br>    &#125;<br>    <span class="hljs-comment">// 更新订单状态</span><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">updateOrder</span><span class="hljs-params">(String orderNo, <span class="hljs-type">int</span> status)</span> &#123;<br>        <span class="hljs-type">UserCourseOrder</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">UserCourseOrder</span>();<br>        order.setStatus(status);<br><br>        QueryWrapper&lt;UserCourseOrder&gt; qw = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>();<br>        qw.eq(<span class="hljs-string">&quot;order_no&quot;</span>, orderNo);<br>        <span class="hljs-keyword">return</span> orderDao.update(order,qw);<br>    &#125;<br>	<span class="hljs-comment">// 删除订单</span><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">deleteOrder</span><span class="hljs-params">(String orderNo)</span> &#123;<br>        QueryWrapper&lt;UserCourseOrder&gt; qw = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>();<br>        qw.eq(<span class="hljs-string">&quot;order_no&quot;</span>, orderNo);<br>        <span class="hljs-comment">// delete from user_course_order where order_no = orderNo</span><br>        <span class="hljs-keyword">return</span> orderDao.delete(qw);<br>    &#125;<br>	<span class="hljs-comment">// 查询某个用户的全部订单</span><br>    <span class="hljs-keyword">public</span> List&lt;UserCourseOrder&gt; <span class="hljs-title function_">getOrdersByUserId</span><span class="hljs-params">(String userId)</span> &#123;<br>        QueryWrapper&lt;UserCourseOrder&gt; qw = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>();<br>        qw.eq(<span class="hljs-string">&quot;user_id&quot;</span>, userId);<br>        <span class="hljs-comment">//select * from user_course_order where user_id = userId</span><br>        <span class="hljs-keyword">return</span> orderDao.selectList(qw);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableEurekaClient</span> <span class="hljs-comment">// 注册到中心的客户端</span><br><span class="hljs-meta">@MapperScan(&quot;com.lagou.eduorderboot.mapper&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EduOrderBootApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(EduOrderBootApplication.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="2、添加记录操作"><a href="#2、添加记录操作" class="headerlink" title="2、添加记录操作"></a>2、添加记录操作</h2><ul>
<li>记录操作信息到 pay_order （支付订单信息表） 和 pay_order_record（支付订单状态日志表）</li>
<li>实体类：</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-meta">@Table(name = &quot;pay_order_record&quot;)</span> <span class="hljs-comment">//支付订单状态日志表</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PayOrderRecord</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">777308790778683330L</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 主键</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-keyword">private</span> String order_no;<br>    <span class="hljs-keyword">private</span> String type;<br>    <span class="hljs-keyword">private</span> String from_status;<br>    <span class="hljs-keyword">private</span> String to_status;<br>    <span class="hljs-keyword">private</span> Double paid_amount;<br>    <span class="hljs-keyword">private</span> String remark;<br>    <span class="hljs-keyword">private</span> String created_by;<br>    <span class="hljs-keyword">private</span> Date created_at;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span>  <br><span class="hljs-meta">@Table(name = &quot;pay_order&quot;)</span> <span class="hljs-comment">//支付订单信息表</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">PayOrder</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">Serializable</span> &#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-type">long</span> <span class="hljs-variable">serialVersionUID</span> <span class="hljs-operator">=</span> <span class="hljs-number">777308790778683330L</span>;<br><br>    <span class="hljs-comment">/**</span><br><span class="hljs-comment">     * 主键</span><br><span class="hljs-comment">     */</span><br>    <span class="hljs-meta">@Id</span><br>    <span class="hljs-keyword">private</span> Long id;<br>    <span class="hljs-keyword">private</span> String order_no;<br>    <span class="hljs-keyword">private</span> String user_id;<br>    <span class="hljs-keyword">private</span> String product_id;<br>    <span class="hljs-keyword">private</span> String product_name;<br>    <span class="hljs-keyword">private</span> Double amount;<br>    <span class="hljs-keyword">private</span> Integer count;<br>    <span class="hljs-keyword">private</span> String currency;<br>    <span class="hljs-keyword">private</span> String channel;<br>    <span class="hljs-keyword">private</span> Integer status;<br>    <span class="hljs-keyword">private</span> Integer channel_status;<br>    <span class="hljs-keyword">private</span> Integer order_type;<br>    <span class="hljs-keyword">private</span> Integer source;<br>    <span class="hljs-keyword">private</span> String client_ip;<br>    <span class="hljs-keyword">private</span> String buy_id;<br>    <span class="hljs-keyword">private</span> String out_trade_no;<br>    <span class="hljs-keyword">private</span> Date created_time;<br>    <span class="hljs-keyword">private</span> Date updated_time;<br>    <span class="hljs-keyword">private</span> Date pay_time;<br>    <span class="hljs-keyword">private</span> String extra;<br>    <span class="hljs-keyword">private</span> String goods_order_no;<br>    <span class="hljs-keyword">private</span> Integer platform;<br>    <span class="hljs-keyword">private</span> Integer wx_type;<br>&#125;<br></code></pre></td></tr></table></figure>



<ul>
<li>contorller</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;order&quot;)</span><br><span class="hljs-meta">@CrossOrigin</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderService orderService;<br><br>    <span class="hljs-meta">@GetMapping(&quot;saveOrder&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">saveOrder</span><span class="hljs-params">(String orderNo,String user_id , String course_id,String activity_course_id,String source_type,Double price)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;保存的订单 = &quot;</span> + orderNo);<br>        orderService.saveOrder(orderNo, user_id, course_id, activity_course_id, source_type);<br>        <span class="hljs-comment">// 创建订单记录</span><br>        <span class="hljs-type">PayOrderRecord</span> <span class="hljs-variable">por</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PayOrderRecord</span>();<br>        por.setOrder_no(orderNo);<span class="hljs-comment">// 订单号</span><br>        por.setType(<span class="hljs-string">&quot;CREATE&quot;</span>); <span class="hljs-comment">//操作类型：CREATE\|PAY\|REFUND...</span><br>        por.setPaid_amount(price);<br>        por.setFrom_status(<span class="hljs-string">&quot;0&quot;</span>);<br>        por.setTo_status(<span class="hljs-string">&quot;1&quot;</span>);<br>        por.setCreated_by(<span class="hljs-string">&quot;auto&quot;</span>);<br>        por.setCreated_at(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>        System.out.println(<span class="hljs-string">&quot;创建订单记录 = &quot;</span> + orderNo);<br>        orderService.saveOrderRecord(por);<br><br>        <span class="hljs-keyword">return</span> orderNo;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;updateOrder&quot;)</span><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">updateOrder</span><span class="hljs-params">(String orderNo , Integer status, String user_id , String course_id, String course_name, Double price, HttpServletRequest request)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;订单编号 = &quot;</span> + orderNo);<br>        System.out.println(<span class="hljs-string">&quot;状态编码 = &quot;</span> + status);<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">integer</span> <span class="hljs-operator">=</span> orderService.updateOrder(orderNo, status);<br>        System.out.println(<span class="hljs-string">&quot;订单更新 = &quot;</span> + integer);<br><br>        <span class="hljs-keyword">if</span>(integer == <span class="hljs-number">1</span>)&#123;<br>            <span class="hljs-comment">// 创建支付订单信息</span><br>            <span class="hljs-type">PayOrder</span> <span class="hljs-variable">po</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PayOrder</span>();<br>            po.setOrder_no(orderNo);<span class="hljs-comment">// 订单号</span><br>            po.setUser_id(user_id);<span class="hljs-comment">// 购买者</span><br>            po.setProduct_id(course_id); <span class="hljs-comment">//课程（产品）编号</span><br>            po.setProduct_name(course_name); <span class="hljs-comment">//课程（产品）名称</span><br>            po.setAmount(price);<span class="hljs-comment">// 金额</span><br>            po.setCount(<span class="hljs-number">1</span>); <span class="hljs-comment">// 购买数量</span><br>            po.setCurrency(<span class="hljs-string">&quot;cny&quot;</span>); <span class="hljs-comment">//货币类型：人民币</span><br>            po.setChannel(<span class="hljs-string">&quot;weChat&quot;</span>);  <span class="hljs-comment">//支付渠道：weChat-微信支付</span><br>            po.setStatus(<span class="hljs-number">2</span>); <span class="hljs-comment">// 支付成功</span><br>            po.setOrder_type(<span class="hljs-number">1</span>);<span class="hljs-comment">//类型 1-购买课程</span><br>            po.setSource(<span class="hljs-number">3</span>); <span class="hljs-comment">// 支付来源 1-app 2-h5 3-pc</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">ip</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;&quot;</span>;<br>            <span class="hljs-keyword">if</span> (request != <span class="hljs-literal">null</span>) &#123;<br>                ip = request.getHeader(<span class="hljs-string">&quot;X-FORWARDED-FOR&quot;</span>);<br>                <span class="hljs-keyword">if</span> (ip == <span class="hljs-literal">null</span> || <span class="hljs-string">&quot;&quot;</span>.equals(ip)) &#123;<br>                    ip = request.getRemoteAddr();<br>                &#125;<br>            &#125;<br>            po.setClient_ip(ip); <span class="hljs-comment">// 客户端ip</span><br>            po.setCreated_time(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>            po.setUpdated_time(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br>            <span class="hljs-comment">//支付订单信息</span><br>            orderService.saveOrderInfo(po);<br><br>            <span class="hljs-comment">// 创建支付订单记录</span><br>            <span class="hljs-type">PayOrderRecord</span> <span class="hljs-variable">por</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">PayOrderRecord</span>();<br>            por.setOrder_no(orderNo);<span class="hljs-comment">// 订单号</span><br>            por.setType(<span class="hljs-string">&quot;PAY&quot;</span>); <span class="hljs-comment">//操作类型：CREATE\|PAY\|REFUND...</span><br>            por.setPaid_amount(price);<br>            por.setFrom_status(<span class="hljs-string">&quot;1&quot;</span>);<br>            por.setTo_status(<span class="hljs-string">&quot;2&quot;</span>);<br>            por.setCreated_by(<span class="hljs-string">&quot;auto&quot;</span>);<br>            por.setCreated_at(<span class="hljs-keyword">new</span> <span class="hljs-title class_">Date</span>());<br><br>            <span class="hljs-comment">//支付订单状态日志</span><br>            orderService.saveOrderRecord(por);<br>        &#125;<br>        <span class="hljs-keyword">return</span> integer;<br>    &#125;<br><br>    <span class="hljs-meta">@GetMapping(&quot;deleteOrder&quot;)</span><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">deleteOrder</span><span class="hljs-params">(String orderno)</span> &#123;<br>        System.out.println(<span class="hljs-string">&quot;取消的订单 = &quot;</span> + orderno);<br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">integer</span> <span class="hljs-operator">=</span> orderService.deleteOrder(orderno);<br>        <span class="hljs-keyword">return</span> integer;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>service</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderService</span> &#123;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveOrderInfo</span><span class="hljs-params">(PayOrder po )</span>;<br>    <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveOrderRecord</span><span class="hljs-params">( PayOrderRecord por)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderService</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderDao orderDao;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> PayOrderDao payOrderDao;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> PayOrderRecordDao payOrderRecordDao;<br><br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveOrderInfo</span><span class="hljs-params">(PayOrder po)</span>&#123;<br>        payOrderDao.insert(po);<br>        System.out.println(<span class="hljs-string">&quot;----------------------- 保存parorder&quot;</span>);<br>    &#125;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">saveOrderRecord</span><span class="hljs-params">(PayOrderRecord por)</span>&#123;<br>        payOrderRecordDao.insert(por);<br>        System.out.println(<span class="hljs-string">&quot;----------------------- 保存parorderRecord&quot;</span>);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="3、订单分表的应用"><a href="#3、订单分表的应用" class="headerlink" title="3、订单分表的应用"></a>3、订单分表的应用</h2><ul>
<li>sharding-jdbc以jar包形式提供服务，所以要先引入maven依赖</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.shardingsphere<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>sharding-jdbc-spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>4.1.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>yml</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8007</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">edu-order-boot</span><br>  <span class="hljs-attr">shardingsphere:</span><br>    <span class="hljs-attr">datasource:</span><br>      <span class="hljs-attr">names:</span> <span class="hljs-string">ds0</span>   <span class="hljs-comment">#配置库的名字，随意</span><br>      <span class="hljs-attr">ds0:</span><br>        <span class="hljs-attr">type:</span> <span class="hljs-string">com.alibaba.druid.pool.DruidDataSource</span><br>        <span class="hljs-attr">driverClassName:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>        <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.204.141:3306/edu_order?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=UTC</span><br>        <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>        <span class="hljs-attr">password:</span> <span class="hljs-number">123123</span><br>    <span class="hljs-attr">sharding:</span><br>      <span class="hljs-attr">tables:</span><br>        <span class="hljs-attr">user_course_order:</span>   <span class="hljs-comment"># 指定user_course_order表的数据分布情况，配置数据节点</span><br>          <span class="hljs-attr">actualDataNodes:</span> <span class="hljs-string">ds0.user_course_order_$-&gt;&#123;0..2&#125;</span><br>          <span class="hljs-attr">tableStrategy:</span><br>            <span class="hljs-attr">inline:</span>   <span class="hljs-comment"># 指定user_course_order表的分片策略，分片策略包括分片键和分片算法</span><br>              <span class="hljs-attr">shardingColumn:</span> <span class="hljs-string">id</span><br>              <span class="hljs-attr">algorithmExpression:</span> <span class="hljs-string">user_course_order_$-&gt;&#123;id</span> <span class="hljs-string">%</span> <span class="hljs-number">3</span><span class="hljs-string">&#125;</span> <br>          <span class="hljs-attr">keyGenerator:</span>   <span class="hljs-comment"># 指定user_course_order表的主键生成策略为SNOWFLAKE</span><br>            <span class="hljs-attr">type:</span> <span class="hljs-string">SNOWFLAKE</span>  <span class="hljs-comment">#主键生成策略为SNOWFLAKE</span><br>            <span class="hljs-attr">column:</span> <span class="hljs-string">id</span>  <span class="hljs-comment">#指定主键</span><br>  <span class="hljs-attr">props:</span><br>    <span class="hljs-attr">sql:</span><br>      <span class="hljs-attr">show:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:7001/eureka</span><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">prefer-ip-address:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">instance-id:</span> <span class="hljs-string">$&#123;spring.cloud.client.ip-address&#125;:$&#123;server.port&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>启动类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableEurekaClient</span><br><span class="hljs-meta">@MapperScan(&quot;com.lagou.eduorderboot.mapper&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EduOrderBootApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(EduOrderBootApplication.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="4、前端联调"><a href="#4、前端联调" class="headerlink" title="4、前端联调"></a>4、前端联调</h2><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-comment">&lt;!-- 微信支付二维码--&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">el-dialog</span> <span class="hljs-attr">:visible.sync</span>=<span class="hljs-string">&quot;dialogFormVisible&quot;</span> <span class="hljs-attr">:before-close</span>=<span class="hljs-string">&quot;cancelOrder&quot;</span> <span class="hljs-attr">:modal</span>=<span class="hljs-string">&quot;true&quot;</span> <span class="hljs-attr">:close-on-click-modal</span>=<span class="hljs-string">&quot;false&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:800px;margin:0px auto;&quot;</span> &gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h1</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;font-size:30px;color:#00B38A&quot;</span> &gt;</span>微信扫一扫支付<span class="hljs-tag">&lt;/<span class="hljs-name">h1</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;qrcode&quot;</span> <span class="hljs-attr">style</span>=<span class="hljs-string">&quot;width:210px;margin:20px auto;&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">h2</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;statusText&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">h2</span>&gt;</span><br>  <span class="hljs-tag">&lt;<span class="hljs-name">p</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;closeText&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">p</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">el-dialog</span>&gt;</span><br></code></pre></td></tr></table></figure>



<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-comment">// 购买课程</span><br><span class="hljs-title function_">buy</span>(<span class="hljs-params">courseid</span>) &#123;<br>  <span class="hljs-comment">// 登录后才能购买</span><br>  <span class="hljs-keyword">if</span>( <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> != <span class="hljs-literal">null</span> )&#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">dialogFormVisible</span> = <span class="hljs-literal">true</span>; <br><br>    <span class="hljs-variable language_">this</span>.$nextTick(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>)&#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">createCode</span>(); <br>    &#125;);<br>  &#125;<span class="hljs-keyword">else</span>&#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;购买失败，请先登录！&quot;</span>);<br>  &#125;<br>&#125;,<br><span class="hljs-comment">// 生成二维码</span><br><span class="hljs-title function_">createCode</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-comment">// 将上一次的二维码清除，防止出现多个二维码</span><br>  <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;qrcode&quot;</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">&quot;&quot;</span>;<br><br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">axios</span><br>    .<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;http://localhost:8004/order/createCode&quot;</span>,&#123;<br>      <span class="hljs-attr">params</span>:&#123;<br>        <span class="hljs-attr">courseid</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">course</span>.<span class="hljs-property">id</span>,<br>        <span class="hljs-attr">coursename</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">course</span>.<span class="hljs-property">courseName</span>,<br>        <span class="hljs-attr">price</span>:<span class="hljs-number">1</span>,<br>      &#125;<br>    &#125;)<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result);<br>      <span class="hljs-keyword">let</span> qrcode = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QRCode</span>(<span class="hljs-string">&#x27;qrcode&#x27;</span>,&#123;<br>        <span class="hljs-attr">width</span>:<span class="hljs-number">200</span>,<br>        <span class="hljs-attr">height</span>:<span class="hljs-number">200</span>,<br>        <span class="hljs-attr">text</span>:result.<span class="hljs-property">data</span>.<span class="hljs-property">code_url</span>  <br>      &#125;);<br><br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">orderNo</span> = result.<span class="hljs-property">data</span>.<span class="hljs-property">orderId</span>;<br>      <br>      <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">saveOrder</span>();<br><br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">axios</span><br>        .<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;http://localhost:8004/order/checkOrderStatus&quot;</span>,&#123;<br>          <span class="hljs-attr">params</span>:&#123;<br>            <span class="hljs-attr">orderId</span>: result.<span class="hljs-property">data</span>.<span class="hljs-property">orderId</span> <br>          &#125;<br>        &#125;)<br>        .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> &#123;<br>          <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result.<span class="hljs-property">data</span>.<span class="hljs-property">trade_state</span>);<br>          <span class="hljs-keyword">if</span>(result.<span class="hljs-property">data</span>.<span class="hljs-property">trade_state</span>==<span class="hljs-string">&quot;SUCCESS&quot;</span>)&#123;<br>            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;statusText&quot;</span>).<span class="hljs-property">innerHTML</span> = <span class="hljs-string">&quot;&lt;i style=&#x27;color:#00B38A&#x27; class=&#x27;el-icon-success&#x27;&gt;&lt;/i&gt; 支付成功！&quot;</span>;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">updateOrder</span>(<span class="hljs-number">20</span>);<br><br>            <span class="hljs-comment">// 3秒后关闭二维码窗口</span><br>            <span class="hljs-keyword">let</span> s = <span class="hljs-number">3</span>;<br>            <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">closeQRForm</span>(s);<br>          &#125;<br>        &#125;)<br>        .<span class="hljs-title function_">catch</span>( <span class="hljs-function">(<span class="hljs-params">error</span>)=&gt;</span>&#123;<br>          <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;查询订单失败！&quot;</span>);<br>        &#125;);<br>    &#125;)<br>    .<span class="hljs-title function_">catch</span>( <span class="hljs-function">(<span class="hljs-params">error</span>)=&gt;</span>&#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;生成二维码失败！&quot;</span>);<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(error);<br>    &#125;);<br>&#125;,<br><span class="hljs-comment">// 倒计时关闭二维码窗口</span><br><span class="hljs-title function_">closeQRForm</span>(<span class="hljs-params"> s </span>)&#123;<br>  <span class="hljs-comment">// 略</span><br>&#125;,<br><span class="hljs-comment">// 保存订单 （参数多了）</span><br><span class="hljs-title function_">saveOrder</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">axios</span><br>    .<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;http://localhost:8003/order/saveOrder&quot;</span>,&#123;<br>      <span class="hljs-attr">params</span>:&#123;<br>        <span class="hljs-attr">orderNo</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">orderNo</span>,<br>        <span class="hljs-attr">user_id</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">content</span>.<span class="hljs-property">id</span>,<br>        <span class="hljs-attr">course_id</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">course</span>.<span class="hljs-property">id</span>,<br>        <span class="hljs-attr">activity_course_id</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">course</span>.<span class="hljs-property">id</span>,<br>        <span class="hljs-attr">source_type</span>:<span class="hljs-number">1</span>,<br>        <span class="hljs-attr">price</span>:<span class="hljs-number">1</span><br>      &#125;<br>    &#125;)<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;保存订单&quot;</span>);<br>    &#125;)<br>    .<span class="hljs-title function_">catch</span>( <span class="hljs-function">(<span class="hljs-params">error</span>)=&gt;</span>&#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;保存订单失败！&quot;</span>);<br>  &#125;);<br>&#125;,<br><span class="hljs-comment">// 更新订单的状态（参数多了）</span><br><span class="hljs-title function_">updateOrder</span>(<span class="hljs-params">statusCode</span>)&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">axios</span><br>    .<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;http://localhost:8003/order/updateOrder&quot;</span>,&#123;<br>      <span class="hljs-attr">params</span>:&#123;<br>        <span class="hljs-attr">orderNo</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">orderNo</span>,<br>        <span class="hljs-attr">status</span>:statusCode,<br>        <span class="hljs-attr">user_id</span>: <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">content</span>.<span class="hljs-property">id</span>,<br>        <span class="hljs-attr">course_id</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">course</span>.<span class="hljs-property">id</span>,<br>        <span class="hljs-attr">course_name</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">course</span>.<span class="hljs-property">name</span>,<br>        <span class="hljs-attr">price</span>:<span class="hljs-number">1</span><br>      &#125;<br>    &#125;)<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> &#123;<br>       <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;更新订单【&quot;</span>+<span class="hljs-variable language_">this</span>.<span class="hljs-property">orderNo</span>+<span class="hljs-string">&quot;】状态：&quot;</span> + statusCode);<br>    &#125;).<span class="hljs-title function_">catch</span>( <span class="hljs-function">(<span class="hljs-params">error</span>)=&gt;</span>&#123;<br>       <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;更新订单失败！&quot;</span>);<br>    &#125;);<br>&#125;,<br><span class="hljs-comment">// 取消订单（支付前，关闭二维码窗口视为不购买，可取消订单）</span><br><span class="hljs-title function_">cancelOrder</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-variable language_">this</span>.<span class="hljs-property">dialogFormVisible</span>= <span class="hljs-literal">false</span>;<br><br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">axios</span><br>    .<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;http://localhost:8003/order/deleteOrder&quot;</span>,&#123;<br>      <span class="hljs-attr">params</span>:&#123;<br>        <span class="hljs-attr">orderno</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">orderNo</span>,<br>      &#125;<br>    &#125;)<br>    .<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(<span class="hljs-string">&quot;取消订单&quot;</span>);<br>    &#125;)<br>    .<span class="hljs-title function_">catch</span>( <span class="hljs-function">(<span class="hljs-params">error</span>)=&gt;</span>&#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;取消订单失败！&quot;</span>);<br>  &#125;);<br>&#125;,<br></code></pre></td></tr></table></figure>







<h2 id="5、已购买课程查询-分库改造"><a href="#5、已购买课程查询-分库改造" class="headerlink" title="5、已购买课程查询-分库改造"></a>5、已购买课程查询-分库改造</h2><ul>
<li><p>之前我们说过，微服务可以拥有自己独立的数据库，现在用分库来实现它</p>
</li>
<li><p>重新规划数据库和表的归属</p>
<ul>
<li>用户微服务：edu_user库 -&gt; user</li>
<li>课程微服务：edu_course库 -&gt; course、course_section、activity_course、course_lesson、course_media、teacher</li>
<li>留言微服务：edu_comment库 -&gt; course_comment、course_comment_favorite_record</li>
<li>订单微服务：edu_order库 -&gt; 订单来10张表：user_course_order_<b style='color:Red'>0</b>，user_course_order_<b style='color:Red'>1</b>，user_course_order_<b style='color:Red'>2</b> …</li>
</ul>
</li>
<li><p>课程和订单分库后的改造，思路如下：</p>
<ol>
<li>通过登录的用户id，去<b style='color:blue'>订单微服务</b>查询该用户已经成功购买的课程id</li>
<li>将所有已购买的课程id发送给<b style='color:blue'>课程微服务</b>查询课程详情</li>
</ol>
</li>
<li><p>如何进行微服务之间的远程调用呢，Feign它来了！</p>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-title function_">data</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">return</span> &#123;<br>       <span class="hljs-attr">myCourseList</span>:[], <span class="hljs-comment">// 我购买过的课程列表</span><br>    &#125;;<br>&#125;,<br><span class="hljs-title function_">created</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getCourseList</span>(); <span class="hljs-comment">//当组件创建完毕，就调用获取所有课程的方法</span><br><br>    <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> = <span class="hljs-title class_">JSON</span>.<span class="hljs-title function_">parse</span>( <span class="hljs-variable language_">localStorage</span>.<span class="hljs-title function_">getItem</span>(<span class="hljs-string">&quot;user&quot;</span>) );<br>    <span class="hljs-keyword">if</span>( <span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span> != <span class="hljs-literal">null</span> )&#123;<br>        <span class="hljs-variable language_">this</span>.<span class="hljs-property">isLogin</span> = <span class="hljs-literal">true</span>; <span class="hljs-comment">//已登录</span><br>        <span class="hljs-variable language_">this</span>.<span class="hljs-title function_">getMyCourseList</span>(); <span class="hljs-comment">//1.获取当前用户的已经购买（status=20）的课程</span><br>    &#125;<br>&#125;,<br><br><span class="hljs-comment">//1.根据课程编号查询课程信息</span><br><span class="hljs-title function_">getMyCourseList</span>(<span class="hljs-params"></span>)&#123;<br>  <span class="hljs-keyword">return</span> <span class="hljs-variable language_">this</span>.<span class="hljs-property">axios</span><br>  .<span class="hljs-title function_">get</span>(<span class="hljs-string">&quot;http://localhost:8004/course/getCourseByCourseId&quot;</span>,&#123;<br>      <span class="hljs-attr">params</span>:&#123;<br>         <span class="hljs-attr">userid</span>:<span class="hljs-variable language_">this</span>.<span class="hljs-property">user</span>.<span class="hljs-property">userid</span><br>      &#125;<br>   &#125;).<span class="hljs-title function_">then</span>(<span class="hljs-function">(<span class="hljs-params">result</span>) =&gt;</span> &#123;<br>      <span class="hljs-variable language_">console</span>.<span class="hljs-title function_">log</span>(result);<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">myCourseList</span> = result.<span class="hljs-property">data</span>;<br>  &#125;).<span class="hljs-title function_">catch</span>( <span class="hljs-function">(<span class="hljs-params">error</span>)=&gt;</span>&#123;<br>      <span class="hljs-variable language_">this</span>.<span class="hljs-property">$message</span>.<span class="hljs-title function_">error</span>(<span class="hljs-string">&quot;获取已购买的课程信息失败！&quot;</span>);<br>  &#125;);<br>&#125;,<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="课程微服务"><a href="#课程微服务" class="headerlink" title="课程微服务"></a>课程微服务</h3><ul>
<li>controller</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@GetMapping(&quot;getMyCoursesByUserId&quot;)</span><br><span class="hljs-keyword">public</span> List&lt;CourseDTO&gt; <span class="hljs-title function_">getMyCoursesByUserId</span><span class="hljs-params">( Integer userid )</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;userid = &quot;</span> + userid);<br>    <span class="hljs-keyword">return</span> courseService.getMyCoursesByUserId(userid);<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>CourseServiceImpl</li>
</ul>
  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> OrderRemoteService orderRemoteService; <span class="hljs-comment">// 调用远程接口</span><br><br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> List&lt;CourseDTO&gt; <span class="hljs-title function_">getMyCoursesByUserId</span><span class="hljs-params">(Integer userid)</span> &#123;<br>    List&lt;Object&gt; ids = orderRemoteService.getOKOrderCourseIds(userid);<br>    <span class="hljs-keyword">return</span> getAllCourse(ids);<br>&#125;<br><span class="hljs-meta">@Override</span><br><span class="hljs-keyword">public</span> List&lt;CourseDTO&gt; <span class="hljs-title function_">getAllCourse</span><span class="hljs-params">(List&lt;Object&gt; ids)</span> &#123;<br>    <span class="hljs-comment">// 基本信息</span><br>    List&lt;Course&gt; courses = getInvalidCourses(ids);<br>    <span class="hljs-comment">// 省略</span><br>&#125;<br><span class="hljs-comment">// 查询所有课程基本信息</span><br><span class="hljs-keyword">private</span> List&lt;Course&gt; <span class="hljs-title function_">getInvalidCourses</span><span class="hljs-params">(List&lt;Object&gt; ids)</span>&#123;<br>    <span class="hljs-type">QueryWrapper</span> <span class="hljs-variable">courseQueryWrapper</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>();<br>    courseQueryWrapper.eq(<span class="hljs-string">&quot;status&quot;</span>, <span class="hljs-number">1</span>);<br>    courseQueryWrapper.eq(<span class="hljs-string">&quot;is_del&quot;</span>, Boolean.FALSE); <br>    <span class="hljs-keyword">if</span>(<span class="hljs-literal">null</span> != ids)&#123;<br>        courseQueryWrapper.in(<span class="hljs-string">&quot;id&quot;</span>, ids); <span class="hljs-comment">// 查询匹配的课程</span><br>    &#125;<br>    courseQueryWrapper.orderByDesc(<span class="hljs-string">&quot; sort_num &quot;</span>); <br>    <span class="hljs-keyword">return</span> <span class="hljs-built_in">this</span>.courseMapper.selectList(courseQueryWrapper);<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><p>OrderRemoteService</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FeignClient(name = &quot;edu-order-boot&quot;,path = &quot;order&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderRemoteService</span> &#123;<br>  <span class="hljs-meta">@GetMapping(&quot;getOKOrderCourseIds&quot;)</span><br>  List&lt;Object&gt; <span class="hljs-title function_">getOKOrderCourseIds</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(value = &quot;userid&quot;)</span> Integer userid)</span>;<br>&#125;<br></code></pre></td></tr></table></figure>
</li>
<li><p>pom</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>



<ul>
<li><p>启动类</p>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableEurekaClient</span> <br><span class="hljs-meta">@MapperScan(&quot;com.lagou.educourseboot.mapper&quot;)</span><br><span class="hljs-meta">@EnableFeignClients</span> <span class="hljs-comment">// feign的客户端</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EduCourseBootApplication</span> &#123;<br>  <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>      SpringApplication.run(EduCourseBootApplication.class, args);<br>  &#125;<br>&#125;<br></code></pre></td></tr></table></figure></li>
</ul>
<h3 id="订单微服务"><a href="#订单微服务" class="headerlink" title="订单微服务"></a>订单微服务</h3>  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-comment">// 查询用户已购买完成的的课程ID</span><br><span class="hljs-meta">@GetMapping(&quot;getOKOrderCourseIds&quot;)</span><br><span class="hljs-keyword">public</span> List&lt;Object&gt; <span class="hljs-title function_">getOKOrderCourseIds</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam</span> String userid )</span> &#123;<br>    System.out.println(<span class="hljs-string">&quot;获取&quot;</span>+userid +<span class="hljs-string">&quot;的购买的课程编号！&quot;</span>);<br>    List&lt;UserCourseOrder&gt; list = orderService.getOKOrderCourseIds(userid);<br>    List&lt;Object&gt; list2 = <span class="hljs-keyword">new</span> <span class="hljs-title class_">ArrayList</span>&lt;&gt;();<br>    <span class="hljs-keyword">for</span>(UserCourseOrder order : list)&#123;<br>        list2.add(order.getCourseId());<br>    &#125;<br>    System.out.println(<span class="hljs-string">&quot;已购成功的课程id：&quot;</span> + list2);<br>    <span class="hljs-keyword">return</span> list2;<br>&#125;<br></code></pre></td></tr></table></figure>

  <figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs java">List&lt;UserCourseOrder&gt; <span class="hljs-title function_">getOKOrderCourseIds</span><span class="hljs-params">(String userId)</span>;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> List&lt;UserCourseOrder&gt; <span class="hljs-title function_">getOKOrderCourseIds</span><span class="hljs-params">(String userId)</span> &#123;<br>    QueryWrapper&lt;UserCourseOrder&gt; qw = <span class="hljs-keyword">new</span> <span class="hljs-title class_">QueryWrapper</span>();<br>    qw.select(<span class="hljs-string">&quot;course_id&quot;</span>); <span class="hljs-comment">// SELECT course_id FROM edu_order.user_course_order</span><br>    qw.eq(<span class="hljs-string">&quot;STATUS&quot;</span>, <span class="hljs-number">20</span>); <span class="hljs-comment">//WHERE STATUS = 20</span><br>    qw.eq(<span class="hljs-string">&quot;is_del&quot;</span>, <span class="hljs-number">0</span>); <span class="hljs-comment">//AND is_del = 0</span><br>    qw.eq(<span class="hljs-string">&quot;user_id&quot;</span>, userId); <span class="hljs-comment">//AND  user_id = #&#123;userId</span><br>    <span class="hljs-keyword">return</span> orderDao.selectList(qw);<br>&#125;<br></code></pre></td></tr></table></figure>





<h2 id="6、订单成功后-短信通知"><a href="#6、订单成功后-短信通知" class="headerlink" title="6、订单成功后-短信通知"></a>6、订单成功后-短信通知</h2><ul>
<li>采用消息队列异步处理</li>
</ul>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210316101136730.png" srcset="/img/loading.gif" lazyload alt="image-20210316101136730"></p>
<ul>
<li><p>使用rabbitmq的管理端 ip:15672 进行初始化操作</p>
<ul>
<li><p>创建虚拟主机 lagou</p>
</li>
<li><p>创建消息队列 order_queue</p>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210315164923888.png" srcset="/img/loading.gif" lazyload alt="image-20210315164923888"></p>
</li>
</ul>
</li>
<li><p>pom</p>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>	<span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-amqp<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>yml</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8007</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">edu-order-boot</span><br>  <span class="hljs-attr">rabbitmq:</span><br>    <span class="hljs-attr">host:</span> <span class="hljs-number">192.168</span><span class="hljs-number">.204</span><span class="hljs-number">.145</span><br>    <span class="hljs-attr">port:</span> <span class="hljs-number">5672</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">laosun</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123123</span><br>    <span class="hljs-attr">virtual-host:</span> <span class="hljs-string">lagou</span><br>    <span class="hljs-attr">queue:</span> <span class="hljs-string">order_queue</span><br></code></pre></td></tr></table></figure>

<ul>
<li>支付成功后</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Autowired</span><br><span class="hljs-keyword">private</span> RabbitTemplate rabbitTemplate;<br><br><span class="hljs-meta">@Value(&quot;$&#123;spring.rabbitmq.queue&#125;&quot;)</span><br><span class="hljs-keyword">private</span> String queue;<br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">test</span><span class="hljs-params">()</span>&#123;<br>    <span class="hljs-type">SmsVo</span> <span class="hljs-variable">sv</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SmsVo</span>();<br>    sv.setPhone(<span class="hljs-string">&quot;110&quot;</span>);<br>    sv.setCourseName(<span class="hljs-string">&quot;java高薪课程&quot;</span>);<br>    rabbitTemplate.convertAndSend(queue, sv);<br>    System.out.println(<span class="hljs-string">&quot;购买成功的消息已发送到RabbitMQ！&quot;</span>);<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>监听消息</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderRever</span> &#123;<br><br>    <span class="hljs-meta">@RabbitListener(queues = &quot;$&#123;spring.rabbitmq.queue&#125;&quot;)</span><br>    <span class="hljs-comment">//@RabbitHandler</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(SmsVo smsVo)</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;监听到MQ中有新的消息：&quot;</span>+smsVo);<br>        sms.send(); <span class="hljs-comment">//调用短信接口发送短信</span><br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>【拉勾教育通知】 学员110，你已成功购买《java高薪课程》，抓紧学习哦！</p>
<ul>
<li>封装短信实体类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Data</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SmsVo</span> &#123;<br>    <span class="hljs-keyword">private</span> String phone;<br>    <span class="hljs-keyword">private</span> String courseName;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<ul>
<li>controller</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;order&quot;)</span><br><span class="hljs-meta">@CrossOrigin</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> RabbitTemplate rabbitTemplate;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;spring.rabbitmq.queue&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String queue;<br><br>    <span class="hljs-meta">@GetMapping(&quot;updateOrder&quot;)</span><br>    <span class="hljs-keyword">public</span> Integer <span class="hljs-title function_">updateOrder</span><span class="hljs-params">(String orderNo , Integer status,String user_id,String course_id,String course_name,Double price, String phone)</span> &#123;  <span class="hljs-comment">// 修改前端传入手机号码</span><br>        <span class="hljs-type">Integer</span> <span class="hljs-variable">integer</span> <span class="hljs-operator">=</span> orderService.updateOrder(orderNo, status);<br>        <span class="hljs-keyword">if</span>(integer == <span class="hljs-number">1</span>)&#123;<br>            orderService.saveOrderInfo(po);<br>            orderService.saveOrderRecord(record);<br><br>            <span class="hljs-comment">// 发送短信成功的通知(消息的生产者)</span><br>            <span class="hljs-type">SmsVo</span> <span class="hljs-variable">smsVo</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">SmsVo</span>();<br>            smsVo.setPhone(phone);<span class="hljs-comment">// 手机号码</span><br>            smsVo.setCourseName(course_name);<br>            rabbitTemplate.convertAndSend(queue,smsVo);<br>        &#125;<br>        <span class="hljs-keyword">return</span> integer;<br>    &#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.lagou.eduorderboot.rabbit;<br><span class="hljs-comment">/*</span><br><span class="hljs-comment">	消息消费者</span><br><span class="hljs-comment">*/</span><br><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderRever</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> SmsService smsService;<br><br>    <span class="hljs-meta">@RabbitListener( queues = &quot;$&#123;spring.rabbitmq.queue&#125;&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">process</span><span class="hljs-params">(SmsVo smsVo)</span>&#123;<br>        System.out.println(<span class="hljs-string">&quot;得到通知，开始发送 = &quot;</span> + smsVo.getCourseName());<br><br>        <span class="hljs-comment">// 调用发送短信</span><br>        smsService.sendSms(smsVo.getPhone(), smsVo.getCourseName());<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>SmsService</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Component</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SmsService</span> &#123;<br><br>    <span class="hljs-meta">@Value(&quot;$&#123;ali.sms.signName&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String signName;<br>    <span class="hljs-meta">@Value(&quot;$&#123;ali.sms.templateCode&#125;&quot;)</span> <span class="hljs-comment">// 新模版，之前验证码的模版不能用了</span><br>    <span class="hljs-keyword">private</span> String templateCode; <br>    <span class="hljs-meta">@Value(&quot;$&#123;ali.sms.assessKeyId&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String accessKeyId;<br>    <span class="hljs-meta">@Value(&quot;$&#123;ali.sms.assessKeySecret&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String assessKeySecret;<br><br>    <span class="hljs-keyword">public</span> Object <span class="hljs-title function_">sendSms</span><span class="hljs-params">(String phoneNumber,String courseName)</span> &#123;<br>        <span class="hljs-type">DefaultProfile</span> <span class="hljs-variable">profile</span> <span class="hljs-operator">=</span> DefaultProfile.getProfile(<span class="hljs-string">&quot;cn-hangzhou&quot;</span>, accessKeyId, assessKeySecret);<br>        <span class="hljs-type">IAcsClient</span> <span class="hljs-variable">client</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DefaultAcsClient</span>(profile);<br><br>        <span class="hljs-type">CommonRequest</span> <span class="hljs-variable">request</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">CommonRequest</span>();<br>        request.setSysMethod(MethodType.POST);<br>        request.setSysDomain(<span class="hljs-string">&quot;dysmsapi.aliyuncs.com&quot;</span>);<br>        request.setSysVersion(<span class="hljs-string">&quot;2017-05-25&quot;</span>);<br>        request.setSysAction(<span class="hljs-string">&quot;SendSms&quot;</span>);<br>        request.putQueryParameter(<span class="hljs-string">&quot;RegionId&quot;</span>, <span class="hljs-string">&quot;cn-hangzhou&quot;</span>);<br>        request.putQueryParameter(<span class="hljs-string">&quot;PhoneNumbers&quot;</span>, phoneNumber);<br>        request.putQueryParameter(<span class="hljs-string">&quot;SignName&quot;</span>, signName);<br>        request.putQueryParameter(<span class="hljs-string">&quot;TemplateCode&quot;</span>, templateCode);<br><br>        request.putQueryParameter(<span class="hljs-string">&quot;TemplateParam&quot;</span>, <span class="hljs-string">&quot;&#123;\&quot;phone\&quot;:\&quot;&quot;</span> + phoneNumber + <span class="hljs-string">&quot;\&quot;,\&quot;courseName\&quot;:\&quot;&quot;</span>+courseName+<span class="hljs-string">&quot;\&quot;&#125;&quot;</span>);<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-type">CommonResponse</span> <span class="hljs-variable">response</span> <span class="hljs-operator">=</span> client.getCommonResponse(request);<br>            <span class="hljs-type">String</span> <span class="hljs-variable">jsonStr</span> <span class="hljs-operator">=</span> response.getData();<br>            System.out.println(<span class="hljs-string">&quot;jsonStr = &quot;</span> + jsonStr);<br><br>        &#125; <span class="hljs-keyword">catch</span> (Exception e) &#123;<br>            e.printStackTrace();<br>        &#125;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>





<ul>
<li>如果有精力的同学，还可以研究一个非常给力的支付一站式解决方案：<a target="_blank" rel="noopener" href="https://beecloud.cn/">https://beecloud.cn/</a> </li>
<li>重新请求下单、商户单号重复等经常出现的问题，都完美解决，当然，现有的产品，高端版本是收费的。</li>
</ul>
<hr>
<h1 id="08-视频播放"><a href="#08-视频播放" class="headerlink" title="08 视频播放"></a>08 视频播放</h1><h2 id="1、改造播放组件"><a href="#1、改造播放组件" class="headerlink" title="1、改造播放组件"></a>1、改造播放组件</h2><ul>
<li><p>之前我们在前端项目中使用的html的 &lt;video&gt; 组件标签进行播放，虽然能播放，但是功能比较单一，只能播放而已，无法保证视频资源的安全性</p>
</li>
<li><p>我们采用阿里云视频点播方案</p>
</li>
<li><p>阿里官网：<a target="_blank" rel="noopener" href="https://www.alibabacloud.com/help/zh/doc-detail/51236.htm?spm=a2c63.p38356.b99.2.28213799QTbeE3">https://www.alibabacloud.com/help/zh/doc-detail/51236.htm?spm=a2c63.p38356.b99.2.28213799QTbeE3</a></p>
</li>
<li><p>高端的额外服务是按照流量收取费用的</p>
</li>
<li><p>改造前端项目，加入阿里播放组件</p>
</li>
</ul>
<ol>
<li>在vue项目的public目录中的index.html文件中引入css和js</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">link</span> <span class="hljs-attr">rel</span>=<span class="hljs-string">&quot;stylesheet&quot;</span> <span class="hljs-attr">href</span>=<span class="hljs-string">&quot;https://g.alicdn.com/de/prismplayer/2.8.2/skins/default/aliplayer-min.css&quot;</span> /&gt;</span><br><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span> <span class="hljs-attr">charset</span>=<span class="hljs-string">&quot;utf-8&quot;</span> <span class="hljs-attr">type</span>=<span class="hljs-string">&quot;text/javascript&quot;</span> <span class="hljs-attr">src</span>=<span class="hljs-string">&quot;https://g.alicdn.com/de/prismplayer/2.8.2/aliplayer-min.js&quot;</span>&gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ol start="2">
<li>在自己的vue组件中引入</li>
</ol>
<figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;prism-player&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;J_prismPlayer&quot;</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ol start="3">
<li>vue绑定</li>
</ol>
<figure class="highlight js"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs js"><span class="hljs-keyword">var</span> player = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Aliplayer</span>(&#123;<br>  <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;J_prismPlayer&#x27;</span>,<br>  <span class="hljs-attr">width</span>: <span class="hljs-string">&#x27;100%&#x27;</span>,<br>  <span class="hljs-attr">height</span>: <span class="hljs-string">&#x27;900px&#x27;</span>,<br>  <span class="hljs-attr">autoplay</span>: <span class="hljs-literal">true</span>,<br>  <span class="hljs-comment">//支持播放地址播放,此播放优先级最高</span><br>  source : <span class="hljs-string">&#x27;https://video.pearvideo.com/mp4/short/20200914/cont-1697119-15382138-hd.mp4&#x27;</span>,<br>&#125;);<br></code></pre></td></tr></table></figure>



<h3 id="使用播放器切换视频"><a href="#使用播放器切换视频" class="headerlink" title="使用播放器切换视频"></a>使用播放器切换视频</h3><figure class="highlight html"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs html"><span class="hljs-tag">&lt;<span class="hljs-name">template</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;video-box&quot;</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">div</span> <span class="hljs-attr">class</span>=<span class="hljs-string">&quot;prism-player&quot;</span> <span class="hljs-attr">id</span>=<span class="hljs-string">&quot;J_prismPlayer&quot;</span> &gt;</span><span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br>    <br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;playLesson(&#x27;https://xxxx.mp4&#x27;)&quot;</span>&gt;</span>视频1<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">button</span> @<span class="hljs-attr">click</span>=<span class="hljs-string">&quot;playLesson(&#x27;https://yyyy.mp4&#x27;)&quot;</span>&gt;</span>视频2<span class="hljs-tag">&lt;/<span class="hljs-name">button</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">div</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">template</span>&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">script</span>&gt;</span><span class="language-javascript"></span><br><span class="language-javascript">	<span class="hljs-title function_">mounted</span>(<span class="hljs-params"></span>)&#123;</span><br><span class="language-javascript">        <span class="hljs-variable language_">this</span>.<span class="hljs-property">player</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Aliplayer</span>(&#123;</span><br><span class="language-javascript">            <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;J_prismPlayer&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">width</span>: <span class="hljs-string">&#x27;100%&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">height</span>: <span class="hljs-string">&#x27;900px&#x27;</span>,</span><br><span class="language-javascript">            <span class="hljs-attr">autoplay</span>: <span class="hljs-literal">true</span>,</span><br><span class="language-javascript">            <span class="hljs-comment">//支持播放地址播放,此播放优先级最高</span></span><br><span class="language-javascript">            source : <span class="hljs-string">&#x27;&#x27;</span>,</span><br><span class="language-javascript">        &#125;);</span><br><span class="language-javascript">    &#125;,</span><br><span class="language-javascript">    <span class="hljs-attr">methods</span>:&#123;</span><br><span class="language-javascript">        <span class="hljs-title function_">playLesson</span>(<span class="hljs-params">mp4_url</span>)&#123;</span><br><span class="language-javascript">            <span class="hljs-comment">// 每次重新创建 播放器 （否则视频会叠加）</span></span><br><span class="language-javascript">            <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;J_prismPlayer&quot;</span>).<span class="hljs-title function_">remove</span>();</span><br><span class="language-javascript">            <span class="hljs-keyword">var</span> pdiv = <span class="hljs-variable language_">document</span>.<span class="hljs-title function_">createElement</span>(<span class="hljs-string">&quot;div&quot;</span>);</span><br><span class="language-javascript">            pdiv.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&quot;class&quot;</span>,<span class="hljs-string">&quot;prism-player&quot;</span>);</span><br><span class="language-javascript">            pdiv.<span class="hljs-title function_">setAttribute</span>(<span class="hljs-string">&quot;id&quot;</span>,<span class="hljs-string">&quot;J_prismPlayer&quot;</span>);</span><br><span class="language-javascript">			<span class="hljs-variable language_">document</span>.<span class="hljs-title function_">getElementById</span>(<span class="hljs-string">&quot;video-box&quot;</span>).<span class="hljs-title function_">appendChild</span>(pdiv);</span><br><span class="language-javascript">            </span><br><span class="language-javascript">            <span class="hljs-variable language_">this</span>.<span class="hljs-property">player</span> = <span class="hljs-keyword">new</span> <span class="hljs-title class_">Aliplayer</span>(&#123;</span><br><span class="language-javascript">                <span class="hljs-attr">id</span>: <span class="hljs-string">&#x27;J_prismPlayer&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-attr">width</span>: <span class="hljs-string">&#x27;100%&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-attr">height</span>: <span class="hljs-string">&#x27;900px&#x27;</span>,</span><br><span class="language-javascript">                <span class="hljs-attr">autoplay</span>: <span class="hljs-literal">true</span>,</span><br><span class="language-javascript">                <span class="hljs-comment">//支持播放地址播放,此播放优先级最高</span></span><br><span class="language-javascript">                source : mp4_url,</span><br><span class="language-javascript">            &#125;);</span><br><span class="language-javascript">        &#125;</span><br><span class="language-javascript">    &#125;</span><br><span class="language-javascript"></span><span class="hljs-tag">&lt;/<span class="hljs-name">script</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h2 id="2、阿里云OSS"><a href="#2、阿里云OSS" class="headerlink" title="2、阿里云OSS"></a>2、阿里云OSS</h2><ul>
<li><p>我们要做文件服务，阿里云oss是一个很好的分布式文件服务系统，所以我们只需要集成阿里云oss即可</p>
</li>
<li><p><a target="_blank" rel="noopener" href="https://www.aliyun.com/">https://www.aliyun.com/</a></p>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210317153154543.png" srcset="/img/loading.gif" lazyload alt="image-20210317153154543"></p>
</li>
</ul>
<h3 id="2-1-开通“对象存储OSS”服务"><a href="#2-1-开通“对象存储OSS”服务" class="headerlink" title="2.1 开通“对象存储OSS”服务"></a>2.1 开通“对象存储OSS”服务</h3><ol>
<li><p>申请阿里云账号并实名认证</p>
</li>
<li><p>开通“对象存储OSS”服务</p>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210317153335688.png" srcset="/img/loading.gif" lazyload alt="image-20210317153335688"></p>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210317155050654.png" srcset="/img/loading.gif" lazyload alt="image-20210317155050654"></p>
</li>
<li><p>进入管理控制台</p>
</li>
</ol>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210317155110318.png" srcset="/img/loading.gif" lazyload alt="image-20210317155110318"></p>
<h3 id="2-2-创建Bucket"><a href="#2-2-创建Bucket" class="headerlink" title="2.2 创建Bucket"></a>2.2 创建Bucket</h3><ul>
<li>类似”包”的概念，易于管理和存储</li>
<li>选择：标准存储、公共读、不开通</li>
</ul>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210317155701371.png" srcset="/img/loading.gif" lazyload alt="image-20210317155701371"></p>
<ul>
<li>oss授权</li>
</ul>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210317161600202.png" srcset="/img/loading.gif" lazyload alt="image-20210317161600202"></p>
<ul>
<li>pom</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 阿里云oss依赖 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.aliyun.oss<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>aliyun-sdk-oss<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- 日期工具栏依赖 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>joda-time<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>joda-time<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>yml</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">aliyun:</span><br>  <span class="hljs-attr">oss:</span><br>    <span class="hljs-attr">endpoint:</span> <span class="hljs-string">oss-cn-beijing.aliyuncs.com</span><br>	<span class="hljs-attr">accessKeyId:</span> <span class="hljs-string">LTAI4G4SV6WtST7UYH776xxx</span><br> 	<span class="hljs-attr">secret:</span> <span class="hljs-string">X9KHNYgztNr9MI5Zp8JffQPZO4uxxx</span><br>	<span class="hljs-attr">bucket:</span> <span class="hljs-string">lagou-laosun</span><br></code></pre></td></tr></table></figure>

<ul>
<li>controller</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;file&quot;)</span><br><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileController</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> FileService fileService;<br>    <br>    <span class="hljs-comment">//上传文件到阿里云oss</span><br>    <span class="hljs-meta">@PostMapping(&quot;fileUpload&quot;)</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">fileUpload</span><span class="hljs-params">(<span class="hljs-meta">@RequestParam(&quot;file&quot;)</span> MultipartFile file)</span> &#123;<br>        <span class="hljs-comment">//获取上传文件</span><br>        <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> fileService.upload(file);<br>        <span class="hljs-keyword">return</span> url;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>service</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">FileServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">FileService</span> &#123;<br>    <br>    <span class="hljs-meta">@Value(&quot;$&#123;aliyun.oss.endpoint&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String endpoint;<br>    <span class="hljs-meta">@Value(&quot;$&#123;aliyun.oss.accessKeyId&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String accessKeyId;<br>    <span class="hljs-meta">@Value(&quot;$&#123;aliyun.oss.secret&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String secret;<br>    <span class="hljs-meta">@Value(&quot;$&#123;aliyun.oss.bucket&#125;&quot;)</span><br>    <span class="hljs-keyword">private</span> String bucket;<br>    <br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> String <span class="hljs-title function_">upload</span><span class="hljs-params">(MultipartFile file)</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            <span class="hljs-comment">// 创建OSSClient实例。</span><br>            <span class="hljs-type">OSS</span> <span class="hljs-variable">ossClient</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">OSSClientBuilder</span>().build(endpoint, accessKeyId, accessKeySecret);<br>            <span class="hljs-comment">// 上传文件流。</span><br>            <span class="hljs-type">InputStream</span> <span class="hljs-variable">inputStream</span> <span class="hljs-operator">=</span> file.getInputStream();<br>            <span class="hljs-type">String</span> <span class="hljs-variable">fileName</span> <span class="hljs-operator">=</span> file.getOriginalFilename();<br>            <span class="hljs-comment">// 生成随机唯一值，使用uuid，添加到文件名称里面</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">uuid</span> <span class="hljs-operator">=</span> UUID.randomUUID().toString().replaceAll(<span class="hljs-string">&quot;-&quot;</span>,<span class="hljs-string">&quot;&quot;</span>);<br>            fileName = uuid+fileName;<br>            <span class="hljs-comment">//按照当前日期，创建文件夹，上传到创建文件夹里面</span><br>            <span class="hljs-comment">// 2021/02/02/01.mp4</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">timeUrl</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DateTime</span>().toString(<span class="hljs-string">&quot;yyyy/MM/dd&quot;</span>);<br>            fileName = timeUrl+<span class="hljs-string">&quot;/&quot;</span>+fileName; <span class="hljs-comment">// 2021/02/02/23fads85rj4hka01.mp4</span><br>            <span class="hljs-comment">// 调用方法实现上传</span><br>            ossClient.putObject(bucketName, fileName, inputStream);<br>            <span class="hljs-comment">// 关闭OSSClient。</span><br>            ossClient.shutdown();<br>            <span class="hljs-comment">// 上传之后文件路径</span><br>            <span class="hljs-comment">// https://lagou-laosun.oss-cn-beijing.aliyuncs.com/01.jpg</span><br>            <span class="hljs-type">String</span> <span class="hljs-variable">url</span> <span class="hljs-operator">=</span> <span class="hljs-string">&quot;https://&quot;</span>+bucketName+<span class="hljs-string">&quot;.&quot;</span>+endpoint+<span class="hljs-string">&quot;/&quot;</span>+fileName;<br>            <span class="hljs-comment">// 返回</span><br>            <span class="hljs-keyword">return</span> url;<br>        &#125; <span class="hljs-keyword">catch</span> (IOException e) &#123;<br>            e.printStackTrace();<br>            <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>        &#125;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>





<hr>
<h1 id="09-配置中心"><a href="#09-配置中心" class="headerlink" title="09 配置中心"></a>09 配置中心</h1><h2 id="1、Config-分布式配置中心"><a href="#1、Config-分布式配置中心" class="headerlink" title="1、Config 分布式配置中心"></a>1、Config 分布式配置中心</h2><h3 id="1-1分布式配置中心应用场景"><a href="#1-1分布式配置中心应用场景" class="headerlink" title="1.1分布式配置中心应用场景"></a>1.1分布式配置中心应用场景</h3><p>​		往往，我们使用配置文件管理一些配置信息，比如application.yml</p>
<p>​		<strong>单体应用架构，</strong>配置信息的管理、维护并不会显得特别麻烦，手动操作就可以，因为就一个工程；</p>
<p>​		<strong>微服务架构，</strong>因为我们的分布式集群环境中可能有很多个微服务，我们不可能一个一个去修改配置然后重启生效，在一定场景下我们还需要在运行期间动态调整配置信息，比如：根据各个微服务的负载情况，动态调整数据源连接池大小，我们希望配置内容发生变化的时候，微服务可以自动更新。</p>
<p>​		场景总结如下：</p>
<p>​		1）集中配置管理，一个微服务架构中可能有成百上千个微服务，所以集中配置管理是很重要的（一次修改、到处生效）</p>
<p>​		2）不同环境不同配置，比如数据源配置在不同环境（开发dev,测试test,生产prod）中是不同的</p>
<p>​		3）运行期间可动态调整。例如，可根据各个微服务的负载情况，动态调整数据源连接池大小等配置修改后可自动更新</p>
<p>​		4）如配置内容发生变化，微服务可以自动更新配置</p>
<p>​		那么，我们就需要对配置文件进行<strong>集中式管理</strong>，这也是分布式配置中心的作用。</p>
<p>Spring Cloud Conﬁg 是一个分布式配置管理方案，包含了 Server端和 Client端两个部分。</p>
<ul>
<li>一句话理解：将所有的配置文件统一保存到云端（github），通过服务端应用去获取，再分发给对应的每一个微服务</li>
<li>云端包括：<ul>
<li>github （访问不了，可以使用代理网址：<a target="_blank" rel="noopener" href="https://hub.fastgit.org/">https://hub.fastgit.org</a> 等价于 <a target="_blank" rel="noopener" href="https://github.com)/">https://github.com）</a></li>
<li>gitee 码云（国产github，很好用，用法和github一样）</li>
</ul>
</li>
</ul>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20200922180904548.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="1-2-服务端配置"><a href="#1-2-服务端配置" class="headerlink" title="1.2 服务端配置"></a>1.2 服务端配置</h3><h4 id="1-2-1-在GitHub新建一个库"><a href="#1-2-1-在GitHub新建一个库" class="headerlink" title="1.2.1 在GitHub新建一个库"></a>1.2.1 在GitHub新建一个库</h4><p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210203233941598.png" srcset="/img/loading.gif" lazyload alt="image-20210203233941598"></p>
<h4 id="1-2-2-获得项目的https的git地址"><a href="#1-2-2-获得项目的https的git地址" class="headerlink" title="1.2.2 获得项目的https的git地址"></a>1.2.2 获得项目的https的git地址</h4><p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210203233611569.png" srcset="/img/loading.gif" lazyload alt="image-20210203233611569"></p>
<h4 id="1-2-3-在本地文件推送到仓库"><a href="#1-2-3-在本地文件推送到仓库" class="headerlink" title="1.2.3 在本地文件推送到仓库"></a>1.2.3 在本地文件推送到仓库</h4><p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210318165550615.png" srcset="/img/loading.gif" lazyload alt="image-20210318165550615"></p>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/111.png" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>全部都上传到git上了，如下图</li>
</ul>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/222.png" srcset="/img/loading.gif" lazyload alt="image-20210204000401807"></p>
<h4 id="1-2-4-创建服务端工程"><a href="#1-2-4-创建服务端工程" class="headerlink" title="1.2.4 创建服务端工程"></a>1.2.4 创建服务端工程</h4><ul>
<li>edu-config-boot：配置如下</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.lagou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>edu-lagou<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>0.0.1-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>edu-config-boot<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">name</span>&gt;</span>edu-config-boot<span class="hljs-tag">&lt;/<span class="hljs-name">name</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- 配置中心 服务端 --&gt;</span><br>    	<span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-config-server<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>application.yml</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">9966</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">edu-config-boot</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">config:</span><br>      <span class="hljs-attr">server:</span><br>        <span class="hljs-attr">git:</span><br>          <span class="hljs-attr">uri:</span> <span class="hljs-string">https://github.com/46434276/repo.git</span>  <span class="hljs-comment">#配置git服务地址</span><br>          <span class="hljs-attr">username:</span> <span class="hljs-number">46434276</span><span class="hljs-string">@qq.com</span> <span class="hljs-comment">#配置git用户名</span><br>          <span class="hljs-attr">password:</span> <span class="hljs-string">Sunguoan123</span> <span class="hljs-comment">#配置git密码</span><br>          <span class="hljs-attr">search-paths:</span><br>            <span class="hljs-bullet">-</span> <span class="hljs-string">repo</span>  <span class="hljs-comment">#仓库名</span><br>          <span class="hljs-attr">default-label:</span> <span class="hljs-string">master</span> <span class="hljs-comment"># 使用的默认分支，默认为 master</span><br>          <span class="hljs-attr">clone-on-start:</span> <span class="hljs-literal">true</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:7001/eureka</span><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">prefer-ip-address:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">instance-id:</span> <span class="hljs-string">$&#123;spring.cloud.client.ip-address&#125;:$&#123;server.port&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>启动edu-config-boot服务工程，就可以和github获得联系，加载仓库中的配置文件了</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableEurekaClient</span> <br><span class="hljs-meta">@EnableConfigServer</span> <span class="hljs-comment">// 配置中心</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">EduConfigBootApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(EduConfigBootApplication.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h4 id="1-2-5-客户端工程配置（广告服务为例）"><a href="#1-2-5-客户端工程配置（广告服务为例）" class="headerlink" title="1.2.5 客户端工程配置（广告服务为例）"></a>1.2.5 客户端工程配置（广告服务为例）</h4><ul>
<li>因为application.yml配置都推送到git上，所以以往的application.yml文件里面的内容都可以不写了</li>
<li>但是要将application.yml文件更名为bootstrap.yml</li>
<li>因为bootstrap.yml文件启动优先级更高</li>
<li>在启动时就加载，加载就去edu-config-boot中找属于自己的配置信息，edu-config-boot得到请求后，会去git中找</li>
<li>bootstrap.yml 内容如下：</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">config:</span><br>      <span class="hljs-attr">name:</span> <span class="hljs-string">edu-ad-boot</span> <span class="hljs-comment">#github上去掉yml的资源名称</span><br>      <span class="hljs-attr">profile:</span> <span class="hljs-string">dev</span>   <span class="hljs-comment">#本次访问的配置项</span><br>      <span class="hljs-attr">label:</span> <span class="hljs-string">master</span><br>      <span class="hljs-attr">uri:</span> <span class="hljs-string">http://localhost:9966</span> <span class="hljs-comment"># 去9966配置服务中心找属于自己的配置信息，靠上面的name和profile值查找</span><br></code></pre></td></tr></table></figure>

<ul>
<li>springboot本身是不支持bootstrap文件的   需要结合springcloud的组件一起使用</li>
<li>从Spring Boot 2.4版本开始，配置文件加载方式进行了重构</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-comment">&lt;!-- 配置中心 客户端 --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-config-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br><span class="hljs-comment">&lt;!-- 微服务起始加载bootstrap --&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-bootstrap<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>





<hr>
<h1 id="10-IDEA集成Docker部署微服务"><a href="#10-IDEA集成Docker部署微服务" class="headerlink" title="10 IDEA集成Docker部署微服务"></a>10 IDEA集成Docker部署微服务</h1><h2 id="1-回顾docker"><a href="#1-回顾docker" class="headerlink" title="1 回顾docker"></a>1 回顾docker</h2><ul>
<li>我想要盖房子，于是我搬砖、砍木头、画图纸、和水泥。一顿操作猛如虎，终于把这个房子盖好了。</li>
</ul>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/11.PNG" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>住了一段时间后，心血来潮想搬回东北老家。这时候按之前的办法，我只能回到东北后，再次搬砖、砍木头、画图纸、和水泥、盖房子。</li>
</ul>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/22.PNG" srcset="/img/loading.gif" lazyload></p>
<ul>
<li>突然，降临一位神仙姐姐教了我一种法术。这个法术可以把我的房子复制一份，做成「镜像」，并可以放在百宝箱里</li>
</ul>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/33.PNG" srcset="/img/loading.gif" lazyload></p>
<ul>
<li><p>抱着百宝箱就回了东北，就用这个「镜像」，复制一套房子，完美复刻，拎包入住</p>
</li>
<li><p>是不是很神奇？对应到我们的项目中来，房子就是项目本身，镜像就是项目的复制，百宝箱就是镜像仓库</p>
</li>
<li><p>如果要动态扩容，从仓库中取出项目镜像，随便复制就可以了</p>
</li>
<li><p>不用再关注版本、兼容、部署等问题，彻底解决了「开发完美，上线就崩，无终止排查环境」的尴尬</p>
</li>
</ul>
<h2 id="2-安装docker"><a href="#2-安装docker" class="headerlink" title="2 安装docker"></a>2 安装docker</h2><figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs apl"># 在192.168.204.141安装docker<br>[root@A ~]# yum -y install docker<br><br># 启动docker<br>[root@A ~]# systemctl start docker<br><br># 查看docker的运行状态<br>[root@A ~]# systemctl status docker<br></code></pre></td></tr></table></figure>



<h2 id="3-开启远程访问"><a href="#3-开启远程访问" class="headerlink" title="3 开启远程访问"></a>3 开启远程访问</h2><ul>
<li>Docker默认是不允许远程访问的</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apl"># 修改配置文件<br>[root@A ~]# vim /lib/systemd/system/docker.service<br></code></pre></td></tr></table></figure>

<blockquote>
<p>ExecStart&#x3D;&#x2F;usr&#x2F;bin&#x2F;dockerd -H tcp:&#x2F;&#x2F;0.0.0.0:2375 -H unix:&#x2F;&#x2F;var&#x2F;run&#x2F;docker.sock</p>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/d1.png" srcset="/img/loading.gif" lazyload></p>
</blockquote>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><code class="hljs apl"># 重新加载配置文件<br>[root@A ~]# systemctl daemon-reload<br><br># 重启docker<br>[root@A ~]# service docker restart<br><br># 查看端口是否开启<br>[root@A ~]# netstat -nlpt<br><br># 验证端口是否生效<br>[root@A ~]# curl http://192.168.204.141:2375/info<br></code></pre></td></tr></table></figure>



<h2 id="4-IDEA集成插件"><a href="#4-IDEA集成插件" class="headerlink" title="4 IDEA集成插件"></a>4 IDEA集成插件</h2><ul>
<li>在Plugins中搜索Docker，并安装</li>
</ul>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/d2.png" srcset="/img/loading.gif" lazyload alt="image-20201105112002067"></p>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/d3.png" srcset="/img/loading.gif" lazyload alt="img"></p>
<p><a target="_blank" rel="noopener" href="https://owi3yzzk.mirror.aliyuncs.com/">https://owi3yzzk.mirror.aliyuncs.com</a></p>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/d4.png" srcset="/img/loading.gif" lazyload alt="image-20201105112310982"></p>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/d5.png" srcset="/img/loading.gif" lazyload alt="image-20201105112454252"></p>
<h2 id="5-Docker的Maven插件"><a href="#5-Docker的Maven插件" class="headerlink" title="5 Docker的Maven插件"></a>5 Docker的Maven插件</h2><ul>
<li>传统的过程中，要经历打包，部署，上传到linux，编写Dockerfile，构建镜像，创建容器等步骤</li>
<li>docker-maven-plugin就是帮助我们在开发构成中，<b style='color:red'>自动生成镜像并推送到仓库中</b></li>
<li>docker打包项目的插件有两种。<ul>
<li>docker-maven-plugin</li>
<li>dockerfile</li>
</ul>
</li>
</ul>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.spotify<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>docker-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">configuration</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--镜像名称 laosun/test-docker-demo--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">imageName</span>&gt;</span>laosun/$&#123;project.artifactId&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">imageName</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--标签版本--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">imageTags</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">imageTag</span>&gt;</span>latest<span class="hljs-tag">&lt;/<span class="hljs-name">imageTag</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">imageTags</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--基础镜像，相当于Dockerfile里的from--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">baseImage</span>&gt;</span>java<span class="hljs-tag">&lt;/<span class="hljs-name">baseImage</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--标签版本--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">maintainer</span>&gt;</span>laosun angiersun@lagou.com<span class="hljs-tag">&lt;/<span class="hljs-name">maintainer</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--入口点，project.build.finalName就是project标签下的build标签下的filename标签内容，test-docker-demo--&gt;</span><br>        <span class="hljs-comment">&lt;!--相当于启动容器后，会自动执行java -jar/test-docker-demo.jar--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">entryPoint</span>&gt;</span>[&quot;java&quot;, &quot;-jar&quot;, &quot;/$&#123;project.build.finalName&#125;.jar&quot;]<span class="hljs-tag">&lt;/<span class="hljs-name">entryPoint</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--docker地址--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dockerHost</span>&gt;</span>http://192.168.204.141:2375<span class="hljs-tag">&lt;/<span class="hljs-name">dockerHost</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- 这里是复制 jar 包到 docker 容器指定目录配置 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">resources</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">resource</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">targetPath</span>&gt;</span>/<span class="hljs-tag">&lt;/<span class="hljs-name">targetPath</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--复制的根目录，target--&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">directory</span>&gt;</span>$&#123;project.build.directory&#125;<span class="hljs-tag">&lt;/<span class="hljs-name">directory</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--把哪个文件上传到docker，相当于Dockerfile里的add test-docker-demo.jar /--&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">include</span>&gt;</span>$&#123;project.build.finalName&#125;.jar<span class="hljs-tag">&lt;/<span class="hljs-name">include</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">resource</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">resources</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">configuration</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h2 id="6-执行命令"><a href="#6-执行命令" class="headerlink" title="6 执行命令"></a>6 执行命令</h2><ul>
<li><p>对项目进行打包，并构建镜像到docker上</p>
</li>
<li><p>第一次执行多等一会，要拉取java的环境等等操作</p>
</li>
<li><p><b style='color:red'>注意：构建镜像，要将项目中用到的localhost改为docker服务器的ip</b>，然后再进行构建镜像</p>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210319143055076.png" srcset="/img/loading.gif" lazyload alt="image-20210319143055076"></p>
</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apl">mvn clean package docker:build<br></code></pre></td></tr></table></figure>

<ul>
<li>命令执行完成，会自动将jar包镜像推送到docker</li>
<li>在idea的docker界面，根据镜像创建容器即可</li>
<li><b style='color:red'>一个镜像可以创建N个容器</b></li>
<li>查看正在运行的容器</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><code class="hljs apl">docker ps<br></code></pre></td></tr></table></figure>

<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20201105134622304.png" srcset="/img/loading.gif" lazyload alt="image-20201105134622304"></p>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210319131137670.png" srcset="/img/loading.gif" lazyload alt="image-20210319131137670"></p>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210319142838823.png" srcset="/img/loading.gif" lazyload alt="image-20210319142838823"></p>
<ul>
<li>如果出现以下的错误，请执行对应的命令即可，都是找不到可执行文件的原因</li>
</ul>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20201105133347494.png" srcset="/img/loading.gif" lazyload alt="image-20201105133347494"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apl">[root@A ~]# cd /usr/libexec/docker/<br>[root@A docker]# ln -s docker-proxy-current docker-proxy<br></code></pre></td></tr></table></figure>

<ul>
<li>找不到docker运行的命令</li>
</ul>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20201105134345284.png" srcset="/img/loading.gif" lazyload alt="image-20201105134345284"></p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apl">[root@A docker]# cd /usr/libexec/docker/<br>[root@A docker]# ln -s docker-runc-current docker-runc<br></code></pre></td></tr></table></figure>

<ul>
<li>最后修改前端项目调用服务的ip，即可访问</li>
</ul>
<hr>
<h1 id="12-分布式事务解决方案（Seata）"><a href="#12-分布式事务解决方案（Seata）" class="headerlink" title="12 分布式事务解决方案（Seata）"></a>12 分布式事务解决方案（Seata）</h1><h2 id="1、为什么选择seata"><a href="#1、为什么选择seata" class="headerlink" title="1、为什么选择seata"></a>1、为什么选择seata</h2><ul>
<li>我们的项目是微服务项目，多数据源，因此很多业务操作避免不了跨数据源操作，传统的事务是不能解决跨数据源的，因此我们需要寻求分布式事务的解决方案</li>
<li>Seata 是一款开源的分布式事务解决方案，致力于在微服务架构下提供高性能和简单易用的分布式事务服务。</li>
<li>Seata 是 Simple Extensible Autonomous Transaction Architecture 的简写，Fescar 品牌升级，更名为 Seata</li>
<li>在 Seata 开源之前，Seata 对应的内部版本在阿里经济体内部一直扮演着分布式一致性中间件的角色，帮助经济体平稳的度过历年的双11，可以说十分强大</li>
<li>2019.1 为了打造更加完善的技术生态和普惠技术成果，Seata 正式宣布对外开源. </li>
<li>使用seata需要服务端（官网提供下载）和客户端（微服务）配合来完成</li>
</ul>
<h3 id="1-1-通用案例"><a href="#1-1-通用案例" class="headerlink" title="1.1 通用案例"></a>1.1 通用案例</h3><ul>
<li>订单保存成功 &amp; 累计账户积分+10</li>
<li>账户微服务和订单微服务，都各自有独立的数据库</li>
</ul>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20221121232450752.png" srcset="/img/loading.gif" lazyload alt="image-20221121232450752"></p>
<h4 id="1-1-1-账户微服务"><a href="#1-1-1-账户微服务" class="headerlink" title="1.1.1 账户微服务"></a>1.1.1 账户微服务</h4><ul>
<li>数据库</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> DATABASE <span class="hljs-comment">/*!32312 IF NOT EXISTS*/</span>`test<span class="hljs-operator">-</span>account` <span class="hljs-comment">/*!40100 DEFAULT CHARACTER SET utf8 */</span>;<br><br>USE `test<span class="hljs-operator">-</span>account`;<br><br><span class="hljs-comment">/*Table structure for table `taccount` */</span><br><br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> `taccount`;<br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `taccount` (<br>  `id` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) unsigned zerofill <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT COMMENT <span class="hljs-string">&#x27;账户编号&#x27;</span>,<br>  `name` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;昵称&#x27;</span>,<br>  `score` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;积分&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB AUTO_INCREMENT<span class="hljs-operator">=</span><span class="hljs-number">4</span> <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;<br><br><span class="hljs-comment">/*Data for the table `taccount` */</span><br><br><span class="hljs-keyword">insert</span>  <span class="hljs-keyword">into</span> `taccount`(`id`,`name`,`score`) <span class="hljs-keyword">values</span> <br>(<span class="hljs-number">00000000001</span>,<span class="hljs-string">&#x27;吕布&#x27;</span>,<span class="hljs-number">0</span>),<br>(<span class="hljs-number">00000000002</span>,<span class="hljs-string">&#x27;赵云&#x27;</span>,<span class="hljs-number">0</span>),<br>(<span class="hljs-number">00000000003</span>,<span class="hljs-string">&#x27;典韦&#x27;</span>,<span class="hljs-number">0</span>);<br></code></pre></td></tr></table></figure>

<ul>
<li>controller</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;account&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AccountController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AccountService accountService;<br><br>    <span class="hljs-meta">@GetMapping(&quot;update&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">updateAccountScore</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span> accountService.updateAccountScore(<span class="hljs-number">1</span>, <span class="hljs-number">10</span>);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>dao</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AccountDao</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;Taccount&gt; &#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>service</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">AccountServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">AccountService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AccountDao accountDao;<br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">updateAccountScore</span><span class="hljs-params">(<span class="hljs-type">int</span> userid, <span class="hljs-type">int</span> score)</span> &#123;<br>        <span class="hljs-type">Taccount</span> <span class="hljs-variable">account</span> <span class="hljs-operator">=</span> accountDao.selectById(userid);<br>        <span class="hljs-comment">// 在原来的积分之上，再增加10分</span><br>        account.setScore(account.getScore()+score);<br>        <span class="hljs-keyword">return</span> accountDao.updateById(account);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>yml  三个微服务都是一样的，这里只放一份</li>
</ul>
<figure class="highlight yml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs yml"><span class="hljs-attr">server:</span><br>  <span class="hljs-attr">port:</span> <span class="hljs-number">8002</span><br><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">test-account</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.204.141:3306/test-account?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=UTC</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123123</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:7001/eureka</span><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">prefer-ip-address:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">instance-id:</span> <span class="hljs-string">$&#123;spring.cloud.client.ip-address&#125;:$&#123;server.port&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li>启动类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication</span><br><span class="hljs-meta">@EnableEurekaClient</span> <span class="hljs-comment">// 注册到中心的客户端</span><br><span class="hljs-meta">@MapperScan(&quot;com.lagou.testaccount.dao&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestAccountApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(TestAccountApplication.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h4 id="1-1-2-订单微服务"><a href="#1-1-2-订单微服务" class="headerlink" title="1.1.2 订单微服务"></a>1.1.2 订单微服务</h4><ul>
<li>数据库</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> DATABASE <span class="hljs-comment">/*!32312 IF NOT EXISTS*/</span>`test<span class="hljs-operator">-</span><span class="hljs-keyword">order</span>` <span class="hljs-comment">/*!40100 DEFAULT CHARACTER SET utf8 */</span>;<br><br>USE `test<span class="hljs-operator">-</span><span class="hljs-keyword">order</span>`;<br><br><span class="hljs-comment">/*Table structure for table `torder` */</span><br><br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> `torder`;<br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `torder` (<br>  `id` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> COMMENT <span class="hljs-string">&#x27;订单编号&#x27;</span>,<br>  `uid` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;账户编号&#x27;</span>,<br>  `pid` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> <span class="hljs-keyword">DEFAULT</span> <span class="hljs-string">&#x27;0&#x27;</span> COMMENT <span class="hljs-string">&#x27;商品编号&#x27;</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;<br></code></pre></td></tr></table></figure>

<ul>
<li>controller</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;order&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderService orderService;<br><br>    <span class="hljs-meta">@GetMapping(&quot;save&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">Torder</span> <span class="hljs-variable">order</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">Torder</span>();<br>        order.setId(UUID.randomUUID().toString().replaceAll(<span class="hljs-string">&quot;-&quot;</span>, <span class="hljs-string">&quot;&quot;</span>));<br>        order.setUid(<span class="hljs-number">1</span>);<br>        order.setPid(<span class="hljs-number">11</span>);<br>        <span class="hljs-keyword">return</span> orderService.saveOrder(order);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>dao</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderDao</span> <span class="hljs-keyword">extends</span> <span class="hljs-title class_">BaseMapper</span>&lt;Torder&gt;&#123;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>service</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">OrderServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">OrderService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderDao orderDao;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">int</span> <span class="hljs-title function_">saveOrder</span><span class="hljs-params">(Torder order)</span> &#123;<br>        <span class="hljs-keyword">return</span> orderDao.insert(order);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>启动类同上</li>
</ul>
<h4 id="1-1-3-业务入口"><a href="#1-1-3-业务入口" class="headerlink" title="1.1.3 业务入口"></a>1.1.3 业务入口</h4><ul>
<li>controller</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@RestController</span><br><span class="hljs-meta">@RequestMapping(&quot;front&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">frontController</span> &#123;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> BusinessService businessService;<br><br>    <span class="hljs-meta">@GetMapping(&quot;business&quot;)</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">business</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-keyword">return</span>  businessService.business();<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>service</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BusinessServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BusinessService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AccountRemoteService accountRemoteService;<br><br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderRemoteService orderRemoteService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">business</span><span class="hljs-params">()</span> &#123;<br>        accountRemoteService.update();<br>		<span class="hljs-comment">// int i = 10/0;</span><br>        orderRemoteService.save();<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li><p>remote远程接口</p>
<p>@FeignClient(name &#x3D; <b style='color:red'>“微服务名”</b> , path &#x3D; <b style='color:red'>“一级路径”</b> )</p>
</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FeignClient(name = &quot;test-account&quot;,path = &quot;account&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">AccountRemoteService</span> &#123;<br>    <span class="hljs-meta">@GetMapping(&quot;update&quot;)</span><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">update</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@FeignClient(name = &quot;test-order&quot;,path = &quot;order&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">interface</span> <span class="hljs-title class_">OrderRemoteService</span> &#123;<br>    <span class="hljs-meta">@GetMapping(&quot;save&quot;)</span><br>    <span class="hljs-type">int</span> <span class="hljs-title function_">save</span><span class="hljs-params">()</span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>启动类</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication(exclude = &#123;DataSourceAutoConfiguration.class&#125;)</span><span class="hljs-comment">// 排除 数据库自动注入（依赖中有mybatis，所以会自检）</span><br><span class="hljs-meta">@EnableEurekaClient</span><br><span class="hljs-meta">@EnableFeignClients</span> <span class="hljs-comment">// feign的客户端</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestFrontApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(TestFrontApplication.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="2、下载与安装"><a href="#2、下载与安装" class="headerlink" title="2、下载与安装"></a>2、下载与安装</h2><ul>
<li>官网：<a target="_blank" rel="noopener" href="http://seata.io/zh-cn/index.html">http://seata.io/zh-cn/index.html</a></li>
</ul>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210324164927921.png" srcset="/img/loading.gif" lazyload alt="image-20210324164927921"></p>
<ul>
<li>尽量不要选择最新的版本“不太稳定”，我们选择下载 <a target="_blank" rel="noopener" href="https://github.com/seata/seata/releases/download/v1.2.0/seata-server-1.2.0.zip">1.2.0 (2020-04-20) binary</a></li>
</ul>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210324165001869.png" srcset="/img/loading.gif" lazyload alt="image-20210324165001869"></p>
<ul>
<li>seata-server-1.2.0.zip 上传到linux，并解压</li>
</ul>
<h2 id="3、配置服务端"><a href="#3、配置服务端" class="headerlink" title="3、配置服务端"></a>3、配置服务端</h2><ul>
<li><p>解压完成</p>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apl">[root@A opt]# unzip seata-server-1.2.0.zip<br>[root@A opt]# cd seata/conf<br></code></pre></td></tr></table></figure>
</li>
<li><p>主要配置两个文件：</p>
<ul>
<li>file.conf 配置数据库</li>
<li>registry.conf 配置注册中心</li>
</ul>
</li>
</ul>
<h3 id="3-1-file-conf"><a href="#3-1-file-conf" class="headerlink" title="3.1 file.conf"></a>3.1 file.conf</h3><ul>
<li>在mysql建一个seata库，下面的脚本代码，要在1.0之前的版本中<strong>db_store.sql</strong>获取，1.0之后取消了这个脚本文件，复制下面代码</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> DATABASE <span class="hljs-comment">/*!32312 IF NOT EXISTS*/</span>`seata` <span class="hljs-comment">/*!40100 DEFAULT CHARACTER SET utf8 */</span>;<br><br>USE `seata`;<br><br><span class="hljs-comment">/*Table structure for table `branch_table` */</span><br><br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> `branch_table`;<br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `branch_table` (<br>  `branch_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `xid` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `transaction_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `resource_group_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `resource_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `lock_key` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `branch_type` <span class="hljs-type">varchar</span>(<span class="hljs-number">8</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `status` tinyint(<span class="hljs-number">4</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `client_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">64</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `application_data` <span class="hljs-type">varchar</span>(<span class="hljs-number">2000</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `gmt_create` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `gmt_modified` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`branch_id`),<br>  KEY `idx_xid` (`xid`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;<br><br><span class="hljs-comment">/*Data for the table `branch_table` */</span><br><br><span class="hljs-comment">/*Table structure for table `global_table` */</span><br><br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> `global_table`;<br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `global_table` (<br>  `xid` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `transaction_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `status` tinyint(<span class="hljs-number">4</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `application_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `transaction_service_group` <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `transaction_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `timeout` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `begin_time` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `application_data` <span class="hljs-type">varchar</span>(<span class="hljs-number">2000</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `gmt_create` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `gmt_modified` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`xid`),<br>  KEY `idx_gmt_modified_status` (`gmt_modified`,`status`),<br>  KEY `idx_transaction_id` (`transaction_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;<br><br><span class="hljs-comment">/*Data for the table `global_table` */</span><br><br><span class="hljs-comment">/*Table structure for table `lock_table` */</span><br><br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> `lock_table`;<br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `lock_table` (<br>  `row_key` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `xid` <span class="hljs-type">varchar</span>(<span class="hljs-number">96</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `transaction_id` mediumtext,<br>  `branch_id` mediumtext,<br>  `resource_id` <span class="hljs-type">varchar</span>(<span class="hljs-number">256</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `table_name` <span class="hljs-type">varchar</span>(<span class="hljs-number">32</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `pk` <span class="hljs-type">varchar</span>(<span class="hljs-number">36</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `gmt_create` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  `gmt_modified` datetime <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`row_key`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;<br><br><span class="hljs-comment">/*Data for the table `lock_table` */</span><br><br><span class="hljs-comment">/*Table structure for table `undo_log` */</span><br><br><span class="hljs-keyword">DROP</span> <span class="hljs-keyword">TABLE</span> IF <span class="hljs-keyword">EXISTS</span> `undo_log`;<br><br><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `undo_log` (<br>  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `branch_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `xid` <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `context` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `rollback_info` longblob <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `log_status` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `log_created` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `log_modified` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `ext` <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;<br></code></pre></td></tr></table></figure>



<ul>
<li>打开file.conf文件，修改两处</li>
</ul>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210319173913727.png" srcset="/img/loading.gif" lazyload alt="image-20210319173913727"></p>
<h3 id="3-2-registry-conf"><a href="#3-2-registry-conf" class="headerlink" title="3.2 registry.conf"></a>3.2 registry.conf</h3><p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210319174210095.png" srcset="/img/loading.gif" lazyload alt="image-20210319174940878"></p>
<h3 id="3-3-启动"><a href="#3-3-启动" class="headerlink" title="3.3 启动"></a>3.3 启动</h3><ul>
<li>先启动eureka</li>
<li>再启动seata的服务端</li>
</ul>
<figure class="highlight plaintext"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><code class="hljs apl">[root@A ~]# cd /opt/seata/bin/<br>[root@A bin]# ./seata-server.sh -p 9099 -m db<br></code></pre></td></tr></table></figure>

<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210319175108032.png" srcset="/img/loading.gif" lazyload alt="image-20210319175108032"></p>
<p>服务端启动成功</p>
<p>【我出现的问题】：linux启动是时候报错(使用的是jdk11)-window启动没有问题</p>
<p>Error: Could not create the Java Virtual Machine.<br>Error: A fatal exception has occurred. Program will exit.</p>
<h2 id="4、配置客户端"><a href="#4、配置客户端" class="headerlink" title="4、配置客户端"></a>4、配置客户端</h2><p><b style='color:blue'>以下过程，每个参与事务的微服务都要配置一遍，3个conf，yml，启动类，数据库</b></p>
<h3 id="4-1-pom"><a href="#4-1-pom" class="headerlink" title="4.1 pom"></a>4.1 pom</h3><ul>
<li>父工程引入，子工程继承即可</li>
</ul>
<p>【使用下面版本启动不会报错：<version>2.3.2.RELEASE</version>】</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-meta">&lt;?xml version=<span class="hljs-string">&quot;1.0&quot;</span> encoding=<span class="hljs-string">&quot;UTF-8&quot;</span>?&gt;</span><br><span class="hljs-tag">&lt;<span class="hljs-name">project</span> <span class="hljs-attr">xmlns</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0&quot;</span> <span class="hljs-attr">xmlns:xsi</span>=<span class="hljs-string">&quot;http://www.w3.org/2001/XMLSchema-instance&quot;</span></span><br><span class="hljs-tag">         <span class="hljs-attr">xsi:schemaLocation</span>=<span class="hljs-string">&quot;http://maven.apache.org/POM/4.0.0 https://maven.apache.org/xsd/maven-4.0.0.xsd&quot;</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">modelVersion</span>&gt;</span>4.0.0<span class="hljs-tag">&lt;/<span class="hljs-name">modelVersion</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">parent</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-parent<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.4.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">relativePath</span>/&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">parent</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.lagou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>test-seata<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.0-SNAPSHOT<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">properties</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">java.version</span>&gt;</span>1.8<span class="hljs-tag">&lt;/<span class="hljs-name">java.version</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">properties</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-web<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-netflix-eureka-client<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.baomidou<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mybatis-plus-boot-starter<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.3.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>mysql<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>mysql-connector-java<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--pojo持久化使用--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>javax.persistence<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>javax.persistence-api<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.2<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.projectlombok<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>lombok<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.18.12<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>		<span class="hljs-comment">&lt;!--feign--&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-starter-openfeign<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!-- commons-lang3 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.apache.commons<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>commons-lang3<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>3.10<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-comment">&lt;!--添加seata依赖：cloud集成的seata依赖，全局事务中使用的过滤器已经集成了，直接使用即可 --&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-alibaba-seata<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>                <span class="hljs-comment">&lt;!--排除低版本--&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>io.seata<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>seata-all<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br><br>        <span class="hljs-comment">&lt;!-- 这样引用seata本身的依赖也是可以的，但是要配置许多额外的程序，过滤器和注解 --&gt;</span><br>         <span class="hljs-comment">&lt;!--&lt;dependency&gt;--&gt;</span><br>			 <span class="hljs-comment">&lt;!--&lt;groupId&gt;io.seata&lt;/groupId&gt;--&gt;</span><br>			 <span class="hljs-comment">&lt;!--&lt;artifactId&gt;seata-all&lt;/artifactId&gt;--&gt;</span><br>             <span class="hljs-comment">&lt;!--&lt;version&gt;1.3.0&lt;/version&gt;--&gt;</span><br>         <span class="hljs-comment">&lt;!--&lt;/dependency&gt;--&gt;</span><br>        <br>        <br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-starter-test<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>test<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">exclusions</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">exclusion</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.junit.vintage<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>junit-vintage-engine<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;/<span class="hljs-name">exclusion</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">exclusions</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">dependencyManagement</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">dependencies</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>Greenwich.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba.cloud<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-cloud-alibaba-dependencies<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>2.1.0.RELEASE<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">type</span>&gt;</span>pom<span class="hljs-tag">&lt;/<span class="hljs-name">type</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">scope</span>&gt;</span>import<span class="hljs-tag">&lt;/<span class="hljs-name">scope</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">dependencies</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">dependencyManagement</span>&gt;</span><br><br>    <span class="hljs-tag">&lt;<span class="hljs-name">build</span>&gt;</span><br>        <span class="hljs-tag">&lt;<span class="hljs-name">plugins</span>&gt;</span><br>            <span class="hljs-tag">&lt;<span class="hljs-name">plugin</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>org.springframework.boot<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>                <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>spring-boot-maven-plugin<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>            <span class="hljs-tag">&lt;/<span class="hljs-name">plugin</span>&gt;</span><br>        <span class="hljs-tag">&lt;/<span class="hljs-name">plugins</span>&gt;</span><br>    <span class="hljs-tag">&lt;/<span class="hljs-name">build</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">project</span>&gt;</span><br></code></pre></td></tr></table></figure>



<p>【druid连接池的依赖】</p>
<figure class="highlight xml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><code class="hljs xml"><span class="hljs-tag">&lt;<span class="hljs-name">dependency</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">groupId</span>&gt;</span>com.alibaba<span class="hljs-tag">&lt;/<span class="hljs-name">groupId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">artifactId</span>&gt;</span>druid<span class="hljs-tag">&lt;/<span class="hljs-name">artifactId</span>&gt;</span><br>    <span class="hljs-tag">&lt;<span class="hljs-name">version</span>&gt;</span>1.2.1<span class="hljs-tag">&lt;/<span class="hljs-name">version</span>&gt;</span><br><span class="hljs-tag">&lt;/<span class="hljs-name">dependency</span>&gt;</span><br></code></pre></td></tr></table></figure>



<h2 id="4-2-配置文件3个"><a href="#4-2-配置文件3个" class="headerlink" title="4.2 配置文件3个"></a>4.2 配置文件3个</h2><p>【每个工程的配置文件（application.yml）-直接去官方示例中获取即可；】</p>
<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20221122001821474.png" srcset="/img/loading.gif" lazyload alt="image-20221122001821474"></p>
<p>【每个项目中都要有这三个配置文件】</p>
<ul>
<li><p>全部存放在项目的resources资源目录中</p>
</li>
<li><p>其中file.conf和registry.conf去github示例项目中获取：【使用这个】</p>
<p><a target="_blank" rel="noopener" href="https://github.com/seata/seata-samples/blob/master/springboot-dubbo-seata/samples-business">https://github.com/seata/seata-samples/blob/master/springboot-dubbo-seata/samples-business</a></p>
<p>如果github打不开，可以换地址【已经打不开了】</p>
<p><a target="_blank" rel="noopener" href="https://hub.fastgit.org/seata/seata-samples/tree/master/springboot-dubbo-seata/samples-business">https://hub.fastgit.org/seata/seata-samples/tree/master/springboot-dubbo-seata/samples-business</a></p>
</li>
</ul>
<p>进入：<a target="_blank" rel="noopener" href="https://hub.fastgit.org/seata/seata-samples/tree/master/springboot-dubbo-seata/samples-business/src/main/resources">https://hub.fastgit.org/seata/seata-samples/tree/master/springboot-dubbo-seata/samples-business/src/main/resources</a></p>
<p>【只需要关心改成中文的配置即可】</p>
<ul>
<li><p><strong>file.conf</strong></p>
<p>vgroupMapping.<b style='color:blue'>自定义名称</b> &#x3D; “<b style='color:red'>分布式seata applicationName</b>“<br><b style='color:red'>分布式seata applicationName</b>.grouplist &#x3D; “192.168.204.141:9099”</p>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br></pre></td><td class="code"><pre><code class="hljs json">transport <span class="hljs-punctuation">&#123;</span><br>  # tcp udt unix-domain-socket<br>  type = <span class="hljs-string">&quot;TCP&quot;</span><br>  #NIO NATIVE<br>  server = <span class="hljs-string">&quot;NIO&quot;</span><br>  #enable heartbeat<br>  heartbeat = <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>  # the client batch send request enable<br>  enableClientBatchSendRequest = <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>  #thread factory for netty<br>  threadFactory <span class="hljs-punctuation">&#123;</span><br>    bossThreadPrefix = <span class="hljs-string">&quot;NettyBoss&quot;</span><br>    workerThreadPrefix = <span class="hljs-string">&quot;NettyServerNIOWorker&quot;</span><br>    serverExecutorThread-prefix = <span class="hljs-string">&quot;NettyServerBizHandler&quot;</span><br>    shareBossWorker = <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>    clientSelectorThreadPrefix = <span class="hljs-string">&quot;NettyClientSelector&quot;</span><br>    clientSelectorThreadSize = <span class="hljs-number">1</span><br>    clientWorkerThreadPrefix = <span class="hljs-string">&quot;NettyClientWorkerThread&quot;</span><br>    # netty boss thread size<span class="hljs-punctuation">,</span>will not be used for UDT<br>    bossThreadSize = <span class="hljs-number">1</span><br>    #auto default pin or <span class="hljs-number">8</span><br>    workerThreadSize = <span class="hljs-string">&quot;default&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  shutdown <span class="hljs-punctuation">&#123;</span><br>    # when destroy server<span class="hljs-punctuation">,</span> wait seconds<br>    wait = <span class="hljs-number">3</span><br>  <span class="hljs-punctuation">&#125;</span><br>  serialization = <span class="hljs-string">&quot;seata&quot;</span><br>  compressor = <span class="hljs-string">&quot;none&quot;</span><br><span class="hljs-punctuation">&#125;</span><br>service <span class="hljs-punctuation">&#123;</span><br>  # 自定义的事务组由 seata服务端 管理<br>  vgroupMapping.my_tx_group = <span class="hljs-string">&quot;seata-server&quot;</span><br>  # 服务端的ip和端口<br>  seata-server.grouplist = <span class="hljs-string">&quot;192.168.204.141:9099&quot;</span><br>  #degrade<span class="hljs-punctuation">,</span> current not support<br>  enableDegrade = <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>  #disable seata<br>  disableGlobalTransaction = <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br><span class="hljs-punctuation">&#125;</span><br><br>client <span class="hljs-punctuation">&#123;</span><br>  rm <span class="hljs-punctuation">&#123;</span><br>    asyncCommitBufferLimit = <span class="hljs-number">10000</span><br>    lock <span class="hljs-punctuation">&#123;</span><br>      retryInterval = <span class="hljs-number">10</span><br>      retryTimes = <span class="hljs-number">30</span><br>      retryPolicyBranchRollbackOnConflict = <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>    <span class="hljs-punctuation">&#125;</span><br>    reportRetryCount = <span class="hljs-number">5</span><br>    tableMetaCheckEnable = <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>    reportSuccessEnable = <span class="hljs-literal"><span class="hljs-keyword">false</span></span><br>  <span class="hljs-punctuation">&#125;</span><br>  tm <span class="hljs-punctuation">&#123;</span><br>    commitRetryCount = <span class="hljs-number">5</span><br>    rollbackRetryCount = <span class="hljs-number">5</span><br>  <span class="hljs-punctuation">&#125;</span><br>  undo <span class="hljs-punctuation">&#123;</span><br>    dataValidation = <span class="hljs-literal"><span class="hljs-keyword">true</span></span><br>    logSerialization = <span class="hljs-string">&quot;jackson&quot;</span><br>    logTable = <span class="hljs-string">&quot;undo_log&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  log <span class="hljs-punctuation">&#123;</span><br>    exceptionRate = <span class="hljs-number">100</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><strong>registry.conf</strong><ul>
<li>把type修改成eureka，然后填写自己eureka的地址</li>
</ul>
</li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br></pre></td><td class="code"><pre><code class="hljs json">registry <span class="hljs-punctuation">&#123;</span><br>  # file 、nacos 、eureka、redis、zk、consul、etcd3、sofa<br>  type = <span class="hljs-string">&quot;eureka&quot;</span>  # 注册中心<br><br>  nacos <span class="hljs-punctuation">&#123;</span><br>    application = <span class="hljs-string">&quot;seata-server&quot;</span><br>    serverAddr = <span class="hljs-string">&quot;localhost&quot;</span><br>    namespace = <span class="hljs-string">&quot;&quot;</span><br>    username = <span class="hljs-string">&quot;&quot;</span><br>    password = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  eureka <span class="hljs-punctuation">&#123;</span><br>    serviceUrl = <span class="hljs-string">&quot;http://localhost:7001/eureka&quot;</span>   # 注册中心的地址<br>    application = <span class="hljs-string">&quot;seata-server&quot;</span>  # 服务端名称<br>    weight = <span class="hljs-string">&quot;1&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  redis <span class="hljs-punctuation">&#123;</span><br>    serverAddr = <span class="hljs-string">&quot;localhost:6379&quot;</span><br>    db = <span class="hljs-string">&quot;0&quot;</span><br>    password = <span class="hljs-string">&quot;&quot;</span><br>    timeout = <span class="hljs-string">&quot;0&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  zk <span class="hljs-punctuation">&#123;</span><br>    serverAddr = <span class="hljs-string">&quot;127.0.0.1:2181&quot;</span><br>    sessionTimeout = <span class="hljs-number">6000</span><br>    connectTimeout = <span class="hljs-number">2000</span><br>    username = <span class="hljs-string">&quot;&quot;</span><br>    password = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  consul <span class="hljs-punctuation">&#123;</span><br>    serverAddr = <span class="hljs-string">&quot;127.0.0.1:8500&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  etcd3 <span class="hljs-punctuation">&#123;</span><br>    serverAddr = <span class="hljs-string">&quot;http://localhost:2379&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  sofa <span class="hljs-punctuation">&#123;</span><br>    serverAddr = <span class="hljs-string">&quot;127.0.0.1:9603&quot;</span><br>    region = <span class="hljs-string">&quot;DEFAULT_ZONE&quot;</span><br>    datacenter = <span class="hljs-string">&quot;DefaultDataCenter&quot;</span><br>    group = <span class="hljs-string">&quot;SEATA_GROUP&quot;</span><br>    addressWaitTime = <span class="hljs-string">&quot;3000&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  file <span class="hljs-punctuation">&#123;</span><br>    name = <span class="hljs-string">&quot;file.conf&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br><br>config <span class="hljs-punctuation">&#123;</span><br>  # file、nacos 、apollo、zk、consul、etcd3、springCloudConfig<br>  type = <span class="hljs-string">&quot;file&quot;</span><br><br>  nacos <span class="hljs-punctuation">&#123;</span><br>    serverAddr = <span class="hljs-string">&quot;localhost&quot;</span><br>    namespace = <span class="hljs-string">&quot;&quot;</span><br>    group = <span class="hljs-string">&quot;SEATA_GROUP&quot;</span><br>    username = <span class="hljs-string">&quot;&quot;</span><br>    password = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  consul <span class="hljs-punctuation">&#123;</span><br>    serverAddr = <span class="hljs-string">&quot;127.0.0.1:8500&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  apollo <span class="hljs-punctuation">&#123;</span><br>    appId = <span class="hljs-string">&quot;seata-server&quot;</span><br>    apolloMeta = <span class="hljs-string">&quot;http://192.168.1.204:8801&quot;</span><br>    namespace = <span class="hljs-string">&quot;application&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  zk <span class="hljs-punctuation">&#123;</span><br>    serverAddr = <span class="hljs-string">&quot;127.0.0.1:2181&quot;</span><br>    sessionTimeout = <span class="hljs-number">6000</span><br>    connectTimeout = <span class="hljs-number">2000</span><br>    username = <span class="hljs-string">&quot;&quot;</span><br>    password = <span class="hljs-string">&quot;&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  etcd3 <span class="hljs-punctuation">&#123;</span><br>    serverAddr = <span class="hljs-string">&quot;http://localhost:2379&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br>  file <span class="hljs-punctuation">&#123;</span><br>    name = <span class="hljs-string">&quot;file.conf&quot;</span><br>  <span class="hljs-punctuation">&#125;</span><br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>

<ul>
<li><strong>seata.conf</strong></li>
</ul>
<figure class="highlight json"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><code class="hljs json">client <span class="hljs-punctuation">&#123;</span><br>    application.id = test-front   # 客户端项目的名字<br>    transaction.service.group = my_tx_group   # 自定义的事务组<br><span class="hljs-punctuation">&#125;</span><br></code></pre></td></tr></table></figure>



<h2 id="4-3-启动类"><a href="#4-3-启动类" class="headerlink" title="4.3 启动类"></a>4.3 启动类</h2><ul>
<li>业务工程</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication(exclude = DataSourceAutoConfiguration.class)</span><span class="hljs-comment">// 排除 数据库自动注入 检测是否连接了数据库，如果加上就不会自动检测了；</span><br><span class="hljs-meta">@EnableEurekaClient</span> <span class="hljs-comment">// 注册到中心的客户端</span><br><span class="hljs-meta">@MapperScan(&quot;com.lagou.testaccount.dao&quot;)</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestOrderApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(TestOrderApplication.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<ul>
<li>入口工程</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@SpringBootApplication(exclude = &#123;DataSourceAutoConfiguration.class&#125;)</span> <span class="hljs-comment">// 排除 数据库自动注入</span><br><span class="hljs-meta">@EnableEurekaClient</span><br><span class="hljs-meta">@EnableFeignClients</span> <span class="hljs-comment">// feign的客户端</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">TestFrontApplication</span> &#123;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">void</span> <span class="hljs-title function_">main</span><span class="hljs-params">(String[] args)</span> &#123;<br>        SpringApplication.run(TestFrontApplication.class, args);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="4-4-配置类"><a href="#4-4-配置类" class="headerlink" title="4.4 配置类"></a>4.4 配置类</h2><ul>
<li>业务工程：需要配置数据源</li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-keyword">package</span> com.lagou.testaccount.config;<br><br><span class="hljs-keyword">import</span> com.alibaba.druid.pool.DruidDataSource;<br><span class="hljs-keyword">import</span> io.seata.rm.datasource.DataSourceProxy;<br><span class="hljs-keyword">import</span> io.seata.spring.annotation.GlobalTransactionScanner;<br><span class="hljs-keyword">import</span> org.springframework.beans.factory.annotation.Value;<br><span class="hljs-keyword">import</span> org.springframework.boot.context.properties.ConfigurationProperties;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Bean;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Configuration;<br><span class="hljs-keyword">import</span> org.springframework.context.annotation.Primary;<br><span class="hljs-keyword">import</span> javax.sql.DataSource;<br><br><span class="hljs-comment">/**</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@BelongsProject</span>: test-seata</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Author</span>: GuoAn.Sun</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@CreateTime</span>: 2021-03-22 16:21</span><br><span class="hljs-comment"> * <span class="hljs-doctag">@Description</span>: 使用这个的原因，不再使用spring的主体数据源，使用seata的要给代理的数据源</span><br><span class="hljs-comment"> */</span><br><span class="hljs-meta">@Configuration</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">SeataConfig</span> &#123;<br><br>    <span class="hljs-meta">@Bean</span><br>    <span class="hljs-meta">@ConfigurationProperties(prefix = &quot;spring.datasource&quot;)</span><br>    <span class="hljs-keyword">public</span> DataSource <span class="hljs-title function_">druidDataSource</span><span class="hljs-params">()</span>&#123;<br>        <span class="hljs-type">DruidDataSource</span> <span class="hljs-variable">ds</span> <span class="hljs-operator">=</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DruidDataSource</span>();<br>        <span class="hljs-keyword">return</span> ds;<br>    &#125;<br><br>    <span class="hljs-meta">@Primary</span><br>    <span class="hljs-meta">@Bean(&quot;dataSource&quot;)</span><br>    <span class="hljs-keyword">public</span> DataSourceProxy <span class="hljs-title function_">dataSource</span><span class="hljs-params">(DataSource druidDataSource)</span>&#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-keyword">new</span> <span class="hljs-title class_">DataSourceProxy</span>(druidDataSource);<br>    &#125;<br><br>&#125;<br></code></pre></td></tr></table></figure>



<h2 id="4-5-yml"><a href="#4-5-yml" class="headerlink" title="4.5 yml"></a>4.5 yml</h2><ul>
<li>入口工程删除datasource相关即可</li>
</ul>
<figure class="highlight yaml"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs yaml"><span class="hljs-attr">spring:</span><br>  <span class="hljs-attr">application:</span><br>    <span class="hljs-attr">name:</span> <span class="hljs-string">test-order</span><br>  <span class="hljs-attr">datasource:</span><br>    <span class="hljs-attr">driver-class-name:</span> <span class="hljs-string">com.mysql.cj.jdbc.Driver</span><br>    <span class="hljs-attr">url:</span> <span class="hljs-string">jdbc:mysql://192.168.204.141:3306/test-order?useUnicode=true&amp;characterEncoding=utf8&amp;serverTimezone=UTC</span><br>    <span class="hljs-attr">username:</span> <span class="hljs-string">root</span><br>    <span class="hljs-attr">password:</span> <span class="hljs-number">123123</span><br>  <span class="hljs-attr">cloud:</span><br>    <span class="hljs-attr">alibaba:</span><br>      <span class="hljs-attr">seata:</span><br>        <span class="hljs-attr">tx-service-group:</span> <span class="hljs-string">my_tx_group</span><br><span class="hljs-attr">eureka:</span><br>  <span class="hljs-attr">client:</span><br>    <span class="hljs-attr">service-url:</span><br>      <span class="hljs-attr">defaultZone:</span> <span class="hljs-string">http://localhost:7001/eureka</span><br>    <span class="hljs-attr">register-with-eureka:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">fetch-registry:</span> <span class="hljs-literal">true</span><br>  <span class="hljs-attr">instance:</span><br>    <span class="hljs-attr">prefer-ip-address:</span> <span class="hljs-literal">true</span><br>    <span class="hljs-attr">instance-id:</span> <span class="hljs-string">$&#123;spring.cloud.client.ip-address&#125;:$&#123;server.port&#125;</span><br></code></pre></td></tr></table></figure>

<h2 id="4-6-数据库"><a href="#4-6-数据库" class="headerlink" title="4.6 数据库"></a>4.6 数据库</h2><ul>
<li><b style='color:blue'>账户工程</b> 和 <b style='color:blue'>订单工程</b> 都要创建 <b style='color:red'>undo_log</b> 表，脚本和seata数据库的一模一样</li>
</ul>
<figure class="highlight sql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs sql"><span class="hljs-keyword">CREATE</span> <span class="hljs-keyword">TABLE</span> `undo_log` (<br>  `id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span> AUTO_INCREMENT,<br>  `branch_id` <span class="hljs-type">bigint</span>(<span class="hljs-number">20</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `xid` <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `context` <span class="hljs-type">varchar</span>(<span class="hljs-number">128</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `rollback_info` longblob <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `log_status` <span class="hljs-type">int</span>(<span class="hljs-number">11</span>) <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `log_created` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `log_modified` datetime <span class="hljs-keyword">NOT</span> <span class="hljs-keyword">NULL</span>,<br>  `ext` <span class="hljs-type">varchar</span>(<span class="hljs-number">100</span>) <span class="hljs-keyword">DEFAULT</span> <span class="hljs-keyword">NULL</span>,<br>  <span class="hljs-keyword">PRIMARY</span> KEY (`id`),<br>  <span class="hljs-keyword">UNIQUE</span> KEY `ux_undo_log` (`xid`,`branch_id`)<br>) ENGINE<span class="hljs-operator">=</span>InnoDB <span class="hljs-keyword">DEFAULT</span> CHARSET<span class="hljs-operator">=</span>utf8;<br></code></pre></td></tr></table></figure>



<h2 id="4-7-注解1个"><a href="#4-7-注解1个" class="headerlink" title="4.7 注解1个"></a>4.7 注解1个</h2><ul>
<li>入口工程的业务方法加入注解：<b style='color:blue'>@GlobalTransactional</b></li>
</ul>
<figure class="highlight java"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><code class="hljs java"><span class="hljs-meta">@Service</span><br><span class="hljs-keyword">public</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">BusinessServiceImpl</span> <span class="hljs-keyword">implements</span> <span class="hljs-title class_">BusinessService</span> &#123;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> AccountRemoteService accountRemoteService;<br>    <span class="hljs-meta">@Autowired</span><br>    <span class="hljs-keyword">private</span> OrderRemoteService orderRemoteService;<br><br>    <span class="hljs-meta">@Override</span><br>    <span class="hljs-meta">@GlobalTransactional</span> <span class="hljs-comment">// 全局事务</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">business</span><span class="hljs-params">()</span> &#123;<br>        accountRemoteService.update();<br>		<span class="hljs-comment">// int i = 10/0;</span><br>        orderRemoteService.save();<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">true</span>;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p><img src="/2022/11/02/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5/%E7%AC%AC%E5%8D%81%E9%98%B6%E6%AE%B5%20%E5%BE%AE%E6%9C%8D%E5%8A%A1%E9%A1%B9%E7%9B%AE%EF%BC%9A%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2%E5%AD%A6%E4%B9%A0%E5%B9%B3%E5%8F%B0%EF%BC%88%E5%BE%AE%E6%9C%8D%E5%8A%A1%E6%9E%B6%E6%9E%84%EF%BC%89/%E3%80%90%E6%8B%89%E9%92%A9%E5%B0%B1%E4%B8%9A%E3%80%91%E6%8B%89%E5%8B%BE%E6%95%99%E8%82%B2PC%E7%AB%99-%E5%BE%AE%E6%9C%8D%E5%8A%A1%E7%89%88/image-20210324164751276.png" srcset="/img/loading.gif" lazyload alt="image-20210324164751276"></p>
<p>【目前还是没有成功事务控制】</p>
<p>1、鉴权  springsecurity</p>
<p>2、订单重复，微信中心已经解决</p>
<p>3、限时促销，全程redis存储（秒杀活动）</p>
<p>4、sentinel</p>
<p>5、细化工作</p>
<hr>
<h1 id="数据库设计文档V1-0"><a href="#数据库设计文档V1-0" class="headerlink" title="数据库设计文档V1.0"></a>数据库设计文档V1.0</h1><h2 id="1、用户模块"><a href="#1、用户模块" class="headerlink" title="1、用户模块"></a>1、用户模块</h2><h3 id="1-1-用户表-（user）"><a href="#1-1-用户表-（user）" class="headerlink" title="1.1 用户表 （user）"></a>1.1 用户表 （user）</h3><table>
<thead>
<tr>
<th>字段名称</th>
<th>类型</th>
<th>约束</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int(11) unsigned NOT NUL AUTO_INCREMENT</td>
<td>PK</td>
<td>用户id</td>
</tr>
<tr>
<td>name</td>
<td>varchar(255)</td>
<td></td>
<td>用户昵称</td>
</tr>
<tr>
<td>portrait</td>
<td>varchar(255)</td>
<td></td>
<td>用户头像地址</td>
</tr>
<tr>
<td>phone</td>
<td>varchar(255)</td>
<td></td>
<td>注册手机</td>
</tr>
<tr>
<td>password</td>
<td>varchar(255)</td>
<td></td>
<td>用户密码（可以为空，支持只用验证码注册、登录）</td>
</tr>
<tr>
<td>reg_ip</td>
<td>varchar(255)</td>
<td></td>
<td>注册ip</td>
</tr>
<tr>
<td>account_non_expired</td>
<td>bit(1)</td>
<td></td>
<td>是否有效用户</td>
</tr>
<tr>
<td>credentials_non_expired</td>
<td>bit(1)</td>
<td></td>
<td>账号是否未过期</td>
</tr>
<tr>
<td>account_non_locked</td>
<td>bit(1)</td>
<td></td>
<td>是否未锁定</td>
</tr>
<tr>
<td>status</td>
<td>varchar(255)</td>
<td></td>
<td>用户状态</td>
</tr>
<tr>
<td>is_del</td>
<td>bit(1)</td>
<td></td>
<td>是否删除</td>
</tr>
<tr>
<td>create_time</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>update_time</td>
<td>datetime</td>
<td></td>
<td>更新时间</td>
</tr>
</tbody></table>
<h2 id="2、课程模块"><a href="#2、课程模块" class="headerlink" title="2、课程模块"></a>2、课程模块</h2><h3 id="2-1-课程表（course）"><a href="#2-1-课程表（course）" class="headerlink" title="2.1 课程表（course）"></a>2.1 课程表（course）</h3><table>
<thead>
<tr>
<th>字段名称</th>
<th>类型</th>
<th>约束</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int(11) unsigned NOT NUL AUTO_INCREMENT</td>
<td>PK</td>
<td>主键PK</td>
</tr>
<tr>
<td>course_name</td>
<td>varchar(255)</td>
<td></td>
<td>课程名</td>
</tr>
<tr>
<td>brief</td>
<td>varchar(255)</td>
<td></td>
<td>课程一句话简介</td>
</tr>
<tr>
<td>price</td>
<td>double(10,2)</td>
<td></td>
<td>原价</td>
</tr>
<tr>
<td>price_tag</td>
<td>varchar(255)</td>
<td></td>
<td>原价标签</td>
</tr>
<tr>
<td>discounts</td>
<td>double(10,2)</td>
<td></td>
<td>优惠价</td>
</tr>
<tr>
<td>discounts_tag</td>
<td>varchar(255)</td>
<td></td>
<td>优惠标签</td>
</tr>
<tr>
<td>course_description_mark_down</td>
<td>longtext</td>
<td></td>
<td>描述markdown</td>
</tr>
<tr>
<td>course_description</td>
<td>longtext</td>
<td></td>
<td>课程描述</td>
</tr>
<tr>
<td>course_img_url</td>
<td>varchar(255)</td>
<td></td>
<td>课程列表图</td>
</tr>
<tr>
<td>is_new</td>
<td>tinyint(1)</td>
<td></td>
<td>是否新品</td>
</tr>
<tr>
<td>is_new_des</td>
<td>varchar(255)</td>
<td></td>
<td>广告语</td>
</tr>
<tr>
<td>last_operator_id</td>
<td>int(11)</td>
<td></td>
<td>最后操作者</td>
</tr>
<tr>
<td>create_time</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>update_time</td>
<td>datetime</td>
<td></td>
<td>更新时间’</td>
</tr>
<tr>
<td>is_del</td>
<td>tinyint(1)</td>
<td></td>
<td>是否删除</td>
</tr>
<tr>
<td>total_duration</td>
<td>int(11)</td>
<td></td>
<td>总时长(分钟)</td>
</tr>
<tr>
<td>course_list_img</td>
<td>varchar(255)</td>
<td></td>
<td>课程列表展示图片</td>
</tr>
<tr>
<td>status</td>
<td>int(2)</td>
<td></td>
<td>课程状态，0-草稿，1-上架</td>
</tr>
<tr>
<td>sort_num</td>
<td>int(11)</td>
<td></td>
<td>课程排序，用于后台保存草稿时用到</td>
</tr>
<tr>
<td>preview_first_field</td>
<td>varchar(255)</td>
<td></td>
<td>课程预览第一个字段</td>
</tr>
<tr>
<td>preview_second_field</td>
<td>varchar(255)</td>
<td></td>
<td>课程预览第二个字段</td>
</tr>
<tr>
<td>sales</td>
<td>int(11)</td>
<td></td>
<td>销量</td>
</tr>
</tbody></table>
<h3 id="2-2-章节表（course-section）"><a href="#2-2-章节表（course-section）" class="headerlink" title="2.2 章节表（course_section）"></a>2.2 章节表（course_section）</h3><table>
<thead>
<tr>
<th>字段名称</th>
<th>类型</th>
<th>约束</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int(11)</td>
<td>PK</td>
<td>‘主键ID</td>
</tr>
<tr>
<td>course_id</td>
<td>int(11)</td>
<td></td>
<td>课程id</td>
</tr>
<tr>
<td>section_name</td>
<td>varchar(255)</td>
<td></td>
<td>章节名</td>
</tr>
<tr>
<td>description</td>
<td>varchar(255)</td>
<td></td>
<td>‘章节描述’</td>
</tr>
<tr>
<td>status</td>
<td>int(1)</td>
<td></td>
<td>状态，0:隐藏；1：待更新；2：已发布</td>
</tr>
<tr>
<td>order_num</td>
<td>int(11)</td>
<td></td>
<td>排序字段</td>
</tr>
<tr>
<td>is_del</td>
<td>tinyint(1)</td>
<td></td>
<td>是否删除</td>
</tr>
<tr>
<td>update_time</td>
<td>datetime</td>
<td></td>
<td>‘更新时间</td>
</tr>
<tr>
<td>create_time</td>
<td>datetime</td>
<td></td>
<td>记录创建时间</td>
</tr>
</tbody></table>
<h3 id="2-3-课时表（每节课）"><a href="#2-3-课时表（每节课）" class="headerlink" title="2.3 课时表（每节课）"></a>2.3 课时表（每节课）</h3><p>course_lesson</p>
<table>
<thead>
<tr>
<th>字段名称</th>
<th>类型</th>
<th>约束</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int(11)</td>
<td>PK</td>
<td>主键</td>
</tr>
<tr>
<td>course_id</td>
<td>int(11)</td>
<td></td>
<td>课程id</td>
</tr>
<tr>
<td>section_id</td>
<td>int(11)</td>
<td></td>
<td>章节id</td>
</tr>
<tr>
<td>theme</td>
<td>varchar(255)</td>
<td></td>
<td>课时主题</td>
</tr>
<tr>
<td>duration</td>
<td>int(11)</td>
<td></td>
<td>‘课时时长(分钟)</td>
</tr>
<tr>
<td>is_free</td>
<td>tinyint(1)</td>
<td></td>
<td>是否免费</td>
</tr>
<tr>
<td>is_del</td>
<td>tinyint(1)</td>
<td></td>
<td>是否删除</td>
</tr>
<tr>
<td>order_num</td>
<td>int(11)</td>
<td></td>
<td>排序字段</td>
</tr>
<tr>
<td>status</td>
<td>int(2)</td>
<td></td>
<td>课时状态,0-隐藏，1-未发布，2-已发布</td>
</tr>
<tr>
<td>update_time</td>
<td>datetime</td>
<td></td>
<td>更新时间</td>
</tr>
<tr>
<td>create_time</td>
<td>datetime</td>
<td></td>
<td>记录创建时间</td>
</tr>
</tbody></table>
<h3 id="2-4-课程媒体"><a href="#2-4-课程媒体" class="headerlink" title="2.4 课程媒体"></a>2.4 课程媒体</h3><p>course_media</p>
<table>
<thead>
<tr>
<th>字段名称</th>
<th>类型</th>
<th>约束</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int(11)</td>
<td>PK</td>
<td>‘课程媒体主键ID</td>
</tr>
<tr>
<td>course_id</td>
<td>int(11)</td>
<td></td>
<td>课程id</td>
</tr>
<tr>
<td>section_id</td>
<td>int(11)</td>
<td></td>
<td>章节id</td>
</tr>
<tr>
<td>cover_image_url</td>
<td>varchar(255)</td>
<td></td>
<td>封面图URL</td>
</tr>
<tr>
<td>duration</td>
<td>varchar(50)</td>
<td></td>
<td>时长（06:02）</td>
</tr>
<tr>
<td>file_edk</td>
<td>varchar(500)</td>
<td></td>
<td>媒体资源文件对应的EDK</td>
</tr>
<tr>
<td>file_size</td>
<td>double(10,2)</td>
<td></td>
<td>文件大小MB</td>
</tr>
<tr>
<td>file_name</td>
<td>varchar(100)</td>
<td></td>
<td>文件名称</td>
</tr>
<tr>
<td>file_dk</td>
<td>varchar(100)</td>
<td></td>
<td>‘媒体资源文件对应的DK</td>
</tr>
<tr>
<td>duration_num</td>
<td>varchar(50)</td>
<td></td>
<td>时长，秒数</td>
</tr>
<tr>
<td>file_id</td>
<td>varchar(50)</td>
<td></td>
<td>媒体资源文件ID</td>
</tr>
<tr>
<td>is_del</td>
<td>tinyint(1)</td>
<td></td>
<td>是否删除，0未删除，1删除</td>
</tr>
<tr>
<td>update_time</td>
<td>datetime</td>
<td></td>
<td>更新时间</td>
</tr>
<tr>
<td>create_time</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td></td>
<td></td>
<td></td>
<td></td>
</tr>
</tbody></table>
<h3 id="2-5-历史播放节点表"><a href="#2-5-历史播放节点表" class="headerlink" title="2.5 历史播放节点表"></a>2.5 历史播放节点表</h3><p>course_play_history</p>
<table>
<thead>
<tr>
<th>字段名称</th>
<th>类型</th>
<th>约束</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int(11)</td>
<td>PK</td>
<td>‘主键ID</td>
</tr>
<tr>
<td>course_id</td>
<td>int(11)</td>
<td></td>
<td>课程id</td>
</tr>
<tr>
<td>section_id</td>
<td>int(11)</td>
<td></td>
<td>章节id</td>
</tr>
<tr>
<td>lesson_id</td>
<td>int(11)</td>
<td></td>
<td>课时id</td>
</tr>
<tr>
<td>history_node</td>
<td>int(11)</td>
<td></td>
<td>历史播放节点(s)’</td>
</tr>
<tr>
<td>history_highest_node</td>
<td>int(11)</td>
<td></td>
<td>最高历史播放节点</td>
</tr>
<tr>
<td>is_del</td>
<td>tinyint(1)</td>
<td></td>
<td>是否删除</td>
</tr>
<tr>
<td>update_time</td>
<td>datetime</td>
<td></td>
<td>更新时间</td>
</tr>
<tr>
<td>create_time</td>
<td>datetime</td>
<td></td>
<td>记录创建时间</td>
</tr>
<tr>
<td>user_id</td>
<td>int(11)</td>
<td></td>
<td>用户id</td>
</tr>
</tbody></table>
<h3 id="2-6-活动课程表"><a href="#2-6-活动课程表" class="headerlink" title="2.6 活动课程表"></a>2.6 活动课程表</h3><p>activity_course</p>
<table>
<thead>
<tr>
<th>字段名称</th>
<th>类型</th>
<th>约束</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int(11)</td>
<td>PK</td>
<td>‘主键ID</td>
</tr>
<tr>
<td>course_id</td>
<td>int(11)</td>
<td></td>
<td>课程ID</td>
</tr>
<tr>
<td>begin_time</td>
<td>timestamp</td>
<td></td>
<td>活动开始时间</td>
</tr>
<tr>
<td>end_time</td>
<td>timestamp</td>
<td></td>
<td>活动结束时间</td>
</tr>
<tr>
<td>amount</td>
<td>double(10,2)</td>
<td></td>
<td>活动价格</td>
</tr>
<tr>
<td>stock</td>
<td>int(10)</td>
<td></td>
<td>库存值</td>
</tr>
<tr>
<td>status</td>
<td>tinyint(2)</td>
<td></td>
<td>状态 0未上架 10已上架</td>
</tr>
<tr>
<td>is_del</td>
<td>tinyint(1)</td>
<td></td>
<td>逻辑删除 0未删除 1删除</td>
</tr>
<tr>
<td>remark</td>
<td>varchar(255)</td>
<td></td>
<td>备注</td>
</tr>
<tr>
<td>create_time</td>
<td>timestamp</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>create_user</td>
<td>varchar(64)</td>
<td></td>
<td>创建人</td>
</tr>
<tr>
<td>update_time</td>
<td>timestamp</td>
<td></td>
<td>更新时间</td>
</tr>
<tr>
<td>update_user</td>
<td>varchar(64)</td>
<td></td>
<td>更新人</td>
</tr>
</tbody></table>
<h3 id="2-7-老师表"><a href="#2-7-老师表" class="headerlink" title="2.7 老师表"></a>2.7 老师表</h3><p>tearcher</p>
<table>
<thead>
<tr>
<th>字段名称</th>
<th>类型</th>
<th>约束</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int(11)</td>
<td>PK</td>
<td>‘主键ID</td>
</tr>
<tr>
<td>course_id</td>
<td>int(11)</td>
<td></td>
<td>课程ID</td>
</tr>
<tr>
<td>teacher_name</td>
<td>varchar(255)</td>
<td></td>
<td>讲师姓名</td>
</tr>
<tr>
<td>description</td>
<td>text</td>
<td></td>
<td>讲师介绍</td>
</tr>
<tr>
<td>create_time</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>update_time</td>
<td>datetime</td>
<td></td>
<td>更新时间</td>
</tr>
<tr>
<td>is_del</td>
<td>tinyint(1)</td>
<td></td>
<td>是否删除</td>
</tr>
<tr>
<td>position</td>
<td>varchar(20)</td>
<td></td>
<td>职务</td>
</tr>
</tbody></table>
<h2 id="3、留言模块"><a href="#3、留言模块" class="headerlink" title="3、留言模块"></a>3、留言模块</h2><h3 id="3-1-留言表"><a href="#3-1-留言表" class="headerlink" title="3.1 留言表"></a>3.1 留言表</h3><p>course_comment</p>
<table>
<thead>
<tr>
<th>字段类型</th>
<th>类型</th>
<th>约束</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>bigint(20)</td>
<td>PK</td>
<td>主键</td>
</tr>
<tr>
<td>courseId</td>
<td>int(11)</td>
<td></td>
<td>课程id</td>
</tr>
<tr>
<td>userId</td>
<td>int(11)</td>
<td></td>
<td>用户id</td>
</tr>
<tr>
<td>comment</td>
<td>text</td>
<td></td>
<td>评论</td>
</tr>
<tr>
<td>likeCount</td>
<td>int(11)</td>
<td></td>
<td>点赞数</td>
</tr>
<tr>
<td>createTime</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>updateTime</td>
<td>datetime</td>
<td></td>
<td>更新时间</td>
</tr>
<tr>
<td>isDel</td>
<td>tinyint(1)</td>
<td></td>
<td>是否删除</td>
</tr>
</tbody></table>
<h3 id="3-2-点赞表"><a href="#3-2-点赞表" class="headerlink" title="3.2 点赞表"></a>3.2 点赞表</h3><p>course_comment_favorite</p>
<table>
<thead>
<tr>
<th>字段类型</th>
<th>类型</th>
<th>约束</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>bigint(20)</td>
<td>PK</td>
<td>主键</td>
</tr>
<tr>
<td>userId</td>
<td>int(11)</td>
<td></td>
<td>用户ID</td>
</tr>
<tr>
<td>commentId</td>
<td>int(11)</td>
<td></td>
<td>用户评论ID</td>
</tr>
<tr>
<td>isDel</td>
<td>tinyint(1)</td>
<td></td>
<td>是否删除</td>
</tr>
<tr>
<td>createTime</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>updateTime</td>
<td>datetime</td>
<td></td>
<td>更新时间</td>
</tr>
</tbody></table>
<h2 id="4、订单模块"><a href="#4、订单模块" class="headerlink" title="4、订单模块"></a>4、订单模块</h2><h3 id="4-1-用户课程订单表"><a href="#4-1-用户课程订单表" class="headerlink" title="4.1 用户课程订单表"></a>4.1 用户课程订单表</h3><p>user_course_order</p>
<table>
<thead>
<tr>
<th>字段类型</th>
<th>类型</th>
<th>约束</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>bigint(20)</td>
<td>PK</td>
<td>主键</td>
</tr>
<tr>
<td>order_no</td>
<td>varchar(64)</td>
<td></td>
<td>订单号</td>
</tr>
<tr>
<td>user_id</td>
<td>int(11)</td>
<td></td>
<td>用户ID</td>
</tr>
<tr>
<td>course_id</td>
<td>int(11)</td>
<td></td>
<td>课程id</td>
</tr>
<tr>
<td>source_type</td>
<td>tinyint(2)</td>
<td></td>
<td>订单来源类型: 1 用户下单购买 2 后台添加专栏</td>
</tr>
<tr>
<td>status</td>
<td>tinyint(2)</td>
<td></td>
<td>当前状态: 0已创建 10未支付 20已支付 30已取消 40已过期</td>
</tr>
<tr>
<td>create_time</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>update_time</td>
<td>datetime</td>
<td></td>
<td>更新时间</td>
</tr>
<tr>
<td>is_del</td>
<td>tinyint(2)</td>
<td></td>
<td>是否删除 1删除 默认值0</td>
</tr>
</tbody></table>
<h3 id="4-2-支付订单信息表"><a href="#4-2-支付订单信息表" class="headerlink" title="4.2 支付订单信息表"></a>4.2 支付订单信息表</h3><p>pay_order</p>
<table>
<thead>
<tr>
<th>字段类型</th>
<th>类型</th>
<th>约束</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>bigint(20)</td>
<td>PK</td>
<td>主键</td>
</tr>
<tr>
<td>order_no</td>
<td>varchar(64)</td>
<td></td>
<td>订单号</td>
</tr>
<tr>
<td>user_id</td>
<td>int(11)</td>
<td></td>
<td>用户ID</td>
</tr>
<tr>
<td>product_id</td>
<td>int(11)</td>
<td></td>
<td>商品唯一标识(ID)</td>
</tr>
<tr>
<td>product_name</td>
<td>varchar(128)</td>
<td></td>
<td>产品名称</td>
</tr>
<tr>
<td>amount</td>
<td>decimal(12,2)</td>
<td></td>
<td>金额,单位元</td>
</tr>
<tr>
<td>count</td>
<td>int(11)</td>
<td></td>
<td>商品数量</td>
</tr>
<tr>
<td>currency</td>
<td>varchar(6)</td>
<td></td>
<td>‘cny’ COMMENT ‘货币类型，cny-人民币 gbeans-勾豆’</td>
</tr>
<tr>
<td>channel</td>
<td>varchar(16)</td>
<td></td>
<td>支付渠道：weChat-微信支付，aliPay-支付宝支付,applePay-苹果支付</td>
</tr>
<tr>
<td>status</td>
<td>tinyint(4)</td>
<td></td>
<td>订单状态：1-未支付 2-支付成功 3-支付失败 -1-订单失效</td>
</tr>
<tr>
<td>channel_status</td>
<td>tinyint(8)</td>
<td></td>
<td>渠道中的状态码值</td>
</tr>
<tr>
<td>order_type</td>
<td>tinyint(4)</td>
<td></td>
<td>类型 1-购买课程 2-充值</td>
</tr>
<tr>
<td>source</td>
<td>tinyint(4)</td>
<td></td>
<td>支付来源 1-app 2-h5 3-pc</td>
</tr>
<tr>
<td>client_ip</td>
<td>varchar(16)</td>
<td></td>
<td>127.0.0.1’ COMMENT ‘用户支付IP</td>
</tr>
<tr>
<td>buy_id</td>
<td>varchar(128)</td>
<td></td>
<td>购买账号id</td>
</tr>
<tr>
<td>out_trade_no</td>
<td>varchar(128)</td>
<td></td>
<td>外部支付渠道交易号</td>
</tr>
<tr>
<td>created_time</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>updated_time</td>
<td>timestamp</td>
<td></td>
<td>更新时间</td>
</tr>
<tr>
<td>extra</td>
<td>text</td>
<td></td>
<td>附加字段，KV json，例如:{“mobile”:13020202,”success_url”:123}</td>
</tr>
<tr>
<td>goods_order_no</td>
<td>varchar(64)</td>
<td></td>
<td>商品订单编号</td>
</tr>
<tr>
<td>platform</td>
<td>int(11)</td>
<td></td>
<td>支付所使用的平台：1 拉勾 2 拉勾教育</td>
</tr>
<tr>
<td>wx_type</td>
<td>int(11)</td>
<td></td>
<td>微信类型, 参考自lg-wechat-boot项目中的wxinfo</td>
</tr>
</tbody></table>
<h3 id="4-3-支付订单状态日志表"><a href="#4-3-支付订单状态日志表" class="headerlink" title="4.3 支付订单状态日志表"></a>4.3 支付订单状态日志表</h3><p>pay_order_record</p>
<table>
<thead>
<tr>
<th>字段类型</th>
<th>类型</th>
<th>约束</th>
<th>描述</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>bigint(20)</td>
<td>PK</td>
<td>主键</td>
</tr>
<tr>
<td>order_no</td>
<td>varchar(32)</td>
<td></td>
<td>订单号</td>
</tr>
<tr>
<td>type</td>
<td>varchar(16)</td>
<td></td>
<td>操作类型：CREATE|PAY|REFUND…</td>
</tr>
<tr>
<td>from_status</td>
<td>varchar(16)</td>
<td></td>
<td>原订单状态</td>
</tr>
<tr>
<td>to_status</td>
<td>varchar(16)</td>
<td></td>
<td>新订单状态</td>
</tr>
<tr>
<td>paid_amount</td>
<td>int(11)</td>
<td></td>
<td>实付金额，单位为分</td>
</tr>
<tr>
<td>remark</td>
<td>varchar(128)</td>
<td></td>
<td>备注</td>
</tr>
<tr>
<td>created_by</td>
<td>varchar(64)</td>
<td></td>
<td>操作人</td>
</tr>
<tr>
<td>created_at</td>
<td>datetime</td>
<td></td>
<td>操作时间</td>
</tr>
</tbody></table>
<h2 id="5、广告模块"><a href="#5、广告模块" class="headerlink" title="5、广告模块"></a>5、广告模块</h2><h3 id="5-1-广告位表"><a href="#5-1-广告位表" class="headerlink" title="5.1 广告位表"></a>5.1 广告位表</h3><p>promotion_space</p>
<table>
<thead>
<tr>
<th>字段名称</th>
<th>字段类型</th>
<th>约束</th>
<th>字段描述</th>
</tr>
</thead>
<tbody><tr>
<td>id</td>
<td>int(11)</td>
<td>主键</td>
<td>广告位id</td>
</tr>
<tr>
<td>name</td>
<td>varchar(255)</td>
<td></td>
<td>广告位名称</td>
</tr>
<tr>
<td>spaceKey</td>
<td>varchar(255)</td>
<td></td>
<td>广告位标识</td>
</tr>
<tr>
<td>createTime</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>updateTime</td>
<td>datetime</td>
<td></td>
<td>最后更新时间</td>
</tr>
<tr>
<td>isDel</td>
<td>int(2)</td>
<td></td>
<td>状态</td>
</tr>
</tbody></table>
<h3 id="5-2-广告表"><a href="#5-2-广告表" class="headerlink" title="5.2 广告表"></a>5.2 广告表</h3><p>promotion_ad</p>
<table>
<thead>
<tr>
<th>id</th>
<th>int(11)</th>
<th>主键</th>
<th>广告ID</th>
</tr>
</thead>
<tbody><tr>
<td>name</td>
<td>varchar(255)</td>
<td></td>
<td>广告名称</td>
</tr>
<tr>
<td>spaceId</td>
<td>int(11)</td>
<td></td>
<td>广告位ID</td>
</tr>
<tr>
<td>keyword</td>
<td>varchar(255)</td>
<td></td>
<td>关键字</td>
</tr>
<tr>
<td>htmlContent</td>
<td>varchar(255)</td>
<td></td>
<td>文本内容</td>
</tr>
<tr>
<td>text</td>
<td>varchar(255)</td>
<td></td>
<td>备注</td>
</tr>
<tr>
<td>img</td>
<td>varchar(255)</td>
<td></td>
<td>图片链接</td>
</tr>
<tr>
<td>link</td>
<td>varchar(255)</td>
<td></td>
<td>跳转地址</td>
</tr>
<tr>
<td>startTime</td>
<td>datetime</td>
<td></td>
<td>开始时间</td>
</tr>
<tr>
<td>endTine</td>
<td>datetimedatetime</td>
<td></td>
<td>结束时间</td>
</tr>
<tr>
<td>createTime</td>
<td>datetime</td>
<td></td>
<td>创建时间</td>
</tr>
<tr>
<td>updateTime</td>
<td>datetime</td>
<td></td>
<td>最后更新时间</td>
</tr>
<tr>
<td>status</td>
<td>int(2)</td>
<td></td>
<td>状态(上架&#x2F;下架)</td>
</tr>
<tr>
<td>priority</td>
<td>int(4)</td>
<td></td>
<td>优先级</td>
</tr>
</tbody></table>

                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
    <div class="post-meta mr-3 d-flex align-items-center">
      <i class="iconfont icon-category"></i>
      

<span class="category-chains">
  
  
    
      <span class="category-chain">
        
  <a href="/categories/Java%E5%B0%B1%E4%B8%9A%E8%AE%AD%E7%BB%83%E8%90%A5%E6%A8%A1%E6%9D%BF/" class="category-chain-item">Java就业训练营模板</a>
  
  

      </span>
    
  
</span>

    </div>
  
  
    <div class="post-meta">
      <i class="iconfont icon-tags"></i>
      
        <a href="/tags/%E9%A1%B9%E7%9B%AE/">#项目</a>
      
    </div>
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>【拉钩就业】拉勾教育PC站-微服务版</div>
      <div>https://xuebaqiang.github.io/2022/11/02/Java就业训练营/第十阶段 微服务项目：拉勾教育学习平台（微服务架构）/【拉钩就业】拉勾教育PC站-微服务版/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>作者</div>
          <div>xuebaqiang</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>发布于</div>
          <div>2022年11月2日</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>许可协议</div>
          <div>
            
              
              
                <a target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - 署名">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2022/11/17/%E9%9D%A2%E8%AF%95%E7%9B%B8%E5%85%B3/%E3%80%90%E9%9D%A2%E8%AF%95%E3%80%91%E7%BD%91%E5%9D%80%E5%A4%A7%E5%85%A8/" title="【面试】网址大全">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">【面试】网址大全</span>
                        <span class="visible-mobile">上一篇</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2022/10/26/%E5%85%B6%E4%BB%96/%E9%9D%A2%E8%AF%95%E9%9C%80%E8%A6%81%E6%8E%8C%E6%8F%A1%E7%9A%84%E6%8A%80%E6%9C%AF%E6%A0%88(20221026)/" title="面试需要掌握的技术栈(20221026)">
                        <span class="hidden-mobile">面试需要掌握的技术栈(20221026)</span>
                        <span class="visible-mobile">下一篇</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>目录</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">搜索</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">关键词</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.0/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.18.2/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">博客在允许 JavaScript 运行的环境下浏览效果更佳</div>
  </noscript>
</body>
</html>
